function InitUI() {$('#PageTitle').children('._i').html('&#xF040;').next().html("Sales");PkIds=[];
$('#btn_filed').on('click',function(){onFieldChange(setmarkasfiled,$(this));});
var ddl=$('#fldmodeoftransactionnote');ddl.parent().addClass('ui-list');ddl.data('FieldID','c1401203-a12b-4eb1-afcd-ee1bd2bca1fc');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_modeoftransactionnote');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
$('#fldmodeoftransactionnote').on('selectchange',function(){onFieldChange(SetPreviousTRReference,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_modeoftransactionnote",ID:"fldmodeoftransactionnote",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-44').on('change',
function(){
onFieldChange(pregst_changed,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_pregst",ID:"Field-44",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_pregstinvoicenumber",ID:"lblPreNumber",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#lblPreDate').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_preinvoicedate",ID:"lblPreDate",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-5');ddl.parent().addClass('ui-list');ddl.data('FieldID','21214f0a-92b4-4694-a9fc-b4528863c78e');ddl.data('LookupCode','lu_vouchertType');ddl.data('Eids','tbl_ERP_vt');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','4809811a-3c54-7fc6-8dc8-f612ca707870');ddl.data('EntityID','tbl_ERP_vt');$('#Field-5').on('selectchange',function(){onFieldChange(vtypeChanged,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_vt",ID:"Field-5",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#txtVDate').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_voucherdate",ID:"txtVDate",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:true,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_vnumber",ID:"Field-6",Disabled:false,Type:"Auto",DataType:"AUTOGENERATED",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null,OnValid:(typeof validateinumpattern=='function'?validateinumpattern:null)});
$('#Field-15').on('change',
function(){
onFieldChange(toggleEcom,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_ecomtran",ID:"Field-15",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-40');ddl.parent().addClass('ui-list');ddl.data('FieldID','b03b3261-b25d-462e-9e0f-cf02a24bac56');ddl.data('LookupCode','ecomoperator');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_ecommerceoperatoram",ID:"Field-40",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-1');ddl.parent().addClass('ui-list');ddl.data('FieldID','9886a7cb-26bc-4460-8b4c-01167fd102c4');ddl.data('LookupCode','siteOU');ddl.data('Eids','tbl_ERP_ou');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','9c594642-f40b-488f-8d46-85ca37caee3b');ddl.data('EntityID','tbl_ERP_ou');$('#Field-1').on('selectchange',function(){onFieldChange(SiteOUChanged,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_siteou",ID:"Field-1",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-17');ddl.parent().addClass('ui-list');ddl.data('FieldID','dd73ae0b-6266-452e-a154-4e05df562073');ddl.data('LookupCode','lu_taxreglist_forlocation');ddl.data('Eids','tbl_ERP_taxreg');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','7a3e2b48-c075-438b-8c88-8601f8e895b9');ddl.data('EntityID','tbl_ERP_taxreg');$('#Field-17').on('selectchange',function(){onFieldChange(taxreg_changed,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_taxreg",ID:"Field-17",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-3');ddl.parent().addClass('ui-list');ddl.data('FieldID','b9a19ea8-55d9-46ee-adf7-ec2f5974a508');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','1e5a142d-ca4c-4904-bcff-6ea5f5170e89');ddl.data('EntityID','tbl_ERP_am');$('#Field-3').on('selectchange',function(){onFieldChange(helperAMChanged,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_am",ID:"Field-3",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-9');ddl.parent().addClass('ui-list');ddl.data('FieldID','12a8c2df-c3cc-4274-b305-1be566f8f13c');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','1e5a142d-ca4c-4904-bcff-6ea5f5170e89');ddl.data('EntityID','tbl_ERP_am');Erp.FieldInfo.push({Name:"tbl_erp_t_salesconsigneeam",ID:"Field-9",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-13');ddl.parent().addClass('ui-list');ddl.data('FieldID','861a65ec-9307-47c5-8424-3a26c4578f71');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_invoicetype');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','c00588e8-5a4f-461c-a15b-5ae71b3ee79d');ddl.data('EntityID','tbl_ERP_invoicetype');$('#Field-13').on('selectchange',function(){onFieldChange(InvoiceTypeChanged,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_invoicetype",ID:"Field-13",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_purchaseinvoiceno",ID:"Field-12",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-46');ddl.parent().addClass('ui-list');ddl.data('FieldID','c7d4d653-f3df-4040-9152-76889b8c235b');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_t');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
$('#Field-46').on('selectchange',function(){onFieldChange(previoustr_change,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_previoustr",ID:"Field-46",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#Field-19').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_purchaseinvoicedate",ID:"Field-19",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_purchasecdnumber",ID:"Field-51",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-22').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_purchasecddate",ID:"Field-22",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_voucher_refno",ID:"Field-27",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-23');ddl.parent().addClass('ui-list');ddl.data('FieldID','591bfc75-51b2-411e-9190-8ecdb54cb1cb');ddl.data('LookupCode','Lu_series');ddl.data('Eids','tbl_ERP_transactionseries');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','2ad3d7f0-e4cb-448d-b2ce-9739dac05071');ddl.data('EntityID','tbl_ERP_transactionseries');Erp.FieldInfo.push({Name:"tbl_erp_t_transactionseries",ID:"Field-23",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-35');ddl.parent().addClass('ui-list');ddl.data('FieldID','8c531101-bcb1-498e-9732-6cff60e1822f');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_dctype');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_dctype",ID:"Field-35",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-43');ddl.parent().addClass('ui-list');ddl.data('FieldID','16e1b434-64fc-41a0-8a33-5d56c305ed15');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_transportmode');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','14a20871-51f9-4cb8-be61-430e68355e77');ddl.data('EntityID','tbl_ERP_transportmode');Erp.FieldInfo.push({Name:"tbl_erp_t_transportmode",ID:"Field-43",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_vehiclenumber",ID:"Field-49",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-14');ddl.parent().addClass('ui-list');ddl.data('FieldID','19b60b66-2521-46cd-afc0-3621ad8139c6');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_shippingport');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_exportport",ID:"Field-14",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#txtExportBillDate').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_export_billdate",ID:"txtExportBillDate",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_export_billno",ID:"Field-24",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null,OnValid:(typeof validatebillpattern=='function'?validatebillpattern:null)});
var ddl=$('#Field-16');ddl.parent().addClass('ui-list');ddl.data('FieldID','042b59ac-e816-4f96-945d-be4b1aa8a353');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_shippingport');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_importport",ID:"Field-16",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#txtImportBillDate').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_import_billdate",ID:"txtImportBillDate",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_import_billno",ID:"Field-47",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-45').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
Erp.FieldInfo.push({Name:"tbl_erp_t_import_billofvalue",ID:"Field-45",Disabled:false,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#fld_advance').on('change',
function(){
onFieldChange(isinvoiceagainstadvance_changed,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_isinvoiceagainstadvance",ID:"fld_advance",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#btnAdvInv').on('click',function(){onFieldChange(showAdvances,$(this));});
var ddl=$('#Field-30');ddl.parent().addClass('ui-list');ddl.data('FieldID','d3b71124-dfeb-402a-b5da-9dbecd1c14d5');ddl.data('LookupCode','CashBank');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
$('#Field-30').on('selectchange',function(){onFieldChange(refreshtm1,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_am1",ID:"Field-30",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-38');ddl.parent().addClass('ui-list');ddl.data('FieldID','a6c01458-c67a-4fdf-baa5-b3c269b3597b');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_tm');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
$('#Field-38').on('selectchange',function(){onFieldChange(Toggletransactiondetails,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_tm",ID:"Field-38",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_chequedrawnon",ID:"Field-34",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#txtChequeDate').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_chequedate",ID:"txtChequeDate",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_tmreferenceno",ID:"Field-33",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-11').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
$('#Field-11').on('change',function(){onFieldChange(setadvanceamt,$(this),$(this).autoNumeric('get'),Erp.GetField($(this).attr('id')));});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_amount1",ID:"Field-11",Disabled:false,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#lblTds').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
$('#lblTds').on('change',function(){onFieldChange(toggleTDSAccount,$(this),$(this).autoNumeric('get'),Erp.GetField($(this).attr('id')));});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_tdsamount",ID:"lblTds",Disabled:false,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-42');ddl.parent().addClass('ui-list');ddl.data('FieldID','15abf88c-98c4-4acc-90fb-5a0bcc068b41');ddl.data('LookupCode','TDSAM');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_helper_am2",ID:"Field-42",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#btnCrBal').on('click',function(){onFieldChange(openMatchingLayout,$(this));});
$('#btnDrBal').on('click',function(){onFieldChange(openMatchingLayout,$(this));});
$('#Field-4').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_dot",ID:"Field-4",Disabled:false,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:true,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_rs",ID:"Field-20",Disabled:false,Type:"Text",DataType:"TEXT",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-28');ddl.parent().addClass('ui-list');ddl.data('FieldID','f4bb2ed4-58c8-438d-bc69-0070bd574d95');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_cdnreasonlist');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_cdnreason",ID:"Field-28",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_pregst_b2cl",ID:"Field-48",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
GridList.push({ID:"dgAdvInv",BindOnload:true,Title:"Grid",AdvFilter:[{Type:'LIST',Title:"Transaction Item",Field:'',FieldID:'advFld0',Eid:"tbl_ERP_ti",Qry:"84K2fFAkxYXiGD3hdjXxY+H3iTDvK1+4ifYSH7+MjwjcCnk6szmhU4Lum32XFt55zMMotQgiWRJQ4NfIZG7gLw=="},{Type:'LIST',Title:"Advance Transaction",Field:'',FieldID:'advFld1',Eid:"tbl_ERP_t",Qry:"84K2fFAkxYXiGD3hdjXxY+H3iTDvK1+4ifYSH7+MjwgPzLOMizowh90mpHg3Bx+rxinWMaGwfmfXbfT0Lrt+onXYlNlzJwdMMDKx+7P8P+s="}],GroupInfo:[],OnBind:null});
initGridSettings("dgAdvInv");
$('#Button-3').on('click',function(){onFieldChange(hideAdvancePopup,$(this));});
GridList.push({ID:"gridAgainstBill",BindOnload:false,Title:"",AdvFilter:[{Type:'LIST',Title:"Account Master",Field:'',FieldID:'advFld2',Eid:"tbl_ERP_am",Qry:"84K2fFAkxYXiGD3hdjXxY2e24c66CKO3piY8esmHynNFLEqdPCuOw2WYZjGoiDj+"},{Type:'DATE',Title:"Date Of Transaction",Field:"tbl_t_pid.dot"}],GroupInfo:[],OnBind:null});
initGridSettings("gridAgainstBill");
$('#CollParent-1 > div').accordion({ heightStyle: "content",collapsible: true,activate: function( event, ui ) { Erp.RedrawLayout();}});
$('#Field-39').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
Erp.FieldInfo.push({Name:"tbl_erp_t_advanceamount",ID:"Field-39",Disabled:true,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#Field-32').on('change',
function(){
onFieldChange(IsAdvanceChecked,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_isadvance",ID:"Field-32",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#Field-18').on('change',
function(){
onFieldChange(Togglepercentage,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_isreversechargeapplicable",ID:"Field-18",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-37');ddl.parent().addClass('ui-list');ddl.data('FieldID','e577e205-cce5-4838-96fe-c17bb638bafb');ddl.data('LookupCode','');ddl.data('Eids','tbl_CORE_statelist');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','15');ddl.data('EntityID','tbl_CORE_statelist');$('#Field-37').on('selectchange',function(){onFieldChange(POS_Changed,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_pos",ID:"Field-37",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-36');ddl.parent().addClass('ui-list');ddl.data('FieldID','749e4db5-6218-40e7-aea0-9dcc3ac98b54');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_supplytype');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','IES');ddl.data('EntityID','tbl_ERP_supplytype');$('#Field-36').on('selectchange',function(){onFieldChange(SupplyTypeChanged,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_supplytype",ID:"Field-36",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-21');ddl.parent().addClass('ui-list');ddl.data('FieldID','e37ef208-483f-45bd-94d6-a7b4543cffd6');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_gstsupplycategory');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','Taxable');ddl.data('EntityID','tbl_ERP_gstsupplycategory');$('#Field-21').on('selectchange',function(){onFieldChange(GSC_Changed,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_gstsupplycategory",ID:"Field-21",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#fldtaxconsideration');ddl.parent().addClass('ui-list');ddl.data('FieldID','25ed8417-344a-42b4-8bde-5f81abe72960');ddl.data('LookupCode','');ddl.data('Eids','tbl_ERP_taxconsideration');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','Exclusive');ddl.data('EntityID','tbl_ERP_taxconsideration');Erp.FieldInfo.push({Name:"tbl_erp_t_taxconsideration",ID:"fldtaxconsideration",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
GridList.push({ID:"gridTI",BindOnload:false,Title:"Grid",AdvFilter:[{Type:'LIST',Title:"Account",Field:'',FieldID:'advFld0',Eid:"tbl_ERP_am",Qry:"84K2fFAkxYXiGD3hdjXxY+LZrEZu57upHFX9IXfTWihi3zoBUEbnxHpGOpzpEKYG"},{Type:'LIST',Title:"Item",Field:'',FieldID:'advFld1',Eid:"tbl_ERP_item",Qry:"84K2fFAkxYXiGD3hdjXxY3U/v8KTYyn2R9NyaqrgDFUEdG+2pTwVejJ8r+sWuDxL"},{Type:'LIST',Title:"ITC Type",Field:'',FieldID:'advFld17',Eid:"tbl_ERP_eligibility",Qry:"84K2fFAkxYXiGD3hdjXxY9Q4xqjk8Kf7T8AtEtODxDZYzQzzbJTIJIW1aN8WWB9g"}],GroupInfo:[{t:"SGST",k:"SGST",p:"",i:1},{t:"CGST",k:"CGST",p:"",i:1},{t:"IGST",k:"IGST",p:"",i:1},{t:"FULLGST",k:"FULLGST",p:"",i:1},{t:"GST CESS",k:"GSTCESS",p:"",i:1}],OnBind:null});
initGridSettings("gridTI");
GridList.push({ID:"dgAgainstCN",BindOnload:false,Title:"Grid",AdvFilter:[{Type:'LIST',Title:"Account Master",Field:'',FieldID:'advFld1',Eid:"tbl_ERP_am",Qry:"84K2fFAkxYXiGD3hdjXxY2e24c66CKO3piY8esmHynNFLEqdPCuOw2WYZjGoiDj+"},{Type:'DATE',Title:"Date Of Transaction",Field:"tbl_t_pid.dot"}],GroupInfo:[],OnBind:null});
initGridSettings("dgAgainstCN");
$('#CollParent-2 > div').accordion({ heightStyle: "content",collapsible: true,activate: function( event, ui ) { Erp.RedrawLayout();}});
GridList.push({ID:"gridOC",BindOnload:false,Title:"TransactionDetail",AdvFilter:[{Type:'SELECT',Title:"D/C",Items:[{v:"D",k:"D"},{v:"C",k:"C"}],Qry:"84K2fFAkxYXiGD3hdjXxY1wrMSIO8TjpE36A+F5K0zeNgk6u4TmJw65ZxyPmnQxACCvQ/h0npIVhdVzUlvTMlQ=="},{Type:'LIST',Title:"Account",Field:'',FieldID:'advFld1',Eid:"tbl_ERP_am",Qry:"84K2fFAkxYXiGD3hdjXxY9grpv5wPoj22IZVLF+K5YPylFWRT2sMflLyp2T5Iuo2"}],GroupInfo:[],OnBind:null});
initGridSettings("gridOC");
var ddl=$('#Field-29');ddl.parent().addClass('ui-list');ddl.data('FieldID','34b1740d-4b3b-4c97-93b2-852035406769');ddl.data('LookupCode','');ddl.data('Eids','tbl_CORE_currencylist');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','35605078-93a9-46d6-b3ab-1c657f365fbe');ddl.data('EntityID','tbl_CORE_currencylist');Erp.FieldInfo.push({Name:"tbl_erp_t_currency",ID:"Field-29",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:true,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-41').on('change',
function(){
onFieldChange(roundOffAmount,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_roundingoff",ID:"Field-41",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#Field-8').on('change',
function(){
onFieldChange(TDSApplicableChanged,$(this),$(this).checked(),Erp.GetField($(this).attr('id')));
});
Erp.FieldInfo.push({Name:"tbl_erp_t_istdsapplicable",ID:"Field-8",Disabled:false,Type:"Bool",DataType:"CHECKBOX",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
var ddl=$('#Field-31');ddl.parent().addClass('ui-list');ddl.data('FieldID','34cb6317-8d8b-4ade-ae5b-31e44e429de7');ddl.data('LookupCode','TDSAM');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
Erp.FieldInfo.push({Name:"tbl_erp_t_tds_am",ID:"Field-31",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#txtTDSGrossAmt').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
Erp.FieldInfo.push({Name:"tbl_erp_t_tdsgrossamount",ID:"txtTDSGrossAmt",Disabled:false,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#txtTDSAmt').autoNumeric('init',{vMin:'-79228162514264337593543950335',vMax:'79228162514264337593543950335',mDec :50,aPad :false,aSep :''});
Erp.FieldInfo.push({Name:"tbl_erp_t_tdsamount",ID:"txtTDSAmt",Disabled:false,Type:"Number",DataType:"DECIMAL",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:true,Data:null});
$('#Button-26').on('click',function(){onFieldChange(showacdetails,$(this));});
var ddl=$('#ddlDotScheme');ddl.parent().addClass('ui-list');ddl.data('FieldID','040b1cd9-c67b-4d5b-a925-a7332d562838');ddl.data('LookupCode','lu_duedatescheme');ddl.data('Eids','tbl_ERP_duedatescheme');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
$('#ddlDotScheme').on('selectchange',function(){onFieldChange(duedatescheme_change,$(this), {RecordID:$(this).data('RecordID'),EntityID:$(this).data('EntityID'),Text:$(this).val(),Keys:$(this).data('Keys'),CurrentRow:$(this).data('CurrentRow')}, Erp.GetField($(this).attr('id'))   );});
Erp.FieldInfo.push({Name:"tbl_erp_t_duedatescheme",ID:"ddlDotScheme",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
$('#Field-10').datepicker({onSelect:function(){$(this).trigger('change');},dateFormat: "dd-mm-yy"});
Erp.FieldInfo.push({Name:"tbl_erp_t_duedate",ID:"Field-10",Disabled:true,Type:"Date",DataType:"DATE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
var ddl=$('#Field-25');ddl.parent().addClass('ui-list');ddl.data('FieldID','5fa5a863-6278-41ea-91e4-cd39c0c400df');ddl.data('LookupCode','Bank');ddl.data('Eids','tbl_ERP_am');ddl.data('FieldType','SINGLESELECT_TABLE');ddl.data('Multi',false);enableKeyboardForList(ddl);ddl.parent().on('click',function(){showSearchList($(this));});
ddl.data('RecordID','613cd190-639b-4b95-8016-684af0b30cd0');ddl.data('EntityID','tbl_ERP_am');Erp.FieldInfo.push({Name:"tbl_erp_t_defaulttransactionbank",ID:"Field-25",Disabled:false,Type:"Ddl",DataType:"SINGLESELECT_TABLE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
GridList.push({ID:"gridTD",BindOnload:true,Title:"TransactionDetail",AdvFilter:[{Type:'SELECT',Title:"D/C",Items:[{v:"D",k:"D"},{v:"C",k:"C"}],Qry:"84K2fFAkxYXiGD3hdjXxY1wrMSIO8TjpE36A+F5K0zeNgk6u4TmJw65ZxyPmnQxACCvQ/h0npIVhdVzUlvTMlQ=="},{Type:'LIST',Title:"Account",Field:'',FieldID:'advFld1',Eid:"tbl_ERP_am",Qry:"84K2fFAkxYXiGD3hdjXxY2e24c66CKO3piY8esmHynNFLEqdPCuOw2WYZjGoiDj+"}],GroupInfo:[],OnBind:null});
initGridSettings("gridTD");
Erp.FieldInfo.push({Name:"tbl_erp_t_narration",ID:"Field-7",Disabled:false,Type:"Text",DataType:"MULTILINE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
Erp.FieldInfo.push({Name:"tbl_erp_t_tterms",ID:"Field-26",Disabled:false,Type:"Text",DataType:"MULTILINE",CustomRender:false,Mandatory:false,IsDescriptive:false,ReqForCalc:false,Data:null});
GridList.push({ID:"gridDocs",BindOnload:true,Title:"Transaction Documents",AdvFilter:[],GroupInfo:[],OnBind:null});
initGridSettings("gridDocs");
$('#CollParent-3 > div').accordion({ heightStyle: "content",collapsible: true,activate: function( event, ui ) { Erp.RedrawLayout();}});
DbReferences.push({Type:"Simple",Id:"db_fld_0",Columns:"field.helper_am.gstin"});window.db_fld_0='';
DbReferences.push({Type:"Simple",Id:"db_fld_1",Columns:"field.helper_tm.tmcode"});window.db_fld_1='';
DbReferences.push({Type:"Simple",Id:"db_fld_2",Columns:"field.helper_tm.tmcode"});window.db_fld_2='';
DbReferences.push({Type:"Simple",Id:"db_fld_3",Columns:"field.helper_tm.tmcode"});window.db_fld_3='';
DbReferences.push({Type:"Simple",Id:"db_fld_4",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_4='';
DbReferences.push({Type:"Simple",Id:"db_fld_5",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_5='';
DbReferences.push({Type:"Simple",Id:"db_fld_6",Columns:"field.helper_am1.ag.agcode"});window.db_fld_6='';
DbReferences.push({Type:"Simple",Id:"db_fld_7",Columns:"field.helper_am1.ag.agcode"});window.db_fld_7='';
DbReferences.push({Type:"Simple",Id:"db_fld_8",Columns:"field.taxreg.taxregstate.country"});window.db_fld_8='';
DbReferences.push({Type:"Simple",Id:"db_fld_9",Columns:"field.taxreg.taxregstate"});window.db_fld_9='';
DbReferences.push({Type:"Simple",Id:"db_fld_10",Columns:"field.helper_am.default_isexport"});window.db_fld_10='';
DbReferences.push({Type:"Simple",Id:"db_fld_11",Columns:"field.helper_am.default_gstsupplycategory"});window.db_fld_11='';
DbReferences.push({Type:"Simple",Id:"db_fld_12",Columns:"field.helper_am.default_gstsupplycategory"});window.db_fld_12='';
DbReferences.push({Type:"Simple",Id:"db_fld_13",Columns:"field.helper_am.taxpayertype.taxpayertype_pid"});window.db_fld_13='';
DbReferences.push({Type:"Simple",Id:"db_fld_14",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_14='';
DbReferences.push({Type:"Simple",Id:"db_fld_15",Columns:"field.helper_am.gstin"});window.db_fld_15='';
DbReferences.push({Type:"Simple",Id:"db_fld_16",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_16='';
DbReferences.push({Type:"Simple",Id:"db_fld_17",Columns:"field.taxreg.taxregstate"});window.db_fld_17='';
DbReferences.push({Type:"Simple",Id:"db_fld_18",Columns:"field.helper_am.am_state"});window.db_fld_18='';
DbReferences.push({Type:"Simple",Id:"db_fld_19",Columns:"setting.company.showaccountsfieldinvoucher"});window.db_fld_19='';
DbReferences.push({Type:"Simple",Id:"db_fld_20",Columns:"field.attachdocuments"});window.db_fld_20='';
DbReferences.push({Type:"Simple",Id:"db_fld_21",Columns:"field.helper_am.taxpayertype.taxpayertype_pid"});window.db_fld_21='';
DbReferences.push({Type:"Simple",Id:"db_fld_22",Columns:"setting.company.showothercharges"});window.db_fld_22='';
DbReferences.push({Type:"Simple",Id:"db_fld_23",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_23='';
DbReferences.push({Type:"Simple",Id:"db_fld_24",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_24='';
DbReferences.push({Type:"Simple",Id:"db_fld_25",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_25='';
DbReferences.push({Type:"Simple",Id:"db_fld_26",Columns:"field.helper_tm.tmcode"});window.db_fld_26='';
DbReferences.push({Type:"Simple",Id:"db_fld_27",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_27='';
DbReferences.push({Type:"Simple",Id:"db_fld_28",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_28='';
DbReferences.push({Type:"Simple",Id:"db_fld_29",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_29='';
DbReferences.push({Type:"Simple",Id:"db_fld_30",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_30='';
DbReferences.push({Type:"Simple",Id:"db_fld_31",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_31='';
DbReferences.push({Type:"Simple",Id:"db_fld_32",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_32='';
DbReferences.push({Type:"Simple",Id:"db_fld_33",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_33='';
DbReferences.push({Type:"Simple",Id:"db_fld_34",Columns:"field.helper_am.gstin"});window.db_fld_34='';
DbReferences.push({Type:"Simple",Id:"db_fld_35",Columns:"field.helper_am.ag.mainag.agcode"});window.db_fld_35='';
DbReferences.push({Type:"Simple",Id:"db_fld_36",Columns:"field.helper_am.taxpayertype.taxpayertype_pid"});window.db_fld_36='';
DbReferences.push({Type:"Simple",Id:"db_fld_37",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_37='';
DbReferences.push({Type:"Simple",Id:"db_fld_38",Columns:"field.helper_am.gstin"});window.db_fld_38='';
DbReferences.push({Type:"Simple",Id:"db_fld_39",Columns:"field.previoustr.supplytype.supplytype_pid"});window.db_fld_39='';
DbReferences.push({Type:"Simple",Id:"db_fld_40",Columns:"field.previoustr.supplytype.supplytypename"});window.db_fld_40='';
DbReferences.push({Type:"Simple",Id:"db_fld_41",Columns:"field.previoustr.pos.statelist_pid"});window.db_fld_41='';
DbReferences.push({Type:"Simple",Id:"db_fld_42",Columns:"field.previoustr.gstsupplycategory.gstsupplycategory_pid"});window.db_fld_42='';
DbReferences.push({Type:"Simple",Id:"db_fld_43",Columns:"field.previoustr.invoicetype.invoicetype_pid"});window.db_fld_43='';
DbReferences.push({Type:"Simple",Id:"db_fld_44",Columns:"field.previoustr.ecomtran"});window.db_fld_44='';
DbReferences.push({Type:"Simple",Id:"db_fld_45",Columns:"field.previoustr.ecommerceoperatoram.am_pid"});window.db_fld_45='';
DbReferences.push({Type:"Simple",Id:"db_fld_46",Columns:"field.previoustr.isreversechargeapplicable"});window.db_fld_46='';
DbReferences.push({Type:"Simple",Id:"db_fld_47",Columns:"field.previoustr.defaulttransactionbank.am_pid"});window.db_fld_47='';
DbReferences.push({Type:"Simple",Id:"db_fld_48",Columns:"field.previoustr.helper_am1.am_pid"});window.db_fld_48='';
DbReferences.push({Type:"Simple",Id:"db_fld_49",Columns:"field.previoustr.helper_tm.tm_pid"});window.db_fld_49='';
DbReferences.push({Type:"Simple",Id:"db_fld_50",Columns:"field.previoustr.helper_chequedrawnon"});window.db_fld_50='';
DbReferences.push({Type:"Simple",Id:"db_fld_51",Columns:"field.previoustr.helper_chequedate"});window.db_fld_51='';
DbReferences.push({Type:"Simple",Id:"db_fld_52",Columns:"field.previoustr.helper_tmreferenceno"});window.db_fld_52='';
DbReferences.push({Type:"Simple",Id:"db_fld_53",Columns:"field.previoustr.advanceamount"});window.db_fld_53='';
DbReferences.push({Type:"Simple",Id:"db_fld_54",Columns:"field.previoustr.helper_amount1"});window.db_fld_54='';
DbReferences.push({Type:"Simple",Id:"db_fld_55",Columns:"field.invoicetype.inward"});window.db_fld_55='';
DbReferences.push({Type:"Simple",Id:"db_fld_56",Columns:"field.invoicetype.outward"});window.db_fld_56='';
DbReferences.push({Type:"Simple",Id:"db_fld_57",Columns:"field.taxreg.taxregstate"});window.db_fld_57='';
DbReferences.push({Type:"Simple",Id:"db_fld_58",Columns:"field.taxreg.default_roundingoff"});window.db_fld_58='';
DbReferences.push({Type:"Simple",Id:"db_fld_59",Columns:"field.helper_am.gstin"});window.db_fld_59='';
DbReferences.push({Type:"Simple",Id:"db_fld_60",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_60='';
DbReferences.push({Type:"Simple",Id:"db_fld_61",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_61='';
DbReferences.push({Type:"Simple",Id:"db_fld_62",Columns:"field.helper_am.gstin"});window.db_fld_62='';
DbReferences.push({Type:"Simple",Id:"db_fld_63",Columns:"field.invoicetype.invoicetypecode"});window.db_fld_63='';
DbReferences.push({Type:"Simple",Id:"db_fld_64",Columns:"field.helper_am.gstin"});window.db_fld_64='';
DbReferences.push({Type:"Simple",Id:"db_fld_65",Columns:"field.supplytype.supplytype_pid"});window.db_fld_65='';
DbReferences.push({Type:"Simple",Id:"db_fld_66",Columns:"field.helper_am.gstin"});window.db_fld_66='';
DbReferences.push({Type:"Simple",Id:"db_fld_67",Columns:"field.supplytype.supplytype_pid"});window.db_fld_67='';
DbReferences.push({Type:"Simple",Id:"db_fld_68",Columns:"field.transactionamount"});window.db_fld_68='';
DbReferences.push({Type:"Simple",Id:"db_fld_69",Columns:"field.gstnfiled"});window.db_fld_69='';
DbReferences.push({Type:"Simple",Id:"db_fld_70",Columns:"field.modifyongstn"});window.db_fld_70='';
DbReferences.push({Type:"Simple",Id:"db_fld_71",Columns:"field.deleteongstn"});window.db_fld_71='';
DbReferences.push({Type:"Simple",Id:"db_fld_72",Columns:"field.gstnfiled"});window.db_fld_72='';
DbReferences.push({Type:"Simple",Id:"db_fld_73",Columns:"field.modifyongstn"});window.db_fld_73='';
DbReferences.push({Type:"Simple",Id:"db_fld_74",Columns:"field.deleteongstn"});window.db_fld_74='';
DbReferences.push({Type:"Simple",Id:"db_fld_75",Columns:"field.gstnfiled"});window.db_fld_75='';
DbReferences.push({Type:"Simple",Id:"db_fld_76",Columns:"field.gstnfiled"});window.db_fld_76='';
DbReferences.push({Type:"Simple",Id:"db_fld_77",Columns:"field.gstnfiled"});window.db_fld_77='';
DbReferences.push({Type:"Simple",Id:"db_fld_78",Columns:"field.modifiedongstntaxformperiod.taxformperiod_pid"});window.db_fld_78='';
DbReferences.push({Type:"Simple",Id:"db_fld_79",Columns:"field.modifiedongstntaxformperiod.taxformperiod_pid"});window.db_fld_79='';
DbReferences.push({Type:"Simple",Id:"db_fld_80",Columns:"field.gstnfiledtaxformperiod.taxformperiod_pid"});window.db_fld_80='';
DbReferences.push({Type:"Simple",Id:"db_fld_81",Columns:"field.modifiedongstndate"});window.db_fld_81='';
DbReferences.push({Type:"Simple",Id:"db_fld_82",Columns:"field.gstnfiled"});window.db_fld_82='';
DbReferences.push({Type:"Simple",Id:"db_fld_83",Columns:"field.gstnfiledtaxformperiod.taxformperiod_pid"});window.db_fld_83='';
DbReferences.push({Type:"Simple",Id:"db_fld_84",Columns:"field.modifiedongstntaxformperiod.taxfpname"});window.db_fld_84='';
DbReferences.push({Type:"Simple",Id:"db_fld_85",Columns:"field.gstnfileddate"});window.db_fld_85='';
DbReferences.push({Type:"Simple",Id:"db_fld_86",Columns:"field.gstnfiledtaxformperiod.taxfpname"});window.db_fld_86='';

FunctionList.push({Name:'Togglepercentage',Refs:['db_fld_4','db_fld_0']});
FunctionList.push({Name:'Toggletransactiondetails',Refs:['db_fld_1','db_fld_1','db_fld_1']});
FunctionList.push({Name:'Toggle_exportdetails',Refs:['db_fld_4']});
FunctionList.push({Name:'Toggle_importdetails',Refs:['db_fld_4']});
FunctionList.push({Name:'refreshtm',Refs:['db_fld_6']});
FunctionList.push({Name:'refreshtm1',Refs:['db_fld_6','db_fld_6']});
FunctionList.push({Name:'SaveCountryState',Refs:['db_fld_8','db_fld_9']});
FunctionList.push({Name:'helperAMChanged',Refs:['db_fld_18','db_fld_10','db_fld_4','db_fld_29','db_fld_11','db_fld_11','db_fld_4','db_fld_9','db_fld_0','db_fld_4','db_fld_13','db_fld_4','db_fld_4','db_fld_4','db_fld_0','db_fld_4','db_fld_4','db_fld_0','db_fld_0','db_fld_4']});
FunctionList.push({Name:'ChangeSupplyType',Refs:['db_fld_4','db_fld_9']});
FunctionList.push({Name:'SaveHelperState',Refs:['db_fld_18']});
FunctionList.push({Name:'SupplyTypeChanged',Refs:['db_fld_0','db_fld_4']});
FunctionList.push({Name:'taxListLoaded',Refs:['db_fld_4','db_fld_4','db_fld_19']});
FunctionList.push({Name:'CreateTaxColumns',Refs:['db_fld_4','db_fld_4']});
FunctionList.push({Name:'HideUnhideColumns',Refs:['db_fld_19']});
FunctionList.push({Name:'attachDocumentsChanged',Refs:['db_fld_20']});
FunctionList.push({Name:'LoadFunction',Refs:['db_fld_20','db_fld_8','db_fld_9','db_fld_18','db_fld_22','db_fld_4','db_fld_0','db_fld_6','db_fld_1','db_fld_1','db_fld_1','db_fld_29','db_fld_18','db_fld_10','db_fld_4','db_fld_29','db_fld_11','db_fld_11','db_fld_4','db_fld_9','db_fld_0','db_fld_4','db_fld_13','db_fld_4','db_fld_4','db_fld_4','db_fld_0','db_fld_4','db_fld_4','db_fld_0','db_fld_0','db_fld_4','db_fld_19','db_fld_13','db_fld_0','db_fld_4']});
FunctionList.push({Name:'ManipulateUI',Refs:['db_fld_22']});
FunctionList.push({Name:'LoadCompleteFunction',Refs:['db_fld_4','db_fld_4','db_fld_6','db_fld_6','db_fld_1','db_fld_1','db_fld_1','db_fld_0','db_fld_4','db_fld_0','db_fld_65','db_fld_0','db_fld_65','db_fld_68','db_fld_69','db_fld_70','db_fld_71','db_fld_69','db_fld_70','db_fld_71','db_fld_69','db_fld_69','db_fld_69','db_fld_78','db_fld_78','db_fld_80','db_fld_81','db_fld_69','db_fld_80','db_fld_84','db_fld_85','db_fld_86']});
FunctionList.push({Name:'CountryRateLoaded',Refs:['db_fld_4','db_fld_4','db_fld_4','db_fld_4']});
FunctionList.push({Name:'StateRateLoaded',Refs:['db_fld_4','db_fld_4','db_fld_4','db_fld_4']});
FunctionList.push({Name:'OURateLoaded',Refs:['db_fld_4','db_fld_4','db_fld_4','db_fld_4']});
FunctionList.push({Name:'ItemTaxRateLoaded',Refs:['db_fld_4','db_fld_4','db_fld_4']});
FunctionList.push({Name:'CalculateRow',Refs:['db_fld_4']});
FunctionList.push({Name:'GridCellChangedTI',Refs:['db_fld_4','db_fld_4','db_fld_4']});
FunctionList.push({Name:'CalcTotalsAll',Refs:['db_fld_4']});
FunctionList.push({Name:'CalcTotals',Refs:['db_fld_4']});
FunctionList.push({Name:'GridCellChangedOC',Refs:['db_fld_4','db_fld_4']});
FunctionList.push({Name:'delItemRow',Refs:['db_fld_4','db_fld_4']});
FunctionList.push({Name:'delOCRow',Refs:['db_fld_4','db_fld_4']});
FunctionList.push({Name:'SaveFunction',Refs:['db_fld_0','db_fld_29','db_fld_13','db_fld_4','db_fld_0','db_fld_1']});
FunctionList.push({Name:'validatebillpattern',Refs:['db_fld_4']});
FunctionList.push({Name:'GridCellChangedgridAgainstBill',Refs:['db_fld_29']});
FunctionList.push({Name:'GSC_Changed',Refs:['db_fld_4','db_fld_4','db_fld_4','db_fld_0','db_fld_4']});
FunctionList.push({Name:'OnGridDataBound_AgainstCN',Refs:['db_fld_29']});
FunctionList.push({Name:'OnGridDataBound_AgainstBill',Refs:['db_fld_29']});
FunctionList.push({Name:'GridCellChangeddgAgainstCN',Refs:['db_fld_29','db_fld_29','db_fld_29']});
FunctionList.push({Name:'distributeReceiptAmount',Refs:['db_fld_29']});
FunctionList.push({Name:'DistributeAmoutRowWise',Refs:['db_fld_29','db_fld_29','db_fld_29']});
FunctionList.push({Name:'ResetAgainstGridAmounts',Refs:['db_fld_29']});
FunctionList.push({Name:'toggleMatchingGrids',Refs:['db_fld_29']});
FunctionList.push({Name:'CalculateNewBalance',Refs:['db_fld_29']});
FunctionList.push({Name:'SetDistribute',Refs:['db_fld_29']});
FunctionList.push({Name:'validateGUIControls',Refs:['db_fld_0','db_fld_29','db_fld_13','db_fld_4','db_fld_0']});
FunctionList.push({Name:'previoustr_change',Refs:['db_fld_39','db_fld_40','db_fld_41','db_fld_42','db_fld_43','db_fld_44','db_fld_45','db_fld_46','db_fld_47','db_fld_48','db_fld_49','db_fld_50','db_fld_51','db_fld_52','db_fld_53','db_fld_54','db_fld_1','db_fld_1','db_fld_1']});
FunctionList.push({Name:'InvoiceTypeChanged',Refs:['db_fld_55','db_fld_56','db_fld_4','db_fld_4','db_fld_4','db_fld_4','db_fld_4','db_fld_9','db_fld_0','db_fld_4','db_fld_4','db_fld_4','db_fld_4','db_fld_0','db_fld_4','db_fld_0','db_fld_4']});
FunctionList.push({Name:'taxreg_changed',Refs:['db_fld_9','db_fld_8','db_fld_9','db_fld_4','db_fld_9','db_fld_58']});
FunctionList.push({Name:'setTransType',Refs:['db_fld_0','db_fld_4']});
FunctionList.push({Name:'POS_Changed',Refs:['db_fld_4','db_fld_9','db_fld_0','db_fld_4']});
FunctionList.push({Name:'DistributeOC',Refs:['db_fld_4','db_fld_4']});
FunctionList.push({Name:'pregst_changed',Refs:['db_fld_0','db_fld_4']});
FunctionList.push({Name:'toggle_PrevGstB2cl',Refs:['db_fld_0','db_fld_4']});
FunctionList.push({Name:'setOtherInfo_GST',Refs:['db_fld_0','db_fld_65','db_fld_0','db_fld_65','db_fld_68','db_fld_69','db_fld_70','db_fld_71','db_fld_69','db_fld_70','db_fld_71','db_fld_69','db_fld_69','db_fld_69','db_fld_78','db_fld_78','db_fld_80','db_fld_81','db_fld_69','db_fld_80','db_fld_84','db_fld_85','db_fld_86']});

DbReferences.push({Id:"TaxList",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_tax",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_tax\"\><ColInfo\><Cols Type=\"\" Name=\"1848b266-55ef-4b0b-a6c3-149f544125ea\" EntityPath=\"taxtype:tbl_ERP_taxtype\" Title=\"taxtypecode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"3e73a8a2-7002-46c3-b548-e1a8530f3ef4\" EntityPath=\"\" Title=\"taxcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1789437e-cbfb-4941-a67d-b0c640b7420a\" EntityPath=\"\" Title=\"taxname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"899570f9-a8bf-4b12-b845-4562cae2675c\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"taxgroupcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"f9849f13-c8a2-410d-bc67-54ec95247c75\" EntityPath=\"\" Title=\"tax_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5af279f6-990c-42bd-bd0c-71944257d224\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"intrastate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"9a97f242-0105-4e30-85fb-545761306bb2\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"interstate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"b6957c33-6a17-4db2-8dc3-958a49c9bbe9\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"taxratehidden\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"8078191c-c60c-4a74-a78a-b59e3f8ae573\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"taxvaluehidden\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"763f76a7-5efd-4bd3-a9a9-0fe2e6d80b95\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"rateindependent\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"899570f9-a8bf-4b12-b845-4562cae2675c\" EntityPath=\"taxgroup:tbl_ERP_taxgroup\" Title=\"taxgroupcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_tax\" Logic=\"1\"\><Condition Name=\"1a35b27c-a5ac-4806-a086-cabed9126917\" EntityPath=\"taxtype:tbl_ERP_taxtype&gt;country:tbl_CORE_countrylist\" Operator=\"EqualTo\" Value=\"[Field.siteou.OUCountry]\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\><Cols Name=\"0d21b6c5-6e93-40ab-acec-a704dd1c0093\" EntityPath=\"\" Sort=\"Asc\" fieldtype=\"-999\" /\></ColInfo\></Sort\><Parameters\></Parameters\></Filter\>",AlwaysLoad:true });window.TaxList='';
DbReferences.push({Id:"TaxInfo",Type:"Table",OnDemand:0,EntityId:"tbl_ERP_titaxes",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_titaxes\"\><ColInfo\><Cols Type=\"\" Name=\"3e73a8a2-7002-46c3-b548-e1a8530f3ef4\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"taxcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1789437e-cbfb-4941-a67d-b0c640b7420a\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"taxname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"2547296e-dd0a-4a60-bb9c-2038e64ef95a\" EntityPath=\"\" Title=\"taxrate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"8f90f5fd-b910-459f-8f11-d9731c44abd8\" EntityPath=\"\" Title=\"taxvalue\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"7d504c05-5968-4a4d-bebb-6dcd2e28dd23\" EntityPath=\"\" Title=\"claimabletax\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"3bfc8f13-7eab-47cd-a1e6-3a3d1cd79680\" EntityPath=\"\" Title=\"ti_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"f9849f13-c8a2-410d-bc67-54ec95247c75\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"tax_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_titaxes\" Logic=\"1\"\><Condition Name=\"1af85a19-cf4f-4d3d-82f8-20434b886d8b\" EntityPath=\"ti_pid:tbl_ERP_ti&gt;td_pid:tbl_ERP_td&gt;t_pid:tbl_ERP_t\" Operator=\"EqualTo\" Value=\"{ID}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Filter\>",AlwaysLoad:false });window.TaxInfo='';
DbReferences.push({Id:"ItemRateCountry",Type:"Value",OnDemand:1,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_itemrate\" Target=\"4f07a8fc-3024-4831-bbbc-dd10e690d7da\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1 and 3 and 4\"\><Condition Name=\"3bef3812-b6c3-4e47-8f35-0696507164cb\" EntityPath=\"\" Operator=\"LessThanOrEqualTo\" Value=\"DOR\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"ea55e43f-4ec5-44f7-9895-e104e21aeca1\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"Country\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Condition Name=\"eff5a167-e448-4bd7-84e2-99125c4cd142\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"ITMID\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"4\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\><Param Key=\"DOR\" /\><Param Key=\"ITMID\" /\><Param Key=\"RateCountry\" /\></Parameters\></Subquery\>",AlwaysLoad:false });window.ItemRateCountry='';
DbReferences.push({Id:"ItemRateState",Type:"Value",OnDemand:1,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_itemrate\" Target=\"4f07a8fc-3024-4831-bbbc-dd10e690d7da\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1 and 3 and 4\"\><Condition Name=\"3bef3812-b6c3-4e47-8f35-0696507164cb\" EntityPath=\"\" Operator=\"LessThanOrEqualTo\" Value=\"DOR\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"0612ecaa-eb6a-4ccd-8732-7d2ab1144e77\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"RateState\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Condition Name=\"eff5a167-e448-4bd7-84e2-99125c4cd142\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"ITMID\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"4\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\><Param Key=\"DOR\" /\><Param Key=\"ITMID\" /\><Param Key=\"RateState\" /\></Parameters\></Subquery\>",AlwaysLoad:false });window.ItemRateState='';
DbReferences.push({Id:"ItemRateOU",Type:"Value",OnDemand:1,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_itemrate\" Target=\"4f07a8fc-3024-4831-bbbc-dd10e690d7da\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1 and 3 and 4\"\><Condition Name=\"3bef3812-b6c3-4e47-8f35-0696507164cb\" EntityPath=\"\" Operator=\"LessThanOrEqualTo\" Value=\"DOR\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"a9cbb847-451e-43f3-989c-f71cba2e4367\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"RateOU\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Condition Name=\"eff5a167-e448-4bd7-84e2-99125c4cd142\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"ITMID\" ValueSrc=\"Parameter\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"4\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\><Param Key=\"DOR\" /\><Param Key=\"ITMID\" /\><Param Key=\"RateOU\" /\></Parameters\></Subquery\>",AlwaysLoad:false });window.ItemRateOU='';
DbReferences.push({Id:"ItemTaxConfig",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_taxrategroup_tax",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_taxrategroup_tax\"\><ColInfo\><Cols Type=\"\" Name=\"f9849f13-c8a2-410d-bc67-54ec95247c75\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"tax_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5af279f6-990c-42bd-bd0c-71944257d224\" EntityPath=\"tax:tbl_ERP_tax&gt;taxgroup:tbl_ERP_taxgroup\" Title=\"intrastate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"9a97f242-0105-4e30-85fb-545761306bb2\" EntityPath=\"tax:tbl_ERP_tax&gt;taxgroup:tbl_ERP_taxgroup\" Title=\"interstate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"7d8974f9-a20b-49bf-a5ca-2ef7e0d4e6d0\" EntityPath=\"\" Title=\"iscountrywide\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"6a4e41b2-d2f1-452c-87cf-a72590607f0a\" EntityPath=\"\" Title=\"isstatespecific\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"763f76a7-5efd-4bd3-a9a9-0fe2e6d80b95\" EntityPath=\"tax:tbl_ERP_tax&gt;taxgroup:tbl_ERP_taxgroup\" Title=\"rateindependent\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_taxrategroup_tax\" Logic=\"1\"\><Condition Name=\"e0f6c952-afd8-45ce-90cd-10043690cfec\" EntityPath=\"taxrategroup_pid:tbl_ERP_taxrategroup\" Operator=\"EqualTo\" Value=\"    and ( [Item ID] EqualTo '{ITMID}' )\" ValueSrc=\"SubQuery\" WFName=\"\" SessionID=\"\" Srno=\"1\"\><Subquery Table=\"tbl_ERP_item\" Target=\"e0f6c952-afd8-45ce-90cd-10043690cfec\" TargetType=\"Single\" EntityPath=\"taxrategroup:tbl_ERP_taxrategroup\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"793526ba-3b49-4544-a515-3487d210a2f2\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{ITMID}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\><Param Key=\"ITM\" /\></Parameters\></Filter\>",AlwaysLoad:false });window.ItemTaxConfig='';
DbReferences.push({Id:"ItemTaxRate",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_taxrategroup_rates",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_taxrategroup_rates\"\><ColInfo\><Cols Type=\"\" Name=\"f9849f13-c8a2-410d-bc67-54ec95247c75\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"tax_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"a6fb6af7-6889-42e1-83ff-8cedb3ba8c77\" EntityPath=\"\" Title=\"taxrate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1a35b27c-a5ac-4806-a086-cabed9126917\" EntityPath=\"taxcountry:tbl_CORE_countrylist\" Title=\"itemtaxcountry\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5af024ab-6bd3-430c-ad88-345032cc0080\" EntityPath=\"taxstate:tbl_CORE_statelist\" Title=\"itemtaxstate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_taxrategroup_rates\" Logic=\" 2\"\><Condition Name=\"e0f6c952-afd8-45ce-90cd-10043690cfec\" EntityPath=\"taxrategroup_pid:tbl_ERP_taxrategroup\" Operator=\"EqualTo\" Value=\"    and ( [Item ID] EqualTo '{ITMID}' )\" ValueSrc=\"SubQuery\" WFName=\"\" SessionID=\"\" Srno=\"2\"\><Subquery Table=\"tbl_ERP_item\" Target=\"e0f6c952-afd8-45ce-90cd-10043690cfec\" TargetType=\"Single\" EntityPath=\"taxrategroup:tbl_ERP_taxrategroup\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"793526ba-3b49-4544-a515-3487d210a2f2\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{ITMID}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\><Param Key=\"DOR\" /\><Param Key=\"ITM\" /\></Parameters\></Filter\>",AlwaysLoad:false });window.ItemTaxRate='';
DbReferences.push({Id:"voucherTypeID",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_vt\" Target=\"8e554df7-a0f8-4960-acc7-b1e9f12d4f0d\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1\"\><Condition Name=\"fecb2a0c-42cf-4fa2-bcfc-9527817a149c\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{vtype}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.voucherTypeID='';
DbReferences.push({Id:"prevTr_Ti",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_ti",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_ti\"\><ColInfo\><Cols Type=\"\" Name=\"c2b6d32b-e41e-408e-bbf4-262c0786184f\" EntityPath=\"am_ti:tbl_ERP_am\" Title=\"am_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"19310273-83c6-44eb-95ed-2e4b94c0d710\" EntityPath=\"am_ti:tbl_ERP_am\" Title=\"amcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"793526ba-3b49-4544-a515-3487d210a2f2\" EntityPath=\"item:tbl_ERP_item\" Title=\"item_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"ceb8db2b-7474-46c2-b2e6-7b700410bd27\" EntityPath=\"item:tbl_ERP_item\" Title=\"itemname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"4c375233-59ed-401e-9234-1ea190057e8e\" EntityPath=\"\" Title=\"rate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"de65579d-d566-4eaf-b532-20386b3dccbd\" EntityPath=\"\" Title=\"ratediscount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"be7b26e9-fd44-4a6a-a14a-a3f0cf00d91b\" EntityPath=\"\" Title=\"finalrate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1a6ca9a5-bde7-4627-9c8e-83c98dbf64ab\" EntityPath=\"\" Title=\"qty\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"01b3635a-f601-46f3-8a15-b178b61fe901\" EntityPath=\"\" Title=\"total\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"39b65989-0094-4830-bba1-6c2402caa155\" EntityPath=\"\" Title=\"discount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5275659c-b1ae-4620-b40d-a171fd871055\" EntityPath=\"\" Title=\"nettotal\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"c1757b78-85b9-414c-a7d2-8b9504fa0e23\" EntityPath=\"\" Title=\"abatement\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"ec71cfeb-db8f-4453-aec6-fe0acbb5dc2a\" EntityPath=\"\" Title=\"taxablevalue\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"6b045949-c6c1-4fee-825e-a67a8dac2236\" EntityPath=\"\" Title=\"tit_tax\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5acc421f-aa00-4d73-9095-4487a0656b4e\" EntityPath=\"\" Title=\"tit_claimable_tax\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"6e554886-84c7-4807-89e7-6a9c749fec73\" EntityPath=\"\" Title=\"itemlinenarration\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"fd1a8667-4da1-4e41-b2ba-72b9dce1576d\" EntityPath=\"\" Title=\"nilratedamt\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"f07cb3e1-2cac-4629-b496-39f2ef875caa\" EntityPath=\"\" Title=\"exemptedamt\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"f149f3bb-be9f-48e2-aa89-14d71aa67bca\" EntityPath=\"\" Title=\"nongstamt\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"53bd6d1a-a4d8-4e65-9933-ba9bb7f5a7df\" EntityPath=\"\" Title=\"otherchargestaxable\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"0a0c6b70-cfef-4b39-806d-9edbee8e298e\" EntityPath=\"\" Title=\"finaltaxablevalue\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"413b0bc0-3480-4e49-ae3b-df2e71e35897\" EntityPath=\"am_ti:tbl_ERP_am\" Title=\"amname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5acaa283-adfb-4e9b-9b58-34caf7eb79ac\" EntityPath=\"\" Title=\"ti_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"51cf8ec7-32c0-48b1-b616-3304d49bc7bb\" EntityPath=\"itc_elg:tbl_ERP_eligibility\" Title=\"eligibility_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"2fd66492-5578-4c94-8b3e-3c60708bf0df\" EntityPath=\"\" Title=\"compositesupplyamount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"71a7bfe4-80ec-4eee-bab1-a3f4272674c3\" EntityPath=\"item:tbl_ERP_item&gt;itemnature:tbl_ERP_itemnature\" Title=\"itemnaturecode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_ti\" Logic=\"1\"\><Condition Name=\"1af85a19-cf4f-4d3d-82f8-20434b886d8b\" EntityPath=\"td_pid:tbl_ERP_td&gt;t_pid:tbl_ERP_t\" Operator=\"EqualTo\" Value=\"[Field.previoustr]\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Filter\>",AlwaysLoad:true });window.prevTr_Ti='';
DbReferences.push({Id:"prevTr_TaxInfo",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_titaxes",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_titaxes\"\><ColInfo\><Cols Type=\"\" Name=\"3e73a8a2-7002-46c3-b548-e1a8530f3ef4\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"taxcode\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1789437e-cbfb-4941-a67d-b0c640b7420a\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"taxname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"2547296e-dd0a-4a60-bb9c-2038e64ef95a\" EntityPath=\"\" Title=\"taxrate\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"8f90f5fd-b910-459f-8f11-d9731c44abd8\" EntityPath=\"\" Title=\"taxvalue\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"7d504c05-5968-4a4d-bebb-6dcd2e28dd23\" EntityPath=\"\" Title=\"claimabletax\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"5acaa283-adfb-4e9b-9b58-34caf7eb79ac\" EntityPath=\"ti_pid:tbl_ERP_ti\" Title=\"ti_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"bbcd8c7c-19a8-48cc-9bc5-910a112e1560\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"tax_am\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"f9849f13-c8a2-410d-bc67-54ec95247c75\" EntityPath=\"tax:tbl_ERP_tax\" Title=\"tax_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_titaxes\" Logic=\"1\"\><Condition Name=\"1af85a19-cf4f-4d3d-82f8-20434b886d8b\" EntityPath=\"ti_pid:tbl_ERP_ti&gt;td_pid:tbl_ERP_td&gt;t_pid:tbl_ERP_t\" Operator=\"EqualTo\" Value=\"[Field.previoustr]\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Filter\>",AlwaysLoad:true });window.prevTr_TaxInfo='';
DbReferences.push({Id:"prevTr_OtherInfo",Type:"Table",OnDemand:1,EntityId:"tbl_ERP_td",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_ERP_td\"\><ColInfo\><Cols Type=\"\" Name=\"354c5220-a753-48d5-8efb-d058337351c0\" EntityPath=\"\" Title=\"debitcredit\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"c2b6d32b-e41e-408e-bbf4-262c0786184f\" EntityPath=\"am:tbl_ERP_am\" Title=\"am_pid\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"413b0bc0-3480-4e49-ae3b-df2e71e35897\" EntityPath=\"am:tbl_ERP_am\" Title=\"amname\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"7da97488-2ffd-4456-a829-b7174fed4ef3\" EntityPath=\"\" Title=\"debitamount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"8b21b24d-9f19-417a-ac9b-b79ae64b0059\" EntityPath=\"\" Title=\"creditamount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"510e17cf-27bf-4c7b-a18b-848dbef280a1\" EntityPath=\"am:tbl_ERP_am\" Title=\"gst\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"1a1ecafb-93c5-4360-9fcd-e710df93f309\" EntityPath=\"am:tbl_ERP_am\" Title=\"cg\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"ac21df04-0beb-40af-a19a-dfdb74e6c72a\" EntityPath=\"am:tbl_ERP_am\" Title=\"og\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"8976f552-879c-4270-bd2f-ef803c3cf009\" EntityPath=\"am:tbl_ERP_am\" Title=\"inv\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\><Cols Type=\"\" Name=\"c39c9423-8625-47e3-ab49-b4f83b877013\" EntityPath=\"am:tbl_ERP_am\" Title=\"ser\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" WFCode=\"\" Status=\"1\" Join=\"\" JoinLogic=\"\"\></Cols\></ColInfo\></Grid\></Layout\><Filter Limit=\"\" Id=\"tbl_ERP_td\" Logic=\"1 and 4 and 5\"\><Condition Name=\"1af85a19-cf4f-4d3d-82f8-20434b886d8b\" EntityPath=\"t_pid:tbl_ERP_t\" Operator=\"EqualTo\" Value=\"[Field.previoustr]\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"41dd7977-abb4-4d37-adc5-859393731d1d\" EntityPath=\"\" Operator=\"NotIn\" Value=\"TransactionDetail ID of tbl_ERP_ti where &lt;br/&gt;( [Transaction ID] EqualTo {'[Field.previoustr]'} )&lt;br/&gt;&lt;br/&gt; order by \" ValueSrc=\"SubQuery\" WFName=\"\" SessionID=\"\" Srno=\"4\"\><Subquery Table=\"tbl_ERP_ti\" Target=\"41dd7977-abb4-4d37-adc5-859393731d1d\" TargetType=\"Single\" EntityPath=\"td_pid:tbl_ERP_td\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"1af85a19-cf4f-4d3d-82f8-20434b886d8b\" EntityPath=\"td_pid:tbl_ERP_td&gt;t_pid:tbl_ERP_t\" Operator=\"EqualTo\" Value=\"[Field.previoustr]\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Condition\><Condition Name=\"8f15370c-a3f1-481e-b1ca-1bb6984968e8\" EntityPath=\"am:tbl_ERP_am\" Operator=\"EqualTo\" Value=\"True\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"5\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Filter\>",AlwaysLoad:true });window.prevTr_OtherInfo='';
DbReferences.push({Id:"SalesAccount",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_am\" Target=\"c2b6d32b-e41e-408e-bbf4-262c0786184f\" TargetType=\"Single\" EntityPath=\"\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"19310273-83c6-44eb-95ed-2e4b94c0d710\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"Sales A/c\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.SalesAccount='';
DbReferences.push({Id:"PurchaseAccount",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_am\" Target=\"c2b6d32b-e41e-408e-bbf4-262c0786184f\" TargetType=\"Single\" EntityPath=\"\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"19310273-83c6-44eb-95ed-2e4b94c0d710\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"Purchase A/c\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.PurchaseAccount='';
DbReferences.push({Id:"RegInvoiceType",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_invoicetype\" Target=\"a979ba1a-31d6-45a7-9645-4566d55b6748\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1\"\><Condition Name=\"24fd4817-c363-4cbb-8f05-7866dba567f9\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"R\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.RegInvoiceType='';
DbReferences.push({Id:"itemTRG",Type:"Value",OnDemand:1,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_item\" Target=\"e0f6c952-afd8-45ce-90cd-10043690cfec\" TargetType=\"Single\" EntityPath=\"taxrategroup:tbl_ERP_taxrategroup\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"793526ba-3b49-4544-a515-3487d210a2f2\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{ITMID}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.itemTRG='';
DbReferences.push({Id:"subvoucherTypeID",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_vt\" Target=\"8e554df7-a0f8-4960-acc7-b1e9f12d4f0d\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1\"\><Condition Name=\"fecb2a0c-42cf-4fa2-bcfc-9527817a149c\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{subvtype}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.subvoucherTypeID='';
DbReferences.push({Id:"DefaultTransBank",Type:"Value",OnDemand:0,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_am\" Target=\"c2b6d32b-e41e-408e-bbf4-262c0786184f\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1 and 2\"\><Condition Name=\"e6add9aa-1927-49e7-98bd-8ec8883d38ec\" EntityPath=\"ag:tbl_ERP_ag\" Operator=\"EqualTo\" Value=\"BA\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"40b46b62-c893-46e2-af0e-9a09e99d4298\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"True\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.DefaultTransBank='';
DbReferences.push({Id:"DefaultTerms",Type:"Value",OnDemand:1,EntityId:"",Columns:"",Xml:"<Subquery Table=\"tbl_ERP_transactionterms\" Target=\"6b6f0b4b-d88e-426c-83a0-d171aa6fb332\" TargetType=\"Single\" EntityPath=\"\" Summary=\"First\" Logic=\"1 and 2\"\><Condition Name=\"fecb2a0c-42cf-4fa2-bcfc-9527817a149c\" EntityPath=\"vtype:tbl_ERP_vt\" Operator=\"EqualTo\" Value=\"{vtype}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"4da0799c-d888-4688-a7d4-99b66660127c\" EntityPath=\"\" Operator=\"EqualTo\" Value=\"{taxreg}\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\>",AlwaysLoad:false });window.DefaultTerms='';
 mxEntityList={};



};
var old_supplytype='';
var old_invtype='';
var old_supplycat='';


var oldTaxReg='';

var vType='';
var subvType='';
var OUCountry='';
var OUState='';
var helper_OUState='';
var taxLoaded=false;
var BeginColumns=0;
var GloadTaxes=false;
var firstLoaded=false;
Erp.Grid.OnCellChanged('gridAgainstBill',GridCellChangedgridAgainstBill);
Erp.Grid.OnCellValidating('gridAgainstBill',OnCellValidating);
Erp.Grid.OnCellValidating('gridTI',OnCellValidating_gridTI);
Erp.Grid.OnGridDataBound('dgAgainstCN',OnGridDataBound_AgainstCN);
Erp.Grid.OnGridDataBound('gridAgainstBill',OnGridDataBound_AgainstBill);
Erp.Grid.OnCellChanged('dgAgainstCN',GridCellChangeddgAgainstCN);
Erp.Grid.OnCellValidating('dgAgainstCN',OnCellValidating1);
Erp.Grid.OnGridDataBound('gridTD',OnGridDataBoundTD);
Erp.Grid.OnRowDataBound('gridTI',GridRowDataBoundTI);
Erp.Grid.OnGridDataBound('gridTI',GridDataBoundTI);
Erp.Grid.OnCellChanged('gridTI',GridCellChangedTI);
Erp.Grid.OnRowAdding('gridTI',dgTiRowAdding);
Erp.Grid.OnCellChanged('gridOC',GridCellChangedOC);
Erp.Grid.OnRowAdding('gridOC',GridOCRowAddingOC);
Erp.Grid.OnCellEditing('gridTI',GridCellEditingTI);
Erp.Grid.OnGridDataBound('gridOC',OnGridDataBoundOC);
Erp.Grid.OnCellEditing('dgAdvInv',OnCellEditing_dgAdvInv);
Erp.Grid.OnCellChanged('dgAdvInv',OnCellChanged_dgAdvInv);
Erp.Grid.OnCellEditing('gridOC',OnCellEditingOC);
Erp.Grid.OnGridDataBound('dgAdvInv',OnGridDataBound_dgAdvInv);
function CustomSave()
{
  if(Erp.LayoutMode == "A")
    Erp.SetFieldValue('@rs','Approved');
  Erp.Grid.SaveChanges('gridTD');
  Erp.Grid.SaveChanges('gridDocs');
  Erp.SaveWindow();
}
function IsAdvanceChecked()
{
  if (vType=='R'  || subvType=='AR'  || vType=='RV'  )
  {
    Erp.SetDisplay('tblSupplydetails',Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')));
    Erp.SetDisplay('gridTI',Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')));
  }
  else if ( vType=='PY'  || subvType=='AP' )
  {
    Erp.SetDisplay('tblSupplydetails',Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')) && Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')));
    if(subvType=='AP' )
      Erp.SetDisplay('gridTI',Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')));
    else
      Erp.SetDisplay('gridTI',Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')) && Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')));
  }
}
function Togglepercentage()
{
  Erp.SetDisplay("trRCM",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
  if(vType == "AR"){
    if(!Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable"))){
      GloadTaxes=true;
     /* console.log("Togglepercentage")*/
      set_ItemTaxLoaded();
    }
  }
  if(vType == "AR"  || vType=='RV' )
    CalcTaxesAll();
  CalcTotalsAll();
  IsAdvanceChecked();
  FinalShowOfTotals();
  if( vType=='P' ){
    Erp.SetDisplay("@isinvoiceagainstadvance",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
    Erp.SetDisplay("trAgainstAdvance",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")))
    Erp.SetDisplay("btnAdvInv",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
    resetAdvanceInv();
    isinvoiceagainstadvance_changed();
  }
   if( vType == "P" && !Fn.IsEmpty( Erp.GetFieldValue('@tbl_erp_t_helper_am')))
  {
    if(Fn.IsEmpty( db_fld_0)  && !Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')){
      Erp.ShowMessage("Since GSTIN of this vendor is not available, You should mark this transaction for Reverse Charge.");
      return false;
    }
     else
      Erp.HideMessage();
  }
  
   if( firstLoaded){
  resetAdvanceInv();
  Erp.Grid.DataBind('dgAdvInv',[]);
   }
}
function Toggletransactiondetails()
{
  if(Fn.IsEmpty(Erp.GetFieldValue("@helper_tm")))
  {
    Erp.SetDisplay('@helper_tmreferenceno',false);
    Erp.SetDisplay('@helper_chequedate',false);
    Erp.SetDisplay('@helper_chequedrawnon',false);
    Erp.SetDisplay('lblDrawnOn',false);
    Erp.SetDisplay('lblChqDate',false);
    Erp.SetDisplay('lblRefNo',false);
    Erp.SetDisplay('trBankDetails',false);
  }
  else{
    var tbankmode=db_fld_1;
    Erp.SetDisplay('@helper_tmreferenceno',!(tbankmode=="Cash"));
    Erp.SetDisplay('@helper_chequedate',!(tbankmode=="Cash"));
    Erp.SetDisplay('@helper_chequedrawnon',!(tbankmode=="Cash"));
    Erp.SetDisplay('lblDrawnOn',!(tbankmode=="Cash"));
    Erp.SetDisplay('lblChqDate',!(tbankmode=="Cash"));
    Erp.SetDisplay('lblRefNo',!(tbankmode=="Cash"));
    Erp.SetDisplay('trBankDetails',!(tbankmode=="Cash"));
    if(tbankmode == "Cheque")
    {
      Erp.SetLabel('lblChqDate',"Cheque Date");
      Erp.SetLabel('lblRefNo',"Cheque No");
    }
    else if(tbankmode == "BT")
    {
      Erp.SetLabel('lblChqDate',"Bank Transfer Date");
      Erp.SetLabel('lblRefNo',"Reference No");
    }
  }
  //if(db_fld_1=="Cheque")
  //Erp.SetLabel('@helper_tmreferenceno','Cheque No');
  //else if  (db_fld_1=="BT")
  //Erp.SetLabel('@helper_tmreferenceno','Reference No');
}
function Toggle_exportdetails()
{
  var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code =="WPAY" || ex_Code == "WOPAY")
    isExport=true;
  Erp.SetDisplay('@export_billno',isExport);
  Erp.SetDisplay('@export_billdate',isExport);
  Erp.SetDisplay('@exportport',isExport);
  Erp.SetDisplay('trExportDetails',isExport);
 // Erp.SetMandatory('@export_billno',isExport);
  //Erp.SetMandatory('@export_billdate',isExport);
  //Erp.SetMandatory('@exportport',isExport);
}
function Toggle_importdetails()
{
  var isImport=false;
  var im_Code=Fn.ToUpperCase( db_fld_4);
  if(im_Code =="IMPG" )
    isImport=true;
  Erp.SetDisplay('@import_billofvalue',isImport);
  Erp.SetDisplay('@import_billno',isImport);
  Erp.SetDisplay('@import_billdate',isImport);
  Erp.SetDisplay('@importport',isImport);
  Erp.SetDisplay('trImportDetails',isImport);
  Erp.SetMandatory('@import_billofvalue',isImport);
  Erp.SetMandatory('@import_billno',isImport);
  Erp.SetMandatory('@import_billdate',isImport);
  Erp.SetMandatory('@importport',isImport);
}
function refreshtm(agcode)
{
  var _agCode=db_fld_6;
  if(!Fn.IsEmpty(agcode) )
    _agCode=agcode ;
  if(_agCode=="CH")
    Erp.SetParam('@helper_tm','Filter','Filter_cash');
  else if(_agCode=="BA")
    Erp.SetParam('@helper_tm','Filter','Filter_No_cash');
}
function refreshtm1()
{
  var agcode=db_fld_6;
  /*if(!GloadTaxes)
    Erp.SetFieldValue('@helper_tm','');*/
  refreshtm(agcode);
}
function SiteOUChanged(elem,data,field)
{
  if (data!=null && data.Keys != undefined)
    if (data.Keys.length>0)
      Erp.SetFieldValue('@currency',data.Keys[0]);
  //Currency  
  Erp.SetFieldValue('@previoustr','');
  Erp.SetFieldValue('@taxreg','');
  Erp.SetParam('@previoustr','taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetParam('@taxreg','OU',Erp.GetFieldValue("@siteou"));
  Erp.SetFieldValue('@transactionseries','');
  Erp.SetParam('@transactionseries','OU',Erp.GetFieldValue("@siteou"))
}
function SaveCountryState()
{
  OUCountry=db_fld_8;
  OUState=db_fld_9;
}
function helperAMChanged(elem,data,field)  //party
{
  var tscnmode=Erp.GetFieldValue('@modeoftransactionnote');
   
   old_supplytype='';
 old_invtype='';
 old_supplycat='';
 
  SaveHelperState();
  if(WhetherIncomingSupplyType()){
  }
  else
    Erp.SetFieldValue('@pos',helper_OUState);
  if (vType=='S' || vType=='DC'  || vType == 'PI' || vType == 'Q'  || vType == 'BOS'   || vType == 'SO' )
  {
    Erp.SetFieldValue('@salesconsigneeam',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    // Erp.SetFieldValue('@isexport',db_fld_10);
    Toggle_exportdetails();
  }
  if(vType=='R' )
  {
    //console.log(Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.SetParam('gridAgainstBill','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.Grid.Filter('gridAgainstBill','filter_sales',false);
    Erp.Grid.Refresh('gridAgainstBill');
  }
  if(vType=='M')
  {
    //console.log(Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    //toggleMatchingGrids(true);
    Erp.SetParam('gridAgainstBill','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.Grid.Filter('gridAgainstBill','filter_matching',false);
    Erp.Grid.Refresh('gridAgainstBill');
    Erp.SetParam('dgAgainstCN','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.Grid.Refresh('dgAgainstCN');
    /*Erp.SetParam('dgAgainstDN','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.Grid.Refresh('dgAgainstDN');*/
  }
  if(vType=='PY')
  {
    //console.log(Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.SetParam('gridAgainstBill','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.Grid.Filter('gridAgainstBill','Filter_payment',false);
    Erp.Grid.Refresh('gridAgainstBill');
  }
  if(!Fn.IsEmpty(db_fld_11) && vType != 'BOS')
    Erp.SetFieldValue('@gstsupplycategory',db_fld_11);
  SetPreviousTRReference();
  ChangeSupplyType();
  
  setTransType();
  resetAdvanceInv();
  Erp.Grid.DataBind('dgAdvInv',[]);
  
  if(vType != 'S'){
  if (vType=='P' || Fn.Eq(Erp.GetFieldValue('@modeoftransactionnote'), "AgainstPurchase") ){
  var taxpayer=db_fld_13;
  if(Fn.Eq(taxpayer,'CTP')){
    Erp.SetFieldValue('@gstsupplycategory','compositesupply');
    Erp.SetEnable('@gstsupplycategory',false);
    GSC_Changed();
  }
  else
     Erp.SetEnable('@gstsupplycategory',true);
  }
  }
  
  if (vType=='S' || vType=='P'  || vType=='AP' || subvType=='AR'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstSales" &&  (vType=='CN' || vType=='DN')) || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'SO'  )
  {
  var isCust=false;
  var invCode=db_fld_4;
  if (vType=='S' || subvType=='AR' || vType=='R'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstSales" &&  (vType=='CN' || vType=='DN')) || vType == "RV"  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
    isCust=true;
    
  var custLable=Erp.GetLabel('lblParty');
  var msgAlert ='';
  if(Fn.Eq(taxpayer,'SEZ') && !(invCode == 'SEWOP' || invCode == 'SEWP')){
    msgAlert+="Since "+custLable+" Type Is 'Special Economic Zone' ,Please Select Invoice Type As 'SEZ Exports with payment' Or 'SEZ exports without payment' \r\n ";
  }
 if(Fn.Eq(taxpayer,'FNE')){
   if(isCust && !(invCode == 'WOPAY' || invCode == 'WPAY'))
    msgAlert+="Since "+custLable+" Type Is 'Foreign Entity' ,Please Select Invoice Type As 'Export with  payment of GST' Or 'Export without  payment of GST' \r\n ";
   else if( !isCust && !(invCode == 'IMPS' || invCode == 'IMPG'))
      msgAlert+="Since "+custLable+" Type Is 'Foreign Entity' ,Please Select Invoice Type As 'Import Of Goods' Or 'Import Of Services' \r\n ";
  }
  
   if( vType == "P" && !Fn.IsEmpty( Erp.GetFieldValue('@tbl_erp_t_helper_am')))
  {
    if(Fn.IsEmpty( db_fld_0)  && !Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')){
      msgAlert+="Since GSTIN of this vendor is not available, You should mark this transaction for Reverse Charge. \r\n ";
          }
     
  }
  
  if(!Fn.IsEmpty(msgAlert))
  {
    Erp.ShowMessage(msgAlert,'alert');
  }
  else
    Erp.HideMessage();
  
  
  }
  toggle_PrevGstB2cl();
}
function resetAdvanceInv()
{
  if(vType == "S" || vType =="P" || vType=='DC'  || vType == 'PI' || vType == 'Q'  || vType == 'BOS'   || vType == 'SO'  )
  {
    isinvoiceagainstadvance_changed();
  }
}
function SetPreviousTRReference()
{
  var tscnmode=Erp.GetFieldValue('@modeoftransactionnote');
  if(Fn.Eq(tscnmode, "AgainstPurchase"))
    tscnmode="P,E";
  else{
    if(vType == 'RV')
      tscnmode="R";
    else
      tscnmode="S";
  }
  if (vType=='DN')
  {
    Erp.SetParam('@previoustr','Party',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.SetParam('@previoustr','TMode',tscnmode);
    Erp.SetParam('@previoustr','DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
    if(Fn.Eq(Erp.GetFieldValue('@modeoftransactionnote'), "AgainstPurchase")){
      Erp.SetParam('@previoustr','_fc','lu_PreviousPurchaseReference');
      Erp.SetParam('@helper_am','_fc','PurchaseParty');
    }
    else{
      Erp.SetParam('@previoustr','_fc','lu_PreviousSalesReference');
      Erp.SetParam('@helper_am','_fc','SalesParty');
    }
  }
  else if (vType=='CN')
  {
    Erp.SetParam('@previoustr','Party',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.SetParam('@previoustr','TMode',tscnmode);
    Erp.SetParam('@previoustr','DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
    if(Fn.Eq(Erp.GetFieldValue('@modeoftransactionnote'), "AgainstPurchase")){
      Erp.SetParam('@previoustr','_fc','lu_PreviousPurchaseReference');
      Erp.SetParam('@helper_am','_fc','PurchaseParty');
    }
    else{
      Erp.SetParam('@previoustr','_fc','lu_PreviousSalesReference');
      Erp.SetParam('@helper_am','_fc','SalesParty');
    }
  }
  else if (vType=='RV')
  {
    Erp.SetParam('@previoustr','Party',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
    Erp.SetParam('@previoustr','TMode',tscnmode);
    Erp.SetParam('@previoustr','DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
    Erp.SetParam('@previoustr','_fc','lu_PreviousRVReference');
  }
  hideCdNo();
}
function ChangeSupplyType()
{
  var invCode=db_fld_4;
  if ( Fn.Eq(invCode ,"DE")  || Fn.Eq(invCode ,"WPAY") || Fn.Eq(invCode ,"WOPAY") || Fn.Eq(invCode ,"IMPG")  || Fn.Eq(invCode ,"IMPS") || Fn.Eq(invCode ,"SEWP")  || Fn.Eq(invCode ,"SEWOP"))
    Erp.SetFieldValue('@supplytype','IES','Inter-State');
  else
  {
    if(!WhetherIncomingSupplyType() ){
      if(db_fld_9 !=Erp.GetFieldValue('@tbl_erp_t_pos') )
        Erp.SetFieldValue('@supplytype','IES','Inter-State');
      else
        Erp.SetFieldValue('@supplytype','IAS','Intra-State');
    }
    else
    {
      if(helper_OUState !=Erp.GetFieldValue('@tbl_erp_t_pos') )
        Erp.SetFieldValue('@supplytype','IES','Inter-State');
      else
        Erp.SetFieldValue('@supplytype','IAS','Intra-State');
    }
  }
  Erp.TriggerEvent("@supplytype","change",SupplyTypeChanged);
}
function SaveHelperState()
{
  helper_OUState=db_fld_18;
}
function SupplyTypeChanged(elem,data,field)
{
  GloadTaxes=true;
   //console.log("SupplyTypeChanged")
  set_ItemTaxLoaded();
  setTransType();
}
function LoadTaxList()
{
  if (vType=='P' || vType=='E' || vType=='DN' || vType=='S' || vType=='CN' || vType=='R' || vType=='PY'  || subvType=='AR'   || subvType=='AP' || vType=='RV'  || vType=='DC'  || vType == 'PI' || vType == 'Q'  || vType == 'BOS'    || vType == 'SO'  )
  {
     //console.log("LoadTaxList")
    if (!(Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_siteou')) || Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_helper_am')) || Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_supplytype')) || Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_taxreg'))))    
      Erp.LoadVariable('TaxList',taxListLoaded);
  }
}
function taxListLoaded(result)
{
  //console.log(TaxList);
  //taxLoaded=false;
  if (taxLoaded==false)
  {
    CreateTaxColumns();
    taxLoaded=true;
  }
  HideUnhideColumns();
  //console.log("taxListLoaded")
 setTaxes();
  if(loadPrevTr)
    setItemDataToGrid();
}
function CreateTaxColumns()
{
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  if(Erp.Grid._getGridView('gridTI') == null)
    return;
  BeginColumns=Erp.Grid._getGridView('gridTI').get_columns().length;
  for (var i=0; i<TaxList.length;i++)
  {
    var amid="";
    if(vType=='P' || vType=='E' ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY' || vType=='AP')
      amid='inputam';
    else
      amid='outputam';
    var taxcode =Fn.ToUpperCase(TaxList[i]['taxcode']);
    var _taxName=TaxList[i]['taxname'];
    _taxName=Fn.Replace(_taxName,"FULL","");
    var  fldEditable=  Fn.CBool(TaxList[i]['rateindependent']) || WhetherIncomingSupplyType();
    var varGroupName    =taxcode;
    var percentHeader="%";
    var valueHeader="Amt";
    var ITCHeader = "ITC";
    Erp.Grid.AddColumn('gridTI',{
      ColumnName:"taxcol#@rate#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid +'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent']) +'#@' + TaxList[i]['taxgroupcode']  ,HeaderText:'%',ColumnGroupName:varGroupName, Width:30, Editable:fldEditable, Mandatory: false, DataType: 'Decimal',FooterTemplate:"<div class='rightAlign field-title'></div>"}
                      );
    Erp.Grid.AddColumn('gridTI',{
      ColumnName:"taxcol#@val#@" +TaxList[i]['taxcode']+'#@'+ TaxList[i]['tax_pid']+'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'],HeaderText:'Amt',ColumnGroupName:varGroupName, Width:50, Editable: fldEditable, Mandatory: false, DataType: 'Decimal',ItemCss:"rightAlign",FooterTemplate:"<div class='rightAlign field-title'></div>"}
                      );
    Erp.Grid.AddColumn('gridTI',{
      ColumnName:"taxcol#@claimable#@" +TaxList[i]['taxcode'] + '#@'+ TaxList[i]['tax_pid']+'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'],HeaderText:'ITC',ColumnGroupName:varGroupName, Width:50, Editable: fldEditable, Mandatory: false, DataType: 'Decimal',FooterTemplate:"<div class='rightAlign field-title'></div>"}
                      );
  }
  Erp.Grid.AddColumn('gridTI',{
    ColumnName:'DeleteRow',HeaderText:'',ItemTemplate:'<a onclick="delItemRow(this)" class="delRec" title="Delete" href="javascript:void(0)"></a>', Width:20, Editable: false, Mandatory: false, DataType: 'Text'}
                    );
  Erp.Grid.Refresh('gridTI');
}
function WhetherIncomingSupplyType()
{
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  return (vType=='P' || vType=='E' || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY'  || subvType=='AP' );
}
function HideUnhideColumns()
{
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  var trans_interstate=false;
  var trans_intrastate=false;
  if (Erp.GetFieldValue('@tbl_erp_t_supplytype')=='IES')
    trans_interstate=true;
  else
    trans_intrastate=true;
  for (var i=0; i<TaxList.length;i++)
  {
    var amid="";
    if(vType=='P' || vType=='E' ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY' || vType=='AP')
      amid='inputam';
    else
      amid='outputam';
    var taxratehidden =Fn.CBool(TaxList[i]['taxratehidden']);
    var taxvaluehidden =Fn.CBool(TaxList[i]['taxvaluehidden']);
    var _taxcode=Fn.ToUpperCase(TaxList[i]['taxcode']);
    var ratename="taxcol#@rate#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
    var valname="taxcol#@val#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
    var claimablename="taxcol#@claimable#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
    if(vType == 'BOS')
    {
      Erp.Grid.DisplayColumn('gridTI',ratename,false);
      Erp.Grid.DisplayColumn('gridTI',valname,false);
      Erp.Grid.DisplayColumn('gridTI',claimablename,false);
    }
    else if (trans_interstate && Fn.CBool(TaxList[i]['interstate']))
    {
      Erp.Grid.DisplayColumn('gridTI',ratename,!taxratehidden);
      Erp.Grid.DisplayColumn('gridTI',valname,!taxvaluehidden);
      if (WhetherIncomingSupplyType() && vType != 'AR' && vType != 'AP'  && vType!='RV' )
        Erp.Grid.DisplayColumn('gridTI',claimablename, !taxvaluehidden);
      else
        Erp.Grid.DisplayColumn('gridTI',claimablename, false);
    }
    else if (trans_intrastate && Fn.CBool(TaxList[i]['intrastate']))
    {
      Erp.Grid.DisplayColumn('gridTI',ratename,!taxratehidden);
      Erp.Grid.DisplayColumn('gridTI',valname,!taxvaluehidden);
      if (WhetherIncomingSupplyType() && vType != 'AR' && vType != 'AP'  && vType!='RV'  )
        Erp.Grid.DisplayColumn('gridTI',claimablename, !taxvaluehidden);
      else
        Erp.Grid.DisplayColumn('gridTI',claimablename, false);
    }
    else
    {
      Erp.Grid.DisplayColumn('gridTI',ratename,false);
      Erp.Grid.DisplayColumn('gridTI',valname,false);
      Erp.Grid.DisplayColumn('gridTI',claimablename,false);
    }
  }
  Erp.Grid.DisplayColumn('gridTI','itc_elg',WhetherIncomingSupplyType());
  if(vType == 'AR' ||  vType == 'AR'  || vType=='RV' )
    Erp.Grid.DisplayColumn('gridTI','itc_elg',false);
  Erp.Grid.DisplayColumn('gridTI','taxablevalue',false);
  //(WhetherIncomingSupplyType() && vType != "P")
  Erp.Grid.DisplayColumn('gridTI','othercharge',true);
  //(WhetherIncomingSupplyType() && vType != "P")
  Erp.Grid.DisplayColumn('gridTI','amti',Fn.CBool(db_fld_19));
  //
}
function attachDocumentsChanged()
{
  if (Fn.CBool(db_fld_20))
    Erp.SetDisplay('panelDocuments',true);
  else
    Erp.SetDisplay('panelDocuments',false);
}
function TDSApplicableChanged()
{
  Erp.SetDisplay('@tds_am' ,Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_istdsapplicable')));
  Erp.SetDisplay('@tdsgrossamount' ,Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_istdsapplicable')));
  Erp.SetDisplay('@tdsamount' ,Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_istdsapplicable')));
}
///// LOAD FUNCTION
Erp.OnLoad.Register(LoadFunction);
function LoadFunction(){
 //  Erp.SetDisplay("gridTI",false);
  Erp.SetEnable("@supplytype",false);
  Erp.SetDisplay("trInvisible",false);
  vType=Fn.ToUpperCase(Fn.GetProp('vtype')) ;
  subvType=Fn.ToUpperCase(Fn.GetProp('subvtype')) ;
  if(Fn.IsEmpty(subvType))
    Erp.SetFieldValue('@vt',voucherTypeID);
  else{
    Erp.SetFieldValue('@vt',subvoucherTypeID);
    vType=subvType;
  }
  if (Erp.LayoutMode=='A'){
    if(vType != 'BOS')
      Erp.SetFieldValue('@gstsupplycategory','Taxable');
    Erp.SetFieldValue('@rs','Approved');
    Erp.SetFieldValue('@dot',Fn.Today());
  }
  //  Erp.SetEnable('@vt',false);
  Erp.SetEnable('@currency',false);
  Erp.Grid.EnableGridTracking('gridTI',false);
  Erp.Grid.Serialization('gridTI',true,true);
  Erp.Grid.Serialization('gridOC',true,true);
  Erp.Grid.Serialization('gridAgainstBill',true,true);
  Erp.Grid.Serialization('dgAgainstCN',true,true);
  Erp.Grid.Serialization('dgAdvInv',true,true);
  //Erp.Grid.Serialization('dgAgainstDN',true,true);
  attachDocumentsChanged();
  TDSApplicableChanged();
  SaveCountryState();
  SaveHelperState();
  ManipulateUI();
  Togglepercentage();
  Manipulate_gridOC_Columns();
  refreshtm();
  Toggletransactiondetails();
  Erp.SetDisplay('@dot' ,(vType=='P'));
  Erp.SetDisplay('lblDot' ,(vType=='P'));
  Erp.SetParam('gridAgainstBill','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
  Erp.SetParam('dgAgainstCN','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
  // Erp.SetParam('gridAgainstBill','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
  if(vType == 'R'){
    Erp.SetDisplay('gridAgainstBill',true);
    Erp.Grid.Filter('gridAgainstBill','filter_sales',false);
  }
  else if(vType == 'M')
  {
    Erp.Grid.Filter('gridAgainstBill','filter_matching',false);
  }
  else if(vType == 'PY'){
    Erp.SetDisplay('gridAgainstBill',true);
    Erp.Grid.Filter('gridAgainstBill','Filter_payment',false);
  }
  //Erp.SetParam('dgAgainstCN','partyid',Erp.GetFieldValue('@tbl_erp_t_helper_am'));
  Erp.SetDisplay('lblTaxISUnder' ,(vType=='S' || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  ));
 // Erp.SetDisplay('@helper_tdsamount' ,(vType=='R' || vType=='PY'));
  Erp.SetDisplay('@helper_am2' ,(vType=='R' || vType=='PY' ));
  toggleTDSAccount();
  toggleMatchingGrids(false);
  toggleTaxPaid();
  toggleEcom();
  TaxableColumnsDisplay();
  Erp.SetDisplay('lblInvoiceNo' ,(vType!='S'  && vType!='DC' && vType != 'PI' && vType != 'Q'   && vType != 'BOS'   && vType != 'SO'  ));
  Erp.SetDisplay('lblModeOfTransc' ,(vType=='CN' || vType=='DN'));
  Erp.SetDisplay('fldmodeoftransactionnote' ,(vType=='CN' || vType=='DN'));
  Erp.SetDisplay('trModeOfT' ,(vType=='CN' || vType=='DN'));
  if(vType=='P' || vType=='E'   ){
    Erp.SetDisplay('lblInvoiceNo' ,true);
    Erp.SetDisplay('@purchaseinvoiceno' ,true);
    Erp.SetLabel('lblInvoiceNo' ,"Received Invoice No");
    Erp.SetMandatory('@purchaseinvoiceno' ,true);
    Erp.SetDisplay('@purchaseinvoicedate' ,true);
    Erp.SetMandatory('@purchaseinvoicedate' ,true);
  }
  if(Erp.LayoutMode == "A"){
    Erp.SetFieldValue('@voucherdate',Fn.Now());
    Erp.SetDisplay('btn_filed',false);
  }
  if (vType=='S' || subvType=='AR' || vType=='R'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstSales" &&  (vType=='CN' || vType=='DN')) || vType == "RV"  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
  {
    Erp.SetLabel("lblParty","Customer");
  }
  else if (vType=='P' || vType=='E' || vType=='PY' || subvType=='AP'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstPurchase" &&  (vType=='CN' || vType=='DN')))
  {
    Erp.SetLabel("lblParty","Vendor");
  }
  Erp.SetDisplay('lblTaxConsideration' ,(vType=='RStopped' || vType=='ARStopped'));
  Erp.SetDisplay('@taxconsideration' ,(vType=='RStopped' || vType=='ARStopped'));
  if(Erp.LayoutMode == "A")
    Erp.SetFieldValue("@taxconsideration" ,"Exclusive");
  if(vType=='PY' )
    Erp.SetParam('@helper_am2','_fc','TDSAM');
  if(Erp.LayoutMode == "A" && !Fn.IsEmpty(Fn.GetProp("_cfl")))
  {
    Erp.SetFieldValue("@siteou",Fn.GetProp("_loc"));
    Erp.SetEnable("@siteou",false);
    Erp.SetFieldValue("@helper_am",Fn.GetProp("_prty"));
    Erp.SetEnable("@helper_am",false);
    helperAMChanged();
  }
  if(vType=='CN' || vType=='DN'  )
  {
    Erp.SetDisplay("trBalances",true);
    Erp.SetDisplay("btnCrBal",true);
    Erp.SetDisplay("btnDrBal",true);
    Erp.SetDisplay("@modeoftransactionnote",true);
    Erp.SetDisplay("trModeOfT",true);
    PrevTR_Disable();
  }
  else
  {
    Erp.SetDisplay("trBalances",false);
    Erp.SetDisplay("btnCrBal",false);
    Erp.SetDisplay("btnDrBal",false);
    Erp.SetDisplay("@modeoftransactionnote",false);
    Erp.SetDisplay("trModeOfT",false);
  }
  Erp.SetDisplay("trBalances",false);
  if(Fn.IsEmpty(Erp.GetFieldValue("@previoustr")))
  {
    Erp.SetDisplay("btnCrBal",false);
    Erp.SetDisplay("btnDrBal",false);
  }
  else
  {
    Erp.SetDisplay("btnCrBal",true);
    Erp.SetDisplay("btnDrBal",true);
    fetchCrDrBalance();
  }
  hideCdNo();
  HideUnhideColumns();
  SetLabelsVoucherWise();
  if(vType =="S" || vType =="P" || vType == "E" || vType == "CN" || vType == "DN"  || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'BOS'    || vType == 'SO' || vType == 'AR'    || vType == 'AP'  )
    Erp.SetMandatory('@invoicetype',true);
  else
    Erp.SetMandatory('@invoicetype',false);
  Erp.TriggerEvent('@invoicetype','change');
  Erp.SetParam('@helper_am','_showbtns','1');
  Erp.SetParam('@salesconsigneeam','_showbtns','1');
  Erp.SetParam('@exportport','_showbtns','1');
  Erp.SetParam('@exportport','Title','Export Port');
  Erp.SetParam('@importport','_showbtns','1');
  Erp.SetParam('@importport','Title','Import Port');
  Erp.SetParam('@duedatescheme','_showbtns','1');
  Erp.SetParam('@duedatescheme','Title','Due Date');
  Erp.SetParam('@taxreg','OU',Erp.GetFieldValue("@siteou"));
  Erp.SetParam('@transactionseries','OU',Erp.GetFieldValue("@siteou"));
  	Erp.SetParam('@transactionseries','taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetParam('@transactionseries','vtddl',Erp.GetFieldValue("@vt"));
  Erp.SetParam('@previoustr','taxreg',Erp.GetFieldValue("@taxreg"));
  
   Erp.SetParam('@transportmode','_showbtns','1');
  
  isinvoiceagainstadvance_changed();
  Erp.SetDisplay("pnlAdvanceInv",false);
  if(vType == "P" || vType == "E")
    Erp.SetButtonLabel("btnAdvInv","Advance Payment");
  
   
  
  if(vType == "S" || vType == "BOS" || vType == "CN"  || vType == "DN"){
    Erp.SetDisplay("@defaulttransactionbank",true);
    if(!Fn.IsEmpty(DefaultTransBank) && Erp.LayoutMode=="A")
    Erp.SetFieldValue('@defaulttransactionbank',DefaultTransBank);

  }
  else
  {
        Erp.SetDisplay("@defaulttransactionbank",false);
  }
  
    if((subvType=='AR' || subvType=='AP' )){
    Erp.SetDisplay("invDetails",true);
    Erp.SetDisplay("@invoicetype",true);
    Erp.SetDisplay("lnlInvType",true);
      
      Erp.SetDisplay("lblInvoiceNo",false);
    Erp.SetDisplay("@purchaseinvoiceno",false);
    Erp.SetDisplay("@previoustr",false);
          Erp.SetDisplay("@purchaseinvoicedate",false);
    Erp.SetDisplay("lblCdNo",false);
    Erp.SetDisplay("@purchasecdnumber",false);
      Erp.SetDisplay("@purchasecddate",false);
      Erp.SetDisplay("lblInvoiceNo",false);
      
     if(subvType=='AR' )
 Erp.SetParam('@invoicetype','_fc','lu_outward');
      else if(subvType=='AP' )
Erp.SetParam('@invoicetype','_fc','lu_Inward');
       
    }
  Erp.SetParam(window,'taxreg',Erp.GetFieldValue("@taxreg"));
    
   var taxpayer=db_fld_13;
  if(Fn.Eq(taxpayer,'CTP')){
    
    Erp.SetEnable('@gstsupplycategory',false);
    
  }
  
  if(vType == 'CN' || vType =='DN' || vType=='RV')
  {
    Erp.SetDisplay('trModeOfT',true);
    
    Erp.SetDisplay('@modeoftransactionnote',(vType == 'CN' || vType =='DN' ));
    Erp.SetDisplay('lblModeOfTransc',(vType == 'CN' || vType =='DN' ));
    pregst_changed();
    
  }
  
   if(vType == 'R' || vType =='PY')
  {
     Erp.SetDisplay("lblInvoiceNo",false);
    Erp.SetDisplay("@purchaseinvoiceno",false);
    Erp.SetDisplay("@previoustr",false);
          Erp.SetDisplay("@purchaseinvoicedate",false);
    if (vType=='R' ){
      Erp.SetLabel("lbl_bank","Received In");
      Erp.SetLabel("lblAmt","Receipt Amount");
    }
    
    Erp.SetDisplay('@helper_tdsamount' ,false);
     Erp.SetDisplay('gridAgainstBill',true);
    Erp.SetDisplay('pnlAgainstBill',true);
    
    if(vType =='PY'){
      Erp.SetDisplay("invDetails",true);
      
    Erp.SetDisplay("@invoicetype",true);
    Erp.SetDisplay("lnlInvType",true);
    }
    Erp.SetDisplay('lblTdsAmt' ,true);
     Erp.SetDisplay('@helper_tdsamount' ,true);
  }
}
function ManipulateUI()
{
  if (Erp.LayoutMode=='A')
  {
    Erp.SetDisplay('trAccountEntry',false)
    Erp.SetFieldValue('@invoicetype',RegInvoiceType);
    

  }
  else
  {
    Erp.SetDisplay('trAccountEntry',true)
  }
  
      if(vType == 'BOS')
      Erp.SetEnable('@invoicetype',false);
  
  var tm=Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstPurchase");
  var tm1=Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstSales");
  
  Erp.SetDisplay('trExportDetails',false);
  Erp.SetDisplay('trImportDetails',false);
  Erp.SetDisplay('trTDS',false);

  if (vType=='P' || vType=='E' ||  vType=='DN' || vType=='R'    || subvType=='AR'  || vType == 'PY'  || vType=='AP'  || vType=='RV' )
  {
    Erp.SetDisplay('lblShippingTo',false);
    Erp.SetDisplay('@salesconsigneeam',false);
    if ( vType=='DN' )
    {
      Erp.SetDisplay('@previoustr',true);
      Erp.SetDisplay('@purchaseinvoiceno',false);
      Erp.SetDisplay('@purchaseinvoicedate',false);
      Erp.SetLabel('lblInvoiceNo','Previous Invoice No');
    }
    else
    {
      Erp.SetDisplay('@previoustr',false);
      if(vType == 'PY'  || vType=='AP'){
        Erp.SetDisplay('@purchaseinvoiceno',false);
        Erp.SetDisplay('@purchaseinvoicedate',false);
      }
      else
      {
        Erp.SetDisplay('@purchaseinvoiceno',true);
        Erp.SetDisplay('@purchaseinvoicedate',true);
        Erp.SetLabel('lblInvoiceNo','Invoice No');
      }
    }
    //Erp.SetDisplay('trTDS',true);
    if (vType=='R'  || subvType=='AR'  || vType=='RV' )
      Erp.SetParam('@helper_am','_fc','SalesParty');
    else if (vType=='DN'){
      if(Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstPurchase"))
        Erp.SetParam('@helper_am','_fc','PurchaseParty');
      else
        Erp.SetParam('@helper_am','_fc','SalesParty');
     
    }
    else
      Erp.SetParam('@helper_am','_fc','PurchaseParty');
    
    Erp.SetParam('@invoicetype','_fc','lu_Inward');
  }
  else if (vType=='S' ||  vType=='CN'  || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'BOS'   || vType == 'SO'   )
  {
    if ( vType=='CN')
    {
      Erp.SetDisplay('@previoustr',true);
      Erp.SetLabel('lblInvoiceNo','Previous Invoice No');
      Erp.SetDisplay('lblShippingTo',false);
      Erp.SetDisplay('@salesconsigneeam',false);
      if(Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstPurchase"))
        Erp.SetParam('@helper_am','_fc','PurchaseParty');
      else
        Erp.SetParam('@helper_am','_fc','SalesParty');
     
    }
    else
    {
      Erp.SetDisplay('@previoustr',false);
      Erp.SetLabel('lblInvoiceNo','Invoice No');
      Erp.SetDisplay('lblShippingTo',true);
      Erp.SetDisplay('@salesconsigneeam',true);
      Erp.SetParam('@helper_am','_fc','SalesParty');
    }
    
    
    
    Erp.SetDisplay('@purchaseinvoiceno',false);
    Erp.SetDisplay('@purchaseinvoicedate',false);
    Erp.SetDisplay('trTDS',false);
    Erp.SetParam('@salesconsigneeam','_fc','SalesParty');
    Erp.SetParam('@invoicetype','_fc','lu_outward');
  }
  else if (vType=='M' )
    Erp.SetParam('@helper_am','_fc','MatchingParty');
  else  if ( vType=='RV')
  {
    Erp.SetDisplay('@previoustr',true);
    Erp.SetLabel('lblInvoiceNo','Previous Invoice No');
    Erp.SetDisplay('lblShippingTo',false);
    Erp.SetDisplay('@salesconsigneeam',false);
    if(Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstPurchase"))
      Erp.SetParam('@helper_am','_fc','PurchaseParty');
    else
      Erp.SetParam('@helper_am','_fc','SalesParty');
    Erp.SetDisplay('@purchaseinvoiceno',false);
    Erp.SetDisplay('@purchaseinvoicedate',false);
    Erp.SetDisplay('trTDS',false);
  }
  if (vType=='P' || vType=='E' || vType=='S' || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'BOS'    || vType == 'SO'  )
  {
    /*if(vType=='P' || vType=='E' )
      Erp.SetDisplay('trImportDetails',true);*/
    Erp.SetDisplay('lblDueDate',true);
    Erp.SetDisplay('@duedate',true);
    Erp.SetDisplay('lblDotScheme',true);
    Erp.SetDisplay('@duedatescheme',true);
  }
  else
  {
    Erp.SetDisplay('lblDueDate',false);
    Erp.SetDisplay('@duedate',false);
    Erp.SetDisplay('lblDotScheme',false);
    Erp.SetDisplay('@duedatescheme',false);
  }
  
     setVoucherMode();
  
  Erp.SetDisplay('lblReasonForCDN',( vType=='CN' || vType=='DN' || vType=='RV'));
  Erp.SetDisplay('trReasonCDN',( vType=='CN' || vType=='DN' || vType=='RV'));
  Erp.SetMandatory('@cdnreason',( vType=='CN' || vType=='DN' || vType=='RV'));
  if (vType=='CN')
    Erp.SetLabel('lblReasonForCDN','Credit Note Reason');
  else if (vType=='DN')
    Erp.SetLabel('lblReasonForCDN','Debit Note Reason');
  else if (vType=='RV')
    Erp.SetLabel('lblReasonForCDN','Refund Voucher Reason');
  
  var isAdvance=Fn.CBool( Fn.GetProp('isadvance'));
  /* if(isAdvance && Erp.LayoutMode == "A"){
    Erp.SetFieldValue('@isadvance',true);
      Erp.SetDisplay('@isadvance',true); 
  }
  else
    Erp.SetDisplay('@isadvance',false);*/
  Erp.SetDisplay('@isadvance',( vType=='R'  || vType=='PY'  || subvType=='AR' || subvType=='AP' || vType=='RV'  ));
  Erp.SetDisplay('@advanceamount',( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' ));
  Erp.SetDisplay('trAdvance',( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' ));
  Erp.SetDisplay('trBankDetails',( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' ));
  Erp.SetDisplay('trBankDetails1',( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' ));
  Erp.SetDisplay('trReceiptAmt',( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' ));
  Erp.SetDisplay('pnlAgainstBill',( vType=='R' ||  vType=='PY' ));
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  if( vType=='R'  || vType=='S' ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstsales")) || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'  || vType == 'SO'   )
    Erp.SetLabel('lblpay','Total Receivable');
  SetPreviousTRReference();
  ManipulateMatchingUI();
  Erp.SetDisplay('tblSupplydetails',( vType != 'PY' ));
  Erp.SetDisplay('gridTI',( vType != 'PY' ));
  if( vType=='R' || vType=='PY' || subvType=='AR' || subvType=='AP' || vType=='RV' )
  {
    Erp.SetDisplay('trTDS',false);
    IsAdvanceChecked();
  }
  if (subvType=='AR' || subvType=='AP'  || vType=='RV'   || vType=='R'   || vType=='PY' )
  {
    Erp.SetDisplay('lblShippingTo',false);
    Erp.SetDisplay('@salesconsigneeam',false);
    if(vType=='RV'){
      Erp.SetDisplay('@previoustr',true);
      Erp.SetDisplay("invDetails",true);
    }
    else
      Erp.SetDisplay('@previoustr',false);
    
    Erp.SetFieldValue('@isadvance',true);
    Erp.SetEnable('@isadvance',false);
    Erp.SetDisplay('lblTdsAmt',false);
    Erp.SetDisplay('lblTdsAct',false);
    if (subvType=='AR' || vType=='RV'  || vType=='R' ){
      Erp.SetLabel("lbl_bank","Received In");
      Erp.SetLabel("lblAmt","Receipt Amount");
    }
    else{
      Erp.SetFieldValue('@isreversechargeapplicable',true);
      Erp.SetEnable('@isreversechargeapplicable',false);
      Erp.SetLabel("lbl_bank","Paid In");
      Erp.SetLabel("lblAmt","Paid Amount");
    }
        
    Erp.SetMandatory('@helper_am1',(subvType=='AR' || subvType=='AP' || vType=='R' || vType=='PY'));
    Erp.SetMandatory('@helper_tm',(subvType=='AR' || subvType=='AP' || vType=='R' || vType=='PY'));
    
    Erp.SetMandatory('@helper_amount1',(vType=='R' || vType=='PY'));
    
  }
  
  else
    Erp.SetDisplay("invDetails",true);
  if(vType == 'AR' ||  vType == 'AR' || vType=='RV'  )
    Erp.SetVisible("gridOC" ,  false);
  else
    Erp.SetVisible("gridOC" ,  true);
  //Fn.CBool(db_fld_22)
  if( vType=='S'  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'  || vType == 'SO'   ){
    if(vType == 'BOS' )
      Erp.SetParam('@gstsupplycategory','_fc','lu_SalesCategoryBOS');
    else 
      Erp.SetParam('@gstsupplycategory','_fc','lu_SalesCategory');
    
    Erp.SetDisplay("@isinvoiceagainstadvance",true);
    Erp.SetDisplay("btnAdvInv",true);
    if(vType=='S'   || vType == 'BOS'  )
    Erp.SetDisplay("trAgainstAdvance",true);
    else
        Erp.SetDisplay("trAgainstAdvance",false);
  }
  else   if( vType=='P' ){
    Erp.SetParam('@gstsupplycategory','_fc','lu_PurchaseCategory');
    Erp.SetDisplay("@isinvoiceagainstadvance",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
    Erp.SetDisplay("trAgainstAdvance",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
    Erp.SetDisplay("btnAdvInv",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
    $("#fld_advance-Ctr").find(".field-lbl").html("Is Against Advance Payment");
    $("#fld_invNo-Ctr").find(".field-lbl").html("Advance Payment No");
  }
  else{
    Erp.SetDisplay("@isinvoiceagainstadvance",false);
    Erp.SetDisplay("btnAdvInv",false);
    Erp.SetDisplay("trAgainstAdvance",false);
  }
  if(vType == "AR" || vType == "AP"  || vType == "P"  || vType=='RV'  || vType == "R"  || vType=='PY' )
  {
    if(vType == "AR")
    Erp.SetParam('@gstsupplycategory','_fc','lu_SalesCategory');
    
    Erp.SetDisplay("@ecomtran",false);
    Erp.SetDisplay("@ecommerceoperatoram",false);
  }
  if(vType=='RV'){
    Erp.SetDisplay('@previoustr',true);
    Erp.SetDisplay('lblInvoiceNo',true);
    Erp.SetDisplay('@invoicetype',false);
    Erp.SetDisplay('lnlInvType',false);
    Erp.SetDisplay('@purchaseinvoiceno',false);
    Erp.SetDisplay('@purchaseinvoicedate',false);
  }
  if(vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'  || vType == 'SO'   ){
    Erp.SetDisplay('@duedatescheme',false);
    Erp.SetDisplay('lblDotScheme',false);
    Erp.SetDisplay('@duedate',false);
    Erp.SetDisplay('lblDueDate',false);
  }
  if(vType == 'BOS' )
  {
  }
  else if(vType == 'S' )
  {
    Erp.SetFieldValue('@gstsupplycategory','Taxable','Taxable');
    Erp.SetEnable('@gstsupplycategory',false);
  }
  Erp.SetDisplay('lblDcType',(vType=='DC'));
    Erp.SetDisplay('@dctype',(vType=='DC'));
    Erp.SetMandatory('@dctype',(vType=='DC'));
  
  Erp.SetDisplay('trTDetails',(vType=='DC' || vType=='S' || vType=='BOS'));
  
  

  
}
function setVoucherMode()
{
  if( Fn.Eq( Fn.GetProp("_nm") ,"s"))
  {
    Erp.SetFieldValue("@modeoftransactionnote","AgainstSales");
    Erp.SetEnable("@modeoftransactionnote",false);
    Erp.SetParam('@helper_am','_fc','SalesParty');
    Erp.SetParam('@invoicetype','_fc','lu_outward');
     Erp.SetMandatory("@previoustr",true);
  SetPreviousTRReference();
  }
  else  if( Fn.Eq( Fn.GetProp("_nm") ,"p"))
  {
    Erp.SetFieldValue("@modeoftransactionnote","AgainstPurchase");
    Erp.SetEnable("@modeoftransactionnote",false);
    Erp.SetParam('@helper_am','_fc','PurchaseParty');
    Erp.SetParam('@invoicetype','_fc','lu_Inward');
     Erp.SetMandatory("@previoustr",true);
  SetPreviousTRReference();
  }
 
}
Erp.OnLoadComplete.Register(LoadCompleteFunction);
function LoadCompleteFunction(){
  Toggle_exportdetails();
  Toggle_importdetails();
  refreshtm1();
  Toggletransactiondetails();
  TaxableColumnsDisplay();
  PrevTR_Disable();
  
  
  if (Erp.LayoutMode=="A")
  {
    oldTaxReg=Erp.GetFieldValue('@taxreg');
  	if (oldTaxReg!='')
	    Erp.TriggerEvent("@taxreg","change");
  }
  toggle_PrevGstB2cl();
setOtherInfo_GST();
}
function OnGridDataBoundOC(gridId,args){
  //completion all data loads events
  CalculateFooterTI('rate');
  CalculateFooterTI('');
  CalculateFooterOC('');
  FinalShowOfTotals();
  CalculateFootergridAgainstBill();
  Erp.Grid.SetFooterText('gridTI','amti',0,'Total');
  Erp.Grid.SetFooterText('gridOC','debitcredit',0,'Total');
}
function OnGridDataBoundTD(gridId,args){
  CalculateFooterAccounts('');
  Erp.Grid.SetFooterText('gridTD','debitcredit',0,'Total');
}
function GridRowDataBoundTI(gridId,args){
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  var TIId=Erp.Grid.GetRecordID('gridTI',args.row);
  for (var i=0; i<TaxList.length;i++)
  {
    var arr=Fn.Filter(TaxInfo,function(r){
      return r.ti_pid==TIId && TaxList[i]['tax_pid']==r.tax_pid;
    }
                     );
    if (arr.length>0)
    {
      var amid="";
      if(vType=='P' || vType=='E' ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY' || vType=='AP')
        amid='inputam';
      else
        amid='outputam';
      var ratename="taxcol#@rate#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      var valname="taxcol#@val#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      var claimablename="taxcol#@claimable#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' +amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      Erp.Grid.SetEditorValue('gridTI',ratename,args.row,Fn.CFlt(arr[0]['taxrate']));
      Erp.Grid.SetEditorValue('gridTI',valname,args.row,Fn.CFlt(arr[0]['taxvalue']));
      Erp.Grid.SetEditorValue('gridTI',claimablename,args.row,Fn.CFlt(arr[0]['claimabletax']));
    }
  }
}
function GridDataBoundTI(gridId,args){
  if(firstLoaded)
    return;
  firstLoaded=true;
  if (vType=='E' || vType=='P' || vType=='CN' || vType == 'R' || vType == 'AR'  || vType=='RV' )
  {
    Erp.Grid.DisplayColumn('gridOC','debitamount',true);
    Erp.Grid.DisplayColumn('gridOC','creditamount',false);
    if (vType == 'R' || vType == 'AR'  || vType=='RV' )
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Receipt');
    else
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Purchase');
    //Erp.SetParam('gridOC','defaultfilter','filter_OtherCharges_Purchase')
  }
  else if (vType=='S' || vType=='DN' || vType == 'PY'  || vType == 'AP'   || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )	
  {
    Erp.Grid.DisplayColumn('gridOC','debitamount',false);
    Erp.Grid.DisplayColumn('gridOC','creditamount',true);
    if (vType == 'PY'  || vType == 'AP')
      Erp.Grid.Filter('gridOC','Filter_OtherCharges_Payment');
    else
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Sales');
    //Erp.SetParam('gridOC','defaultfilter','filter_OtherCharges_Sales')
  }

  
  Erp.Grid.EnableGridTracking('gridTI',true);
  CalculateFooterTI('');
  FinalShowOfTotals();
//  Erp.SetDisplay('gridTI',true);
  
  //Erp.Grid.Refresh('gridOC');
}
function Manipulate_gridOC_Columns()
{
  if(Erp.Grid._getGridView('gridOC') == null)
    return;
  
  if (vType=='E' || vType=='P' || vType=='CN' || vType == 'R'  || subvType=='AR' || vType == 'RV' )
  {
    Erp.Grid.DisplayColumn('gridOC','debitamount',true);
    Erp.Grid.DisplayColumn('gridOC','creditamount',false);
    if (vType == 'R' || vType == 'AR')
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Receipt');
    else
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Purchase');
    //Erp.SetParam('gridOC','defaultfilter','filter_OtherCharges_Purchase')
  }
  else if (vType=='S' || vType=='DN' || vType == 'PY'  || subvType=='AP'  || vType=='DC'  || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
  {
    Erp.Grid.DisplayColumn('gridOC','debitamount',false);
    Erp.Grid.DisplayColumn('gridOC','creditamount',true);
    if (vType == 'PY'  || subvType=='AP' )
      Erp.Grid.Filter('gridOC','Filter_OtherCharges_Payment');
    else
      Erp.Grid.Filter('gridOC','filter_OtherCharges_Sales');
    //Erp.SetParam('gridOC','defaultfilter','filter_OtherCharges_Sales')
  }
}
function CountryRateLoaded(result)
{
  // console.log("result : " + result);
  //console.log("itemrat4ecountry : " + ItemRateCountry);
  Erp.Grid.SetEditorValue('gridTI','rate',Fn.CFlt(ItemRateCountry));
  CalculateRow('item');
  //console.log("CountryRateLoaded");
  ItemTaxRateLoaded();
}
function StateRateLoaded(result)
{
  // console.log("result : " + result);
  //console.log("ItemRateState : " + ItemRateState);
  Erp.Grid.SetEditorValue('gridTI','rate',Fn.CFlt(ItemRateState));
  CalculateRow('item');
  //console.log("StateRateLoaded");
  ItemTaxRateLoaded();
}
function OURateLoaded(result)
{
  //console.log("result : " + result);
  //console.log("ItemRateOU : " + ItemRateOU);
  Erp.Grid.SetEditorValue('gridTI','rate',Fn.CFlt(ItemRateOU));
  CalculateRow('item'); 
  //console.log("OURateLoaded");
  ItemTaxRateLoaded();
}
var Gcrnt_row;
var GloadNext;
var Ggridlength;
function setTaxes()
{
  if(GloadTaxes){
    Ggridlength=Erp.Grid.GetRows('gridTI').length;
    //console.log('Ggridlength : '+Ggridlength);
    GloadNext=true;
    Gcrnt_row=0;
  //  console.log("setTaxes");
    if(Ggridlength > 0)
      loadCorrectTax();
  }
}
function loadCorrectTax()
{
  var ITMID =Erp.Grid.GetEditorValue("gridTI","item",Gcrnt_row);
  if(!Fn.IsEmpty(ITMID)){
    Erp.SetParam(window,'ITMID',ITMID);
    Erp.LoadVariable(['ItemTaxConfig','ItemTaxRate'],ItemTaxRateLoaded);
  }
}
/*function itemTRGLoaded()
{
  Erp.SetParam(window,'TRG',itemTRG);
  Erp.LoadVariable(['ItemTaxConfig','ItemTaxRate'],ItemTaxRateLoaded);
}*/
function ItemTaxRateLoaded()
{
  var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code == "WOPAY" || ex_Code == "SEWOP")
    isExport=true;
  
 // console.log(ItemTaxConfig);
  //  console.log(ItemTaxRate);
  
  var trans_interstate=false;
  if (Erp.GetFieldValue('@tbl_erp_t_supplytype')=='IES')
    trans_interstate=true;
  if(Erp.Grid._getGridView('gridTI') == null)
    return;
  var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
  for (var i=BeginColumns;i<totcols;i++)
  {
    var lColName=Erp.Grid._getGridView('gridTI').get_columns()[i]._data.UniqueName;
    lColName = lColName.split("!~")[1];
    if (Fn.IndexOf(lColName,'#@rate#@')>=0)
    {
      var valColName=Fn.Replace(lColName,'#@rate#@','#@val#@');
      var claimColName=Fn.Replace(lColName,'#@rate#@','#@claimable#@');
      var vtaxpid=lColName.split("#@")[3];
     // console.log(Gcrnt_row);
      var taxable=Erp.Grid.GetEditorValue('gridTI','finaltaxable',Gcrnt_row);
      var calc_tax=0;
      var rate=0;
      //loop through config// then loop through taxrates. if is country wise tax rates then match. if state wise taxrates then match.
      for (var j=0; j<ItemTaxConfig.length;j++)
      {
        if (vtaxpid==ItemTaxConfig[j]['tax_pid'])  //0=taxpid
        {
          for (var k=0; k<ItemTaxRate.length;k++)
          {
            if (vtaxpid==ItemTaxRate[k]['tax_pid'])  //2=taxpid
            {
              rate=0;
              if (Fn.CBool(ItemTaxConfig[j]['iscountrywide'])) //If IsCountryWiseTaxConfig
              {
                if (OUCountry==ItemTaxRate[k]['itemtaxcountry']) //4=Country
                {
                  if (trans_interstate && Fn.CBool(ItemTaxConfig[j]['interstate']))
                    rate=Fn.CFlt(ItemTaxRate[k]['taxrate']);
                  else if (!trans_interstate && Fn.CBool(ItemTaxConfig[j]['intrastate']))
                    rate=Fn.CFlt(ItemTaxRate[k]['taxrate']);
                  else
                    rate=0;
                }
              }
              else if (Fn.CBool(ItemTaxConfig[j]['isstatespecific']))  //If IsStateWiseTaxConfig
              {
                if (OUState==ItemTaxRate[k]['itemtaxstate']) //5=State
                {
                  if (trans_interstate && Fn.CBool(ItemTaxConfig[j]['interstate']))
                    rate=Fn.CFlt(ItemTaxRate[k]['taxrate']);
                  else if (!trans_interstate && Fn.CBool(ItemTaxConfig[j]['intrastate']))
                    rate=Fn.CFlt(ItemTaxRate[k]['taxrate']);
                  else
                    rate=0;
                }
              }
              if (!Fn.CBool(ItemTaxConfig[j]['rateindependent'])) 
              {
                rate=(isExport? 0:rate);
                Erp.Grid.SetEditorValue('gridTI',lColName,Gcrnt_row,rate);
                
                calc_tax=Fn.Round(Fn.CFlt(taxable)*Fn.CFlt(rate)/100,2);
                
                Erp.Grid.SetEditorValue('gridTI',valColName,Gcrnt_row,calc_tax);
                
                if (WhetherIncomingSupplyType())  // Claim only in case of P/E/DN
                  Erp.Grid.SetEditorValue('gridTI',claimColName,Gcrnt_row,calc_tax);
                else
                  Erp.Grid.SetEditorValue('gridTI',claimColName,Gcrnt_row,0);
                
              }
              break;
            }
          }
          break;
        }
      }
    }
  }
  if(GloadNext){
    Gcrnt_row=Gcrnt_row+1;
    if(Gcrnt_row < Ggridlength)
      loadCorrectTax(Gcrnt_row,Ggridlength);
    else
    {
      CalculateRow('item');
      Gcrnt_row=0;
    }
  }
  else
    CalculateRow('item');
}
function CalculateRow(vcolname)
{
  CalcTotals();
  CalcTaxes();
  CalculateFooterTI(vcolname);
  CalculateFooterTI('');
  FinalShowOfTotals();
}
function GridCellChangedTI(gridId,args){
  var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code == "WOPAY")
    isExport=true;
  
  if (args.colName=='amti')
  {
    Erp.Grid.SetEditorValue(gridId,'item','');
    //alert(1);
    //var acmaster=Erp.Grid.GetEditorValue(gridId,args.colName);
    //Erp.Grid.SetEditorValue(gridId,'accountmasterti',acmaster);	
  }
  if (args.colName=='item')
  {
    //console.log(args);
    if (Fn.CFlt(Erp.Grid.GetEditorValue(arguments[0],'qty',arguments[1].row))==0)
      Erp.Grid.SetEditorValue('gridTI','qty',1);
    //console.log("IfnUll" );
    //console.log(Fn.IfNull(args.value.Keys));
    // if (vType=="S" || vType=="CN" || (vType=="R" ))
    // {
    // if (!(Fn.IfNull(args.value.Keys) || Fn.IsEmpty(args.value.Keys)))
    {
      if (args.value.Keys.length>0)    
        Erp.Grid.SetEditorValue('gridTI','itemlinenarration',Fn.CStr(args.value.Keys[2]));
      //Dont Remove. Dont Remove.
      //documentation
      //0-hsn
      //1-sac
      //2-default line item narration
      //3-ispurchase item
      //4-issales item
      //5-muname
      //6-mucode
      //7-item nature code
      //8-is rate countrywide
      //9-is rate statewide
      //10-is rate ouwide
      //11-taxgroup id
      //12-itcnoteligible
      
      GloadNext=false;
      Gcrnt_row=args.row;
      if (Fn.CBool(args.value.Keys[8]))
      {
        Erp.SetParam(window,'DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
        Erp.SetParam(window,'Country',OUCountry);
        Erp.SetParam(window,'ITMID',Erp.Grid.GetEditorValue(arguments[0],'item',arguments[1].row));
        Erp.SetParam(window,'TRG',args.value.Keys[11]);
        Erp.LoadVariable(['ItemRateCountry','ItemTaxConfig','ItemTaxRate'],CountryRateLoaded);
      }
      else if (Fn.CBool(args.value.Keys[9]))
      {
        Erp.SetParam(window,'DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
        Erp.SetParam(window,'RateState',OUState);
        Erp.SetParam(window,'ITMID',Erp.Grid.GetEditorValue(arguments[0],'item',arguments[1].row));
        Erp.SetParam(window,'TRG',args.value.Keys[11]);
        Erp.LoadVariable(['ItemRateState','ItemTaxConfig','ItemTaxRate'],StateRateLoaded);
      }
      else if (Fn.CBool(args.value.Keys[10]))
      {
        Erp.SetParam(window,'DOR',Erp.GetFieldValue('@tbl_erp_t_dot'));
        Erp.SetParam(window,'RateOU',Erp.GetFieldValue('@tbl_erp_t_siteou'));
        Erp.SetParam(window,'ITMID',Erp.Grid.GetEditorValue(arguments[0],'item',arguments[1].row));
        Erp.SetParam(window,'TRG',args.value.Keys[11]);
        Erp.LoadVariable(['ItemRateOU','ItemTaxConfig','ItemTaxRate'],OURateLoaded);
      }
      if (Fn.Eq(args.value.Keys[7] ,'CG'))
        Erp.Grid.SetEditorValue('gridTI','itc_elg','cp','cp');
      else if (Fn.Eq(args.value.Keys[7] ,'OG') || Fn.Eq(args.value.Keys[7] ,'INV'))
        Erp.Grid.SetEditorValue('gridTI','itc_elg','ip','ip');
      else if (Fn.Eq(args.value.Keys[7] ,'SER'))
        Erp.Grid.SetEditorValue('gridTI','itc_elg','is','is');
      
        if (Fn.CBool(args.value.Keys[12] ))
        Erp.Grid.SetEditorValue('gridTI','itc_elg','no','no');
      Erp.Grid.SetEditorValue('gridTI','itmnaturecode',args.value.Keys[7]);
      // Erp.Grid.GetEditor('gridTI',"itc_elg").SetParam("goods", ( Fn.ToUpperCase( Fn.CStr(args.value.Keys[7]) )== "SER"  ? "0" : "1"));
    }
    // }
    //Erp.Grid.GetEditorValue(arguments[0],'item',arguments[1].row)
  }
  else if(args.colName=='rate' || args.colName=='ratediscount' || args.colName=='qty')
  {
    CalculateRow(args.colName);
  }
  else if(args.colName=='othercharge' )
  {
    var taxablevalue=Fn.CFlt( Erp.Grid.GetEditorValue('gridTI','taxablevalue'));
    Erp.Grid.SetEditorValue('gridTI','finaltaxable',( taxablevalue+args.value));
    CalculateRow(args.colName);
    CalculateFooterTI('');
    FinalShowOfTotals();
  }
  else if(Fn.IndexOf(args.colName,"taxcol#@rate#@")>-1)
  {
    var taxrate=Erp.Grid.GetEditorValue(gridId,args.colName);
    var taxablevalue=Erp.Grid.GetEditorValue(gridId,'finaltaxable');
    var taxvalue_colname= Fn.Replace(args.colName,"#@rate#@","#@val#@");
    var claimvalue_colname= Fn.Replace(args.colName,"#@rate#@","#@claimable#@");
    var taxvalue=Fn.Round(Fn.CFlt(taxablevalue)*Fn.CFlt([taxrate])/100,2);
    Erp.Grid.SetEditorValue(gridId,taxvalue_colname,taxvalue);
    if (WhetherIncomingSupplyType())  // Claim only in case of P/E/DN
      Erp.Grid.SetEditorValue(gridId,claimvalue_colname,taxvalue);
    else
      Erp.Grid.SetEditorValue(gridId,claimvalue_colname,0);
    FinalShowOfTotals();
  }
  else if(args.colName=='itc_elg' )
  {
    CalcTaxes(args.row);
  }
  // if(Fn.IndexOf(args.colName, "taxcol#@")>-1)
  //{
  CalculateFooterTI('');
  FinalShowOfTotals();
  //}
}
function CalcTotalsAll()
{
  var gridlength=Erp.Grid.GetRows('gridTI').length;
  for(var m=0;m<gridlength;m++)
  {
    CalcTotals(m);
  }
}
function CalcTotals(c_row)
{
  if(!$("#gridTI").isVisible())    
    return;
  
    var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code == "WOPAY")
    isExport=true;

  
  if(Fn.IsEmpty(c_row))
    c_row=Erp.Grid.GetSelectedRow('gridTI');
  if(c_row == null)
    return;
  var gridId='gridTI';
  var vrate=Erp.Grid.GetEditorValue(gridId,'rate',c_row);
  var vdiscountrate=Erp.Grid.GetEditorValue(gridId,'ratediscount',c_row);
  var vfinalrate=vrate-vdiscountrate;
  var vqty=Erp.Grid.GetEditorValue(gridId,'qty',c_row);
  var vtotal=Fn.CFlt(vrate*vqty);
  var vdiscount=Fn.CFlt(vdiscountrate*vqty);
  var vnettotal=Fn.CFlt(vtotal)-Fn.CFlt(vdiscount);
  var vabatement=0;
  var vtaxablevalue=vnettotal-vabatement;
  Erp.Grid.SetEditorValue(gridId,'finalrate',c_row,vfinalrate);
  Erp.Grid.SetEditorValue(gridId,'total',c_row,vtotal);
  Erp.Grid.SetEditorValue(gridId,'discount',c_row,vdiscount);
  Erp.Grid.SetEditorValue(gridId,'nettotal',c_row,vnettotal);
  Erp.Grid.SetEditorValue(gridId,'abatement',c_row,0);
  var supplyCategory=Fn.ToLowerCase( Erp.GetFieldValue('@gstsupplycategory'));
  var amt=vnettotal;
  Erp.Grid.SetEditorValue('gridTI','taxablevalue',c_row,0);
  Erp.Grid.SetEditorValue('gridTI','nilRatedAmt',c_row,0);
  Erp.Grid.SetEditorValue('gridTI','ExemptedAmt',c_row,0);
  Erp.Grid.SetEditorValue('gridTI','NonGSTAmt',c_row,0);
  Erp.Grid.SetEditorValue('gridTI','compositesupplyamount',c_row,0);
  if(supplyCategory == 'nilrated')
    Erp.Grid.SetEditorValue('gridTI','nilRatedAmt',c_row,amt);
  else if(supplyCategory == 'exempted')
    Erp.Grid.SetEditorValue('gridTI','ExemptedAmt',c_row,amt);
  else if(supplyCategory == 'nongst')
    Erp.Grid.SetEditorValue('gridTI','NonGSTAmt',c_row,amt);
  else if(supplyCategory == 'compositesupply')
    Erp.Grid.SetEditorValue('gridTI','compositesupplyamount',c_row,amt);
  var abatement=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','abatement',c_row));
  var nilRatedAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','nilRatedAmt',c_row));
  var ExemptedAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','ExemptedAmt',c_row));
  var NonGSTAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','NonGSTAmt',c_row));
  var compositesupplyamount=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','compositesupplyamount',c_row));
  var taxablevalue=amt-abatement-nilRatedAmt-ExemptedAmt-NonGSTAmt-compositesupplyamount;
  var reverseAmt=1;
  
  Erp.Grid.SetEditorValue('gridTI','taxablevalue',c_row,(taxablevalue*reverseAmt));
  
  var othercharge=Fn.CFlt( Erp.Grid.GetEditorValue('gridTI','othercharge',c_row));
  Erp.Grid.SetEditorValue('gridTI','finaltaxable',c_row,( (taxablevalue*reverseAmt)+othercharge));
  // Erp.Grid.SetEditorValue(gridId,'taxablevalue',vtaxablevalue);
}
function FinalShowOfTotals()
{
  var netTotal=Erp.Grid.CalculateColumn('gridTI','nettotal','SUM');
  Erp.SetLabel('lblTotalAmount',Fn.Round(netTotal,2));
  if(Erp.Grid._getGridView('gridTI') == null)
    return;
  var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
  var taxTotal=0;
  for (var i=BeginColumns;i<totcols;i++)
  {
    var lColName=Erp.Grid._getGridView('gridTI').get_columns()[i]._data.UniqueName;
    lColName = lColName.split("!~")[1];
    if (Fn.IndexOf(lColName,'#@val#@')>=0 && Fn.IndexOf(Fn.ToUpperCase( lColName),'FULLGST') <= 0)
    {
      taxTotal+=Erp.Grid.CalculateColumn('gridTI',lColName,'SUM');
    }
  }
  var totOC_debit = Erp.Grid.CalculateColumn('gridOC','debitamount','SUM');
  var totOC_credit =Erp.Grid.CalculateColumn('gridOC','creditamount','SUM');
  Erp.SetLabel('lblTotalOtherCharges',Fn.Round(totOC_debit+totOC_credit,2));
  if(Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")))
  {
    Erp.SetDisplay("trRCM",true);
    Erp.SetLabel('lblRCMTaxes',Fn.Round(taxTotal,2));
    Erp.SetLabel('lblTotalTaxes',0);
    if(Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_roundingoff')))
      Erp.SetLabel('lblTotalPayable',Fn.Round(netTotal+totOC_debit+totOC_credit,0));
    else
    Erp.SetLabel('lblTotalPayable',Fn.Round(netTotal+totOC_debit+totOC_credit,2));
  }
  else{
    Erp.SetLabel('lblTotalTaxes',Fn.Round(taxTotal,2));
    Erp.SetLabel('lblRCMTaxes',0);
    Erp.SetDisplay("trRCM",false);
    
      if(Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_roundingoff')))
      Erp.SetLabel('lblTotalPayable',Fn.Round(netTotal+taxTotal+totOC_debit+totOC_credit,0));
    else
    Erp.SetLabel('lblTotalPayable',Fn.Round(netTotal+taxTotal+totOC_debit+totOC_credit,2));
  }
}
function CalcTaxes(c_row)
{
  if(Fn.IsEmpty(c_row))
    c_row=Erp.Grid.GetSelectedRow('gridTI');
  if(Erp.Grid._getGridView('gridTI') == null || c_row == null)
    return;
  var noTax=false;
  if((vType == "AR"  || vType=='RV'  ) && Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")))
    noTax=true;
  var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
  for (var i=BeginColumns;i<totcols;i++)
  {
    var lColName=Erp.Grid._getGridView('gridTI').get_columns()[i]._data.UniqueName;
    lColName = lColName.split("!~")[1];
    if (Fn.IndexOf(lColName,'#@rate#@')>=0)
    {
      var valColName=Fn.Replace(lColName,'#@rate#@','#@val#@');
      var claimColName=Fn.Replace(lColName,'#@rate#@','#@claimable#@');
      var rateColName=lColName;
      var rateindependent=Fn.CBool(lColName.split("#@")[7]);
      var itc_elg=Erp.Grid.GetEditorValue('gridTI','itc_elg',c_row);
      if(noTax)
        Erp.Grid.SetEditorValue('gridTI',rateColName,c_row,0);
      if(!rateindependent){
        var taxable=Erp.Grid.GetEditorValue('gridTI','finaltaxable',c_row);
        var rate=Erp.Grid.GetEditorValue('gridTI',lColName,c_row);
        var calc_tax=0  ;
        if(!noTax)
          calc_tax=Fn.Round(Fn.CFlt(taxable)*Fn.CFlt(rate)/100,2);
        Erp.Grid.SetEditorValue('gridTI',valColName,c_row,calc_tax);
        if (WhetherIncomingSupplyType())  // Claim only in case of P/E/DN          
        {
          if(Fn.Eq(itc_elg,'no'))
            Erp.Grid.SetEditorValue('gridTI',claimColName,c_row,0);
          else
            Erp.Grid.SetEditorValue('gridTI',claimColName,c_row,calc_tax);
        }
        else
          Erp.Grid.SetEditorValue('gridTI',claimColName,c_row,0);
      }
      else
      {
        if(Fn.Eq(itc_elg,'no') || noTax)
          Erp.Grid.SetEditorValue('gridTI',claimColName,c_row,0);
      }
    }
  }
}
function CalcTaxesAll()
{
  if(Erp.Grid._getGridView('gridTI') == null)
    return;
  var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
  var gridlength=Erp.Grid.GetRows('gridTI').length;
  for(var m=0;m<gridlength;m++)
  {
    CalcTaxes(m);
  }
}
function GridCellChangedOC(gridId,args){
  DistributeOC();
  CalculateFooterOC('');
  CalculateFooterTI();
  FinalShowOfTotals();
  if (args.colName=='am')
  {
    if (args.value.Keys.length>0)  {
      //isgstapplicable
      //isapportionate_cg
      //isapportionate_og
      //isapportionate_inv
      //isapportionate_ser
      var typeCol="";
      typeCol =Fn.CBool(args.value.Keys[0])+'|';
      typeCol =typeCol+Fn.CBool(args.value.Keys[1])+'|';
      typeCol =typeCol+Fn.CBool(args.value.Keys[2])+'|';
      typeCol =typeCol+Fn.CBool(args.value.Keys[3])+'|';
      typeCol =typeCol+Fn.CBool(args.value.Keys[4]);
      Erp.Grid.SetEditorValue(gridId,'amnature',args.row,typeCol);
    }
  }
}
function GridOCRowAddingOC(gridId,args){
  if (vType=='P' || vType=='E' || vType=='CN' || vType == 'R'  || subvType=='AR' || vType=='RV' )
    Erp.Grid.SetEditorValue(gridId,'debitcredit','D');
  else if (vType=='S' || vType=='DN' || vType=='PY'  || subvType=='AP'  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
    Erp.Grid.SetEditorValue(gridId,'debitcredit','C');
}
function GridCellEditingTI(gridId,args){
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  if (args.colName=='item')
  {
    if (vType=="E" || vType=="P" ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=="AP" || vType=="PY")
      args.editor.SetParam('_fc','ForPurchaseAM');
    else if (vType=="S" || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstsales")) || vType=="R" || vType=="AR"  || vType=='RV'  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'  || vType == 'SO'   || vType == 'RV'  )
      args.editor.SetParam('_fc','ForSalesAM');
   
    // args.editor.SetParam('AM',Erp.Grid.GetEditorValue(arguments[0],'amti',arguments[1].row));
    
    if (vType=='P' || vType=='E' || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY'  || subvType=='AP' )
      args.editor.SetParam('AM',PurchaseAccount);
    else if (vType=='S' || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstsales")) || vType == 'R' || vType == 'AR'  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  || vType == 'RV'  )
      args.editor.SetParam('AM',SalesAccount);
  }
  else if (args.colName=='amti')
  {
    if (vType=="E")
      args.editor.SetParam('_fc','ExpenseAM');
    else if (vType=="P" ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")))
      args.editor.SetParam('_fc','PurchaseAM');
    else if (vType=="S" || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstsales"))  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
      args.editor.SetParam('_fc','SalesAM');
  }
}
function delItemRow(a)
{
  if (confirm('Do you want to delete this line?'))
  {
    Erp.Grid.DeleteRow('gridTI',a,true);
    CalculateFooterTI('qty');
    CalculateFooterTI('');
    FinalShowOfTotals();
    DistributeOC();
  }
}
function delOCRow(a)
{
  if (confirm('Do you want to delete this line?'))
  {
    Erp.Grid.DeleteRow('gridOC',a,true);
    CalculateFooterOC('');
    FinalShowOfTotals();
    DistributeOC();
  }
}
function delAdvInvRow(a)
{
  if (confirm('Do you want to delete this line?'))
  {
    Erp.Grid.DeleteRow('dgAdvInv',a,true);
    CalculateColFooter_Adv();
  }
}
function validateGridTI()
{
  if (Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_supplytype')))
  {
    Erp.ShowMessage('Supply type can not be left blank');
    return false;
  }
  if ( Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_pos')))
  {
    if(vType== "R" ){
      if( Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance')) ){
        Erp.ShowMessage('POS (Point of Supply) can not be left blank');
        return false;
      }
    }
    else{
      Erp.ShowMessage('POS (Point of Supply) can not be left blank');
      return false;
    }
  }
  var trans_interstate=false;
  if (Erp.GetFieldValue('@tbl_erp_t_supplytype')=='IES')
    trans_interstate=true;
  if(Erp.Grid._getGridView('gridTI') == null)
    return;
  var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
  var totrows=Erp.Grid.GetRows('gridTI').length;
  for (var r=0;r<totrows;r++)
  {
    var taxable=Erp.Grid.GetEditorValue('gridTI','taxablevalue',r);
    var vrate=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','rate',r));
    var vdiscountrate=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','ratediscount',r));
    if (vrate<0)
    {
      Erp.ShowMessage('Rate can not be less than 0. Please check line no. ' + (r+1));
      return false;
    }
    if (vdiscountrate<0)
    {
      Erp.ShowMessage('Discount rate can not be negative. Please check line no. ' + (r+1));
      return false;
    }
    if (vdiscountrate>vrate)
    {
      Erp.ShowMessage('Discount can not be more the rate. Please check line no. ' + (r+1));
      return false;
    }
    for (var i=BeginColumns;i<totcols;i++)
    {
      var lColName=Erp.Grid._getGridView('gridTI').get_columns()[i]._data.UniqueName;
      lColName = lColName.split("!~")[1];
      if (Fn.IndexOf(lColName,'#@rate#@')>=0)
      {
        var valColName=Fn.Replace(lColName,'#@rate#@','#@val#@');
        var claimColName=Fn.Replace(lColName,'#@rate#@','#@claimable#@');
        var vtaxpid=lColName.split("#@")[3];
        var vtaxcode=lColName.split("#@")[2];
        var vintrastate=Fn.CBool(lColName.split("#@")[5]);
        var vinterstate=Fn.CBool(lColName.split("#@")[6]);
        var vtaxrate=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI',lColName,r));
        var vtax=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI',valColName,r));
        var vtaxclaim=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI',claimColName,r));
        if (vtaxrate<0)
        {
          Erp.ShowMessage( vtaxcode + ' Rate can not be less than zero. Please check line no. ' + (r+1));
          return false;
        }
        if (vtax<0)
        {
          Erp.ShowMessage( vtaxcode + ' value can not be less than zero. Please check line no. ' + (r+1));
          return false;
        }
        if (vtaxclaim<0)
        {
          Erp.ShowMessage( vtaxcode + ' claim value can not be less than zero. Please check line no. ' + (r+1));
          return false;
        }
        if (trans_interstate==true)
        {
          if (vinterstate==false && vtaxrate!=0)
          {
            Erp.ShowMessage('Supply Type is Inter State but ' + vtaxcode + ' rate is specified. Please check line no. ' + (r+1));
            return false;
          }
          if (vinterstate==false && vtax!=0)
          {
            Erp.ShowMessage('Supply Type is Inter State but ' + vtaxcode + ' value is specified. Please check line no. ' + (r+1));
            return false;
          }
          if (vinterstate==false && vtaxclaim!=0)
          {
            Erp.ShowMessage('Supply Type is Inter State but ' + vtaxcode + ' claim value is specified. Please check line no. ' + (r+1));
            return false;
          }
        }
        if (trans_interstate==false)
        {
          if (vintrastate==false && vtaxrate!=0)
          {
            Erp.ShowMessage('Supply Type is Intra State but ' + vtaxcode + ' rate is specified. Please check line no. ' + (r+1));
            return false;
          }
          if (vintrastate==false && vtax!=0)
          {
            Erp.ShowMessage('Supply Type is Intra State but ' + vtaxcode + ' value is specified. Please check line no. ' + (r+1));
            return false;
          }
          if (vintrastate==false && vtaxclaim!=0)
          {
            Erp.ShowMessage('Supply Type is Intra State but ' + vtaxcode + ' claim value is specified. Please check line no. ' + (r+1));
            return false;
          }
        }
        if (vtaxclaim>vtax)
        {
          Erp.ShowMessage('Tax Claim can not be more than Tax. Please check ' + vtaxcode + '  in line no. ' + (r+1));
          return false;
        }
        if (!(WhetherIncomingSupplyType()))
        {
          if (vtaxclaim>0)
          {
            Erp.ShowMessage('Tax Claim can not be more 0 in case of vouchers other than Purchase / Expense / Debit Notes (Purchase) / Credit Notes (Purchase). Please check ' + vtaxcode + '  in line no. ' + (r+1));
            return false;
          }
        }
      }
    }
  }
  return true;
}
Erp.OnSave.Register(SaveFunction);
function SaveFunction(){
  if (validateGridTI()==false)
  {
    return false;
  }
  if(!validateGUIControls())
  {
    return false;
  }
  if(Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_istdsapplicable')))
  {
    if (Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_tds_am')))
    {
      Erp.ShowMessage('Please choose TDS Section','alert');
      return false;
    }
    if (Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_tdsgrossamount')))
    {
      Erp.ShowMessage('Please input TDS Gross Amount','alert');
      return false;
    }
    if (Fn.IsEmpty(Erp.GetFieldValue('@tbl_erp_t_tdsamount')))
    {
      Erp.ShowMessage('Please input TDS Amount','alert');
      return false;
    }
  }
  if (Fn.CFlt(Erp.GetFieldValue('@tbl_erp_t_advanceamount'))!=0 && (vType == 'R' || vType == 'PY'  || subvType=='AP'  || subvType=='AR'  || vType=='RV' )) 
  {
    if (Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_isadvance'))==false)
    {
      Erp.ShowMessage("Please check 'Is Advance' and input item details for the advance amount of " + Erp.GetFieldValue('@tbl_erp_t_advanceamount'));
      return false;
    }
  }
  if (vType == 'M') 
  {
    var AgainstBill=Erp.Grid.CalculateColumn('gridAgainstBill','receiptamount','SUM');
    var AgainstCN=Erp.Grid.CalculateColumn('dgAgainstCN','receiptamount','SUM');
    if (AgainstBill != AgainstCN)
    {
      /* Erp.ShowMessage(" Amount adjusted against bill  ["+AgainstBill+"] should match with amount adjusted against credit note and advances ["+AgainstCN + "] " );
      return false;*/
    }
  }
  if (Fn.IsEmpty( Erp.GetFieldValue("@previoustr")) && (vType == 'CN' || vType == 'DN')) 
  {
    /*Erp.ShowMessage("Please Select Previous Invoice No ");
    return false;*/
  }
  if(db_fld_1=="Cash")
  {
    Erp.SetFieldValue('@helper_tmreferenceno','');
    Erp.SetFieldValue('@helper_chequedate','');
    Erp.SetFieldValue('@helper_chequedrawnon','');
  }
  if(!Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_ecomtran')))
  {
    Erp.SetFieldValue('@ecommerceoperatoram','');
  }
  Erp.SetFieldValue('@dot',Erp.GetFieldValue('@tbl_erp_t_voucherdate'));
  return true;
}

function validatebillpattern()
{
  var ex_Code=Fn.ToUpperCase( db_fld_4);
var exportbillno=Erp.GetFieldValue('@tbl_erp_t_export_billno');
var checkbillno;
  if((ex_Code =="WPAY" || ex_Code == "WOPAY")&& !Fn.IsEmpty(exportbillno))
  {
	checkbillno=exportbillno.search(/^[a-zA-Z0-9-/]+$/);
	if(checkbillno<0)
	{
	
	return "Allowed Only A-Z and 0-9 and / In Bill No";
	}
    
  }
}
function validateinumpattern()
{
  
var inum=Erp.GetFieldValue('@tbl_erp_t_vnumber');
var checkbillno;
  if(!Fn.IsEmpty(inum))
  {
	checkbillno=inum.search(/^[a-zA-Z0-9-/]+$/);
	if(checkbillno<0)
	{
	
	return "Allowed Only A-Z and 0-9 and / In Voucher Number";
	}
    
  }
}
Erp.OnSaveSuccess.Register(SaveSuccessFunction);
function SaveSuccessFunction(){
  Erp.Grid.SaveChanges('gridDocs');
}
function CalculateFooterAccounts()
{
  CalculateColFooter('gridTD','debitamount');
  CalculateColFooter('gridTD','creditamount');
}
function CalculateFooterOC(colname)
{
  CalculateColFooter('gridOC','debitamount');
  CalculateColFooter('gridOC','creditamount');
}
function CalculateFooterTI(colname)
{
  // if (Fn.IndexOf(colname,'rate')>=0 || Fn.IndexOf(colname,'ratediscount')>=0 || Fn.IndexOf(colname,'qty')>=0)
  // {
  CalculateColFooter('gridTI','total');
  CalculateColFooter('gridTI','discount');
  CalculateColFooter('gridTI','nettotal');
  CalculateColFooter('gridTI','abatement');
  CalculateColFooter('gridTI','taxablevalue');
  // }
  if (Fn.IndexOf(colname,'abatement')>0)
  {
    CalculateColFooter('gridTI','taxablevalue');
    CalculateColFooter('gridTI','finaltaxable');
  }
  else if (Fn.IsEmpty(colname))
  {
    if(Erp.Grid._getGridView('gridTI') == null)
      return;
    var totcols=Erp.Grid._getGridView('gridTI').get_columns().length;
    for (var i=BeginColumns;i<totcols;i++)
    {
      var lColName=Erp.Grid._getGridView('gridTI').get_columns()[i]._data.UniqueName
      if (Fn.IndexOf(lColName,'#@val#@')>=0 || Fn.IndexOf(lColName,'#@claimable#@')>=0)
      {
        CalculateColFooter('gridTI',i);
      }
    }
  }
  CalculateColFooter('gridTI','othercharge');
  CalculateColFooter('gridTI','finaltaxable');
}
function CalculateColFooter(gridid,colname)
{
  var Total=Fn.Round(Erp.Grid.CalculateColumn(gridid,colname,'SUM'),2);
  Erp.Grid.SetFooterText(gridid,colname,0,Total);
}
function showacdetails()
{
  Erp.OpenPopup('actab',{
    showClose:true,autoClose: false}
               );
  return false;
}
function GridCellChangedgridAgainstBill(gridId,args){
  CalculateFootergridAgainstBill();
  if(args.colName=='receiptamount')
  {
    var receiptamount=Erp.GetFieldValue('@tbl_erp_t_helper_amount1');
    var gridreceiptamount=Erp.Grid.CalculateColumn('gridAgainstBill','receiptamount','SUM');
    Erp.SetFieldValue('@advanceamount',Fn.Round(Fn.CFlt(receiptamount)-Fn.CFlt(gridreceiptamount),2));
    Erp.SetEnable('@advanceamount',false);
  }
  else  if(args.colName=='paymentamount')
  {
    var receiptamount=Erp.GetFieldValue('@tbl_erp_t_helper_amount1');
    var gridreceiptamount=Erp.Grid.CalculateColumn('gridAgainstBill','paymentamount','SUM');
    Erp.SetFieldValue('@advanceamount',Fn.Round(Fn.CFlt(receiptamount)-Fn.CFlt(gridreceiptamount),2));
    Erp.SetEnable('@advanceamount',false);
  }
  else  if(args.colName=='addamount')
  {
    CalculateNewBalance();
  }
}
function OnCellValidating(gridId,args){
  /*if(args.colName=='receiptamount'){
    if(Fn.CFlt(Erp.Grid.GetEditorValue(arguments[0],'receiptamount',arguments[1].row)) >  Fn.CFlt( Erp.Grid.GetEditorValue(gridId,'balanceamount', args.row)))
    {
      //Erp.Grid.RaiseError('gridAgainstBill','receiptamount','This is an error message');
      return 'Receipt amount should be less than balance amount';
    }
  }*/
}
function OnCellValidating_gridTI(gridId,args){
  if(args.colName=='rate'){
    if(Fn.CFlt(args.value) < 0 )
    {
      return 'Rate should not be negative';
    }
  }
}
function CalculateFootergridAgainstBill()
{
  CalculateColFooter('gridAgainstBill','totaldebits');
  CalculateColFooter('gridAgainstBill','totalcredits');
  CalculateColFooter('gridAgainstBill','debitbalance');
  CalculateColFooter('gridAgainstBill','creditbalance');
  CalculateColFooter('gridAgainstBill','addamount');
  CalculateColFooter('gridAgainstBill','newbalance');
  CalculateColFooter('gridAgainstBill','reduceamount');
  CalculateColFooter('gridAgainstBill','paymentamount');
  CalculateColFooter('gridAgainstBill','receiptamount');
  CalculateColFooter('gridAgainstBill','TDSReceivable');
}
function setadvanceamt()
{
  if(vType == 'R' ){
    var receiptamount=Erp.GetFieldValue('@tbl_erp_t_helper_amount1');
    DistributeAmountInGrid('gridAgainstBill',receiptamount,'debitbalance','receiptamount',true);
    CalculateFootergridAgainstBill();
    var gridreceiptamount=Erp.Grid.CalculateColumn('gridAgainstBill','receiptamount','SUM');
    Erp.SetFieldValue('@advanceamount',Fn.Round(Fn.CFlt(receiptamount)-Fn.CFlt(gridreceiptamount),2));
    Erp.SetEnable('@advanceamount',false);
  }
  else if(vType == 'PY'){
    var receiptamount=Erp.GetFieldValue('@tbl_erp_t_helper_amount1');
    DistributeAmountInGrid('gridAgainstBill',receiptamount,'creditbalance','paymentamount',true);
    CalculateFootergridAgainstBill();
    var gridreceiptamount=Erp.Grid.CalculateColumn('gridAgainstBill','paymentamount','SUM');
    Erp.SetFieldValue('@advanceamount',Fn.Round(Fn.CFlt(receiptamount)-Fn.CFlt(gridreceiptamount),2));
    Erp.SetEnable('@advanceamount',false);
  }
  else if(vType == 'AR'  || vType == 'AP'  || vType=='RV' ){
    var receiptamount=Erp.GetFieldValue('@tbl_erp_t_helper_amount1');
    Erp.SetFieldValue('@advanceamount',Fn.Round(receiptamount,2));
    Erp.SetEnable('@advanceamount',false);
  }
}
function GSC_Changed(){
  DistributeOC();
  var supplyCategory=Fn.ToLowerCase( Erp.GetFieldValue('@gstsupplycategory'));
  var gridTiRowsLength=Erp.Grid.GetRows('gridTI').length;
  
  
  var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code == "WOPAY")
    isExport=true;
  
  for(var t=0;t<gridTiRowsLength;t++)
  {
    var amt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','nettotal',t));
    Erp.Grid.SetEditorValue('gridTI','taxablevalue',t,0);
    Erp.Grid.SetEditorValue('gridTI','nilRatedAmt',t,0);
    Erp.Grid.SetEditorValue('gridTI','ExemptedAmt',t,0);
    Erp.Grid.SetEditorValue('gridTI','NonGSTAmt',t,0);
    Erp.Grid.SetEditorValue('gridTI','compositesupplyamount',t,0);
    
    if(supplyCategory == 'nilrated')
      Erp.Grid.SetEditorValue('gridTI','nilRatedAmt',t,amt);
    else if(supplyCategory == 'exempted')
      Erp.Grid.SetEditorValue('gridTI','ExemptedAmt',t,amt);
    else if(supplyCategory == 'nongst')
      Erp.Grid.SetEditorValue('gridTI','NonGSTAmt',t,amt);
    else if(supplyCategory == 'compositesupply')
      Erp.Grid.SetEditorValue('gridTI','compositesupplyamount',t,amt);
    
    var abatement=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','abatement',t));
    var nilRatedAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','nilRatedAmt',t));
    var ExemptedAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','ExemptedAmt',t));
    var NonGSTAmt=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','NonGSTAmt',t));
    var compositesupplyamount=Fn.CFlt(Erp.Grid.GetEditorValue('gridTI','compositesupplyamount',t));
    
    var taxablevalue=amt-abatement-nilRatedAmt-ExemptedAmt-NonGSTAmt-compositesupplyamount;
    
    
    Erp.Grid.SetEditorValue('gridTI','taxablevalue',t,taxablevalue);
    var othercharge=Fn.CFlt( Erp.Grid.GetEditorValue('gridTI','othercharge',t));
    Erp.Grid.SetEditorValue('gridTI','finaltaxable',t, ( taxablevalue+othercharge));
  }
  TaxableColumnsDisplay();
  GloadTaxes=true;
  
 // console.log("GSC_Changed")
  set_ItemTaxLoaded();
  CalcTaxesAll();
  CalculateFooterTI('qty');
  CalculateFooterTI('');
  FinalShowOfTotals();
  setTransType();
}
function TaxableColumnsDisplay()
{
  //var supplyCategory=Fn.ToLowerCase( Erp.GetFieldValue('@gstsupplycategory'));
  //Erp.Grid.DisplayColumn('gridTI','taxablevalue',supplyCategory == 'taxable');
  //Erp.Grid.DisplayColumn('gridTI','nilRatedAmt',supplyCategory == 'nilrated');
  //Erp.Grid.DisplayColumn('gridTI','ExemptedAmt',supplyCategory == 'exempted');
  //Erp.Grid.DisplayColumn('gridTI','NonGSTAmt',supplyCategory == 'nongst');
  //For the time being since other charges is kept hidden then no need of taxable
  Erp.Grid.DisplayColumn('gridTI','taxablevalue',false);
  Erp.Grid.DisplayColumn('gridTI','nilRatedAmt',false);
  Erp.Grid.DisplayColumn('gridTI','ExemptedAmt',false);
  Erp.Grid.DisplayColumn('gridTI','NonGSTAmt',false);
  Erp.Grid.DisplayColumn('gridTI','compositesupplyamount',false);
}
function toggleTDSAccount()
{
  if(vType == 'R' || vType == 'PY'){
    if(Fn.CFlt(Erp.GetFieldValue('@tbl_erp_t_helper_tdsamount')) > 0){
      Erp.SetDisplay('@helper_am2',true);
      Erp.SetDisplay('lblTdsAct',true);
    }
    else{
      Erp.SetDisplay('@helper_am2',false);
        Erp.SetDisplay('lblTdsAct',false);
    }
    /*DistributeAmountInGrid('gridAgainstBill',Erp.GetFieldValue('@tbl_erp_t_helper_tdsamount'),'balanceamount','receiptamount');
    CalculateFootergridAgainstBill();*/
  }
}
function ManipulateMatchingUI(){
  if(vType == 'M'){
    Erp.SetLabel('lblVType','Type');
    Erp.SetLabel('lblVoucherDate','Date');
    Erp.SetDisplay('lblVNumber',false);
    Erp.SetDisplay('@vnumber',false);
    Erp.SetDisplay('lblDueDate',false);
    Erp.SetDisplay('@duedate',false);
    Erp.SetDisplay('lblShippingTo',false);
    Erp.SetDisplay('@salesconsigneeam',false);
    Erp.SetDisplay('lblInvoiceNo',false);
    Erp.SetDisplay('@purchaseinvoiceno',false);
    Erp.SetDisplay('@purchaseinvoicedate',false);
    Erp.SetDisplay('@previoustr',false);
    Erp.SetDisplay('pnlOtherCharges',false);
    Erp.SetDisplay('pnlnarration',false);
    Erp.SetDisplay('pnlAgainstCN',true);
    Erp.SetParam('@helper_am','_fc','MatchingParty');
    Erp.SetDisplay('pnlAgainstBill',true);
    Erp.SetDisplay('pnlItemDetails',false);
    Erp.Grid.DisplayColumn('gridAgainstBill','TDSReceivable',false);
    Erp.Grid.DisplayColumn('dgAgainstCN','TDSReceivable',false);
    Erp.Grid.DisplayColumn('gridAgainstBill','distribute',true);
    Erp.SetDisplay('panelDocuments',false);
    Erp.SetDisplay('@attachdocuments',false);
    //Erp.SetDisplay('pnlAgainstDN',true);
  }
  else
  {
    //  Erp.SetDisplay('pnlAgainstDN',false);
    Erp.Grid.DisplayColumn('gridAgainstBill','distribute',false);
    Erp.Grid.DisplayColumn('gridAgainstBill',0,false);
    Erp.SetDisplay('pnlAgainstCN',false);
  }
}
function CalculateFootergridAgainstCN()
{
  CalculateColFooter('dgAgainstCN','billamount');
  CalculateColFooter('dgAgainstCN','balanceamount');
  CalculateColFooter('dgAgainstCN','receiptamount');
  CalculateColFooter('dgAgainstCN','TDSReceivable');
  CalculateColFooter('dgAgainstCN','paymentamount');
  CalculateColFooter('dgAgainstCN','creditbalance');
  CalculateColFooter('dgAgainstCN','debitbalance');
}
function OnGridDataBound_AgainstCN(gridId,args){
  CalculateFootergridAgainstCN();
  SetDistribute();
}
function OnGridDataBound_AgainstBill(gridId,args){
  CalculateFootergridAgainstBill();
  CalculateNewBalance();
}
function GridCellChangeddgAgainstCN(gridId,args){
  if(args.colName=='receiptamount')
  {
    CalculateFootergridAgainstCN();
  }
  else if(args.colName=='distribute')
  {
    if(vType == 'M'){
      var debitbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'debitbalance',args.row) )  ;
      var creditbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'creditbalance',args.row) )  ;
      var amtDistribute=0;
      if(Fn.CBool(Erp.Grid.GetEditorValue(gridId,'distribute',args.row) )){
        if(debitbalance > 0 )
          amtDistribute=debitbalance;
        else
          amtDistribute=creditbalance;
      }
      Erp.Grid.SetEditorValue(gridId,'receiptamount',args.row,amtDistribute);
      DistributeAmoutRowWise();
    }
  }
}
function distributeReceiptAmount(rcpAmt,row,debitcredit)
{
  var amtDistributed=0;
  var agCode =Fn.ToLowerCase(db_fld_29);
  if(vType == 'M'){
    var gridID='gridAgainstBill';
    var rowCount=Erp.Grid.GetRows(gridID).length;
    for(var i=0;i<rowCount ; i++)
    {
      if(rcpAmt == 0 )
        break;
      var debitbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i) )  ;
      var creditbalance=Fn.CFlt( Erp.Grid.GetEditorValue(gridID,'creditbalance',i) )  ;
      var newbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'newbalance',i) )  ;
      var addamount=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'addamount',i) )  ;
      var reduceamount=Fn.CFlt( Erp.Grid.GetEditorValue(gridID,'reduceamount',i) )  ;
      var amtToCompare=debitbalance;
      if(agCode == "sc")
        amtToCompare=creditbalance;
      if(debitcredit == "D")
      {
        if(amtToCompare != addamount)
        {
          amtToCompare=amtToCompare-addamount;
          if(amtToCompare <= rcpAmt){
            Erp.Grid.SetEditorValue(gridID,'addamount',i,addamount+ amtToCompare);
            rcpAmt=rcpAmt-amtToCompare;
            amtDistributed=amtDistributed+amtToCompare;
            addamount=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'addamount',i) )  ;
            debitbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i) )  ;
            Erp.Grid.SetEditorValue(gridID,'newbalance',i,debitbalance+addamount);
          }
          else if(amtToCompare >= rcpAmt)
          {
            Erp.Grid.SetEditorValue(gridID,'addamount',i,addamount+rcpAmt);
            amtDistributed=amtDistributed+rcpAmt;
            rcpAmt=0;
            addamount=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'addamount',i) )  ;
            debitbalance=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i) )  ;
            Erp.Grid.SetEditorValue(gridID,'newbalance',i,debitbalance+addamount);
          }
        }
      }
      else
      {
        newbalance=newbalance-reduceamount;
        if(newbalance <= rcpAmt){
          Erp.Grid.SetEditorValue(gridID,'reduceamount',i,reduceamount+ newbalance);
          rcpAmt=rcpAmt-newbalance;
          amtDistributed=amtDistributed+newbalance;
        }
        else if(newbalance >= rcpAmt)
        {
          Erp.Grid.SetEditorValue(gridID,'reduceamount',i,reduceamount+rcpAmt);
          amtDistributed=amtDistributed+rcpAmt;
          rcpAmt=0;
        }
      }
    }
    Erp.Grid.SetEditorValue('dgAgainstCN','receiptamount',row,amtDistributed);
    //CalculateFootergridAgainstCN();
  }
}
function DistributeAmoutRowWise(){
  ResetAgainstGridAmounts();
  var gridID='dgAgainstCN';
  var rowCount=Erp.Grid.GetRows(gridID).length;
  var agCode =Fn.ToLowerCase(db_fld_29);
  for(var i=0;i<rowCount ; i++)
  {
    var row= i;
    if(Fn.CBool(Erp.Grid.GetEditorValue(gridID,'distribute',row) ))
    {
      var debitbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i));
      var creditbalance =Fn.CFlt( Erp.Grid.GetEditorValue(gridID,'creditbalance',i));
      var amtDistribute=0;
      var debitcredit='D';
      if(debitbalance > 0)
      {
        amtDistribute = debitbalance;
        debitcredit="D";
      }
      else {
        amtDistribute = creditbalance;
        debitcredit="C";
      }
      distributeReceiptAmount(amtDistribute,row,debitcredit);
    }
    else
      Erp.Grid.SetEditorValue(gridID,'receiptamount',row,0);
  }
  //CalculateFootergridAgainstBill();
  // CalculateFootergridAgainstCN();
}
function ResetAgainstGridAmounts()
{
  var gridID='gridAgainstBill';
  var rowCount=Erp.Grid.GetRows(gridID).length;
  for(var i=0;i<rowCount ; i++)
  {
    var debitbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i));
    var creditbalance =Fn.CFlt( Erp.Grid.GetEditorValue(gridID,'creditbalance',i));
    Erp.Grid.SetEditorValue(gridID,'addamount',i,0);
    // Erp.Grid.SetEditorValue(gridID,'newbalance',i,debitbalance);
    Erp.Grid.SetEditorValue(gridID,'reduceamount',i,0);
  }
  CalculateNewBalance();
}
function OnCellValidating1(gridId,args){
  if(args.colName=='receiptamount'){
    /*if(Fn.CFlt(Erp.Grid.GetEditorValue(arguments[0],'receiptamount',arguments[1].row)) >  Fn.CFlt( Erp.Grid.GetEditorValue(gridId,'balanceamount', args.row)))
    {
      //Erp.Grid.RaiseError('gridAgainstBill','receiptamount','This is an error message');
      return 'Receipt amount should be less than balance amount';
    }*/
  }
}
function DistributeAmountInGrid(gridID,amtToDistribute,colToCompare,colToDistribute,isReset)
{
  if(isReset)
    ResetGridAmounts(gridID,colToDistribute);
  var rowCount=Erp.Grid.GetRows(gridID).length;
  for(var i=0;i<rowCount ; i++)
  {
    var row= i;
    if(amtToDistribute <= 0)
      break;
    var amtToCompare=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,colToCompare,row) )  ;
    if(amtToCompare <= amtToDistribute){
      Erp.Grid.SetEditorValue(gridID,colToDistribute,i,amtToCompare);
      amtToDistribute=amtToDistribute-amtToCompare;
    }
    else if(amtToCompare >= amtToDistribute)
    {
      Erp.Grid.SetEditorValue(gridID,colToDistribute,i,amtToDistribute);
      amtToDistribute=0;
    }
  }
}
function ResetGridAmounts(gridID,colToDistribute)
{
  var rowCount=Erp.Grid.GetRows(gridID).length;
  for(var i=0;i<rowCount ; i++)
  {
    Erp.Grid.SetEditorValue(gridID,colToDistribute,i,0);
  }
}
function toggleMatchingGrids(isLoad)
{
  if(vType == "M" || vType == "R" || vType == "PY")
  {
    var agCode =Fn.ToLowerCase(db_fld_29);
    if(agCode == "sd" || vType == "R")
    {
      if(isLoad)
        Erp.Grid.Refresh('gridAgainstBill');
      Erp.Grid.DisplayColumn('gridAgainstBill','totaldebits',true);
      Erp.Grid.DisplayColumn('gridAgainstBill','debitbalance',true);
      Erp.Grid.DisplayColumn('gridAgainstBill','totalcredits',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','creditbalance',false);
    }
    else if(agCode == "sc" || vType == "PY")
    {
      if(Erp.LayoutMode == "E" || isLoad){
        Erp.Grid.Refresh('gridAgainstBill');
      }
      Erp.Grid.DisplayColumn('gridAgainstBill','totaldebits',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','debitbalance',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','totalcredits',true);
      Erp.Grid.DisplayColumn('gridAgainstBill','creditbalance',true);
    }
    if(vType == "M" ){
      if(Erp.LayoutMode == "E" || isLoad){
        Erp.Grid.Refresh('gridAgainstBill');
        Erp.Grid.Refresh('dgAgainstCN');
      }
      Erp.SetDisplay("pnlAgainstBill",true);
      Erp.SetDisplay("pnlAgainstCN",true);
    }
    if( vType == "R")
    {
      if(Erp.LayoutMode == "E" || isLoad)
        Erp.Grid.Refresh('gridAgainstBill');
      Erp.Grid.DisplayColumn('gridAgainstBill','addamount',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','newbalance',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','reduceamount',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','receiptamount',true);
    }
    else if(vType == "PY")
    {
      if(Erp.LayoutMode == "E" || isLoad){
        Erp.Grid.Refresh('gridAgainstBill');
      }
      Erp.Grid.DisplayColumn('gridAgainstBill','addamount',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','newbalance',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','reduceamount',false);
      Erp.Grid.DisplayColumn('gridAgainstBill','paymentamount',true);
    }
  }
  else
  {
    Erp.SetDisplay("pnlAgainstCN",false);
  }
}
function CalculateNewBalance()
{
  var rowCount=Erp.Grid.GetRows('gridAgainstBill').length;
  var agCode =Fn.ToLowerCase(db_fld_29);
  for(var i=0;i<rowCount ; i++)
  {
    var addamount =Fn.CFlt(Erp.Grid.GetEditorValue('gridAgainstBill','addamount',i));
    var amt=0;
    var dcamt=0;
    if(agCode == "sd"){
      amt =Fn.CFlt(Erp.Grid.GetEditorValue('gridAgainstBill','totaldebits',i));
      dcamt= Fn.CFlt(Erp.Grid.GetEditorValue('gridAgainstBill','debitbalance',i));
    }
    else{
      amt =Fn.CFlt(Erp.Grid.GetEditorValue('gridAgainstBill','totalcredits',i));
      dcamt= Fn.CFlt(Erp.Grid.GetEditorValue('gridAgainstBill','creditbalance',i));
    }
    Erp.Grid.SetEditorValue('gridAgainstBill','newbalance',i,(addamount+dcamt))
  }
}
function  SetDistribute()
{
  var rowCount=Erp.Grid.GetRows('dgAgainstCN').length;
  var agCode =Fn.ToLowerCase(db_fld_29);
  for(var i=0;i<rowCount ; i++)
  {
    var receiptamount =Fn.CFlt(Erp.Grid.GetEditorValue('dgAgainstCN','receiptamount',i));
    if(receiptamount > 0)
      Erp.Grid.SetEditorValue('dgAgainstCN','distribute',i,true);
    else
      Erp.Grid.SetEditorValue('dgAgainstCN','distribute',i,false);
  }
}
function validateGUIControls()
{
  var vnumber =Erp.GetFieldValue('@tbl_erp_t_vnumber');
	if(!Fn.IsEmpty(vnumber) && vnumber.length >16)
	{
        Erp.ShowMessage('Voucher Number Can not more than 16 Charachter','alert');
        return false;
	}
  
  if( vType == "P" )
  {
    if(Fn.IsEmpty( db_fld_0) && !Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')){
      Erp.ShowMessage("Since GSTIN of this vendor is not available, You should mark this transaction for Reverse Charge.");
      return false;
    }
    else
      Erp.HideMessage();
  }
  if(Fn.IsEmpty(Erp.GetFieldValue('@helper_am1'))  && (vType == "PY" || vType == "R"))
  {
    Erp.ShowMessage('Please select Bank');
    return false;
  }
  if(Fn.IsEmpty(Erp.GetFieldValue('@helper_tm'))  && (vType == "PY" || vType == "R"))
  {
    Erp.ShowMessage('Please select Transfer mode');
    return false;
  }
  if(Fn.IsEmpty(Erp.GetFieldValue('@helper_am2')) && Fn.CFlt(Erp.GetFieldValue('@tbl_erp_t_helper_tdsamount')) > 0  && (vType == "PY" || vType == "R"))
  {
    Erp.ShowMessage('Please select TDS Account');
    return false;
  }
  if(vType == "S" || vType == "P"  || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'BOS'   || vType == 'SO'   || vType == 'AR' || vType == 'AP'  )
  {
    if(Fn.IsEmpty(Erp.GetFieldValue('@supplytype')))
    {
      Erp.ShowMessage('Please Select Supply Type');
      return false;
    }
    if(Fn.IsEmpty(Erp.GetFieldValue('@pos')))
    {
      Erp.ShowMessage('Please Select POS');
      return false;
    }
    if(Fn.IsEmpty(Erp.GetFieldValue('@gstsupplycategory')))
    {
      Erp.ShowMessage('Please Select Supply Category');
      return false;
    }
  }
  
  if(Fn.CBool(Erp.GetFieldValue('@pregst_b2cl')) && Fn.CStr(Erp.GetFieldValue('@supplytype')) != 'IES')
  {
   Erp.ShowMessage('Supply Type should be Inter-State as Pre GST B2CL is marked');
      return false;
  }
    
    
  if(vType == "PY")
  {
    var gridID="gridAgainstBill";
    var rowCount=Erp.Grid.GetRows(gridID).length;
    var error=false;
    for(var i=0;i<rowCount ; i++)
    {
      var creditbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'creditbalance',i));
      var paymentamount =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'paymentamount',i));
      var TDSReceivable =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'TDSReceivable',i));
      if((paymentamount+TDSReceivable) > creditbalance)
      {
        error =true;
        break;
      }
    }
    if(error){
      Erp.ShowMessage('Payment amount  + Tds Deducted is greater than credit balance ');
      return false;
    }
    var helper_amount1=Fn.CFlt(Erp.GetFieldValue('@helper_amount1'));
    var paymentamount=Erp.Grid.CalculateColumn(gridID,'paymentamount','SUM');
    var TDSReceivable=Erp.Grid.CalculateColumn(gridID,'TDSReceivable','SUM');
    var helper_tdsamount=Fn.CFlt(Erp.GetFieldValue('@helper_tdsamount'));
    var advanceamount=Fn.CFlt(Erp.GetFieldValue('@advanceamount'));
    if(helper_tdsamount != TDSReceivable)
    {
      Erp.ShowMessage('TDS Amount not equal to   tds distributed in grid ');
      return false;
    }
    if(helper_amount1 != (paymentamount+advanceamount))
    {
      Erp.ShowMessage('Amount not equal to  paymentamount+advanceamount ');
      return false;
    }
  }
  if(vType == "R" )
  {
    var gridID="gridAgainstBill";
    var rowCount=Erp.Grid.GetRows(gridID).length;
    var error=false;
    for(var i=0;i<rowCount ; i++)
    {
      var debitbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i));
      var receiptamount =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'receiptamount',i));
      var TDSReceivable =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'TDSReceivable',i));
      if((receiptamount+TDSReceivable) > debitbalance)
      {
        error =true;
        break;
      }
    }
    if(error){
      Erp.ShowMessage('receiptamount  + Tds Deducted is greater than debitbalance ');
      return false;
    }
    var helper_amount1=Fn.CFlt(Erp.GetFieldValue('@helper_amount1'));
    var receiptamount=Erp.Grid.CalculateColumn(gridID,'receiptamount','SUM');
    var TDSReceivable=Erp.Grid.CalculateColumn(gridID,'TDSReceivable','SUM');
    var helper_tdsamount=Fn.CFlt(Erp.GetFieldValue('@helper_tdsamount'));
    var advanceamount=Fn.CFlt(Erp.GetFieldValue('@advanceamount'));
    if(helper_tdsamount != TDSReceivable)
    {
      Erp.ShowMessage('TDS Amount not equal to   tds distributed in grid ');
      return false;
    }
    if(helper_amount1 != (receiptamount+advanceamount))
    {
      Erp.ShowMessage('Amount not equal to  receiptamount+advanceamount ');
      return false;
    }
  }
  if(vType == "M")
  {
    var agCode =Fn.ToLowerCase(db_fld_29);
    var error=false;
    var msg='';
    var gridID="dgAgainstCN";
    var rowCount=Erp.Grid.GetRows(gridID).length;
    for(var i=0;i<rowCount ; i++)
    {
      var debitbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitbalance',i));
      var receiptamount =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'receiptamount',i));
      var creditbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'creditbalance',i));
      if((receiptamount) > (debitbalance+creditbalance))
      {
        error =true;
        if(debitbalance > 0)
          msg="receiptamount is greater than debitbalance";
        else
          msg="receiptamount is greater than creditbalance";
        break;
      }
    }
    if(error){
      Erp.ShowMessage(msg);
      return false;
    }
    error=false;
    gridID="gridAgainstBill";
    rowCount=Erp.Grid.GetRows(gridID).length;
    for(var i=0;i<rowCount ; i++)
    {
      var reduceamount =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'reduceamount',i));
      var newbalance =Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'newbalance',i));
      if(reduceamount > newbalance)
      {
        error =true;
        break;
      }
    }
    if(error){
      Erp.ShowMessage('reduceamount is greater than newbalance ');
      return false;
    }
    var receiptamount=Erp.Grid.CalculateColumn('dgAgainstCN','receiptamount','SUM');
    var addamount=Erp.Grid.CalculateColumn('gridAgainstBill','addamount','SUM');
    var reduceamount=Erp.Grid.CalculateColumn('gridAgainstBill','reduceamount','SUM');
    if(receiptamount != (addamount+reduceamount))
    {
      Erp.ShowMessage('receiptamount not equal to   addamount+reduceamount ');
      return false;
    }
  }
  var totOC_debit = Fn.CFlt( Erp.Grid.CalculateColumn('gridOC','debitamount','SUM'));
  var totOC_credit = Fn.CFlt( Erp.Grid.CalculateColumn('gridOC','creditamount','SUM'));
  var totOC_ti = Fn.CFlt( Erp.Grid.CalculateColumn('gridTI','othercharge','SUM'));
  if( totOC_ti > (totOC_debit+totOC_credit))
  {
    Erp.ShowMessage("'Other Charges Taxable' can not be more than 'Other Charges' ");
    return false;
  }
   if (vType=='S' || vType=='P'  || vType=='AP' || subvType=='AR'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstSales" &&  (vType=='CN' || vType=='DN')) || vType=='DC' || vType == 'PI' || vType == 'Q'  || vType == 'SO'  )
  {
   var taxpayer=db_fld_13;
  var isCust=false;
  var invCode=db_fld_4;
  if (vType=='S' || subvType=='AR' || vType=='R'  || (Erp.GetFieldValue('@modeoftransactionnote')=="AgainstSales" &&  (vType=='CN' || vType=='DN')) || vType == "RV"  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
    isCust=true;
    
  var custLable=Erp.GetLabel('lblParty');
  var msgAlert ='';
  if(Fn.Eq(taxpayer,'SEZ') && !(invCode == 'SEWOP' || invCode == 'SEWP')){
    msgAlert+="Since "+custLable+" Type Is 'Special Economic Zone' ,Please Select Invoice Type As 'SEZ Exports with payment' Or 'SEZ exports without payment' \r\n ";
  }
 if(Fn.Eq(taxpayer,'FNE')){
   if(isCust && !(invCode == 'WOPAY' || invCode == 'WPAY'))
    msgAlert+="Since "+custLable+" Type Is 'Foreign Entity' ,Please Select Invoice Type As 'Export with  payment of GST' Or 'Export without  payment of GST' \r\n ";
   else if( !isCust && !(invCode == 'IMPS' || invCode == 'IMPG'))
      msgAlert+="Since "+custLable+" Type Is 'Foreign Entity' ,Please Select Invoice Type As 'Import Of Goods' Or 'Import Of Services' \r\n ";
  }
  
   if( vType == "P" && !Fn.IsEmpty( Erp.GetFieldValue('@tbl_erp_t_helper_am')))
  {
    if(Fn.IsEmpty( db_fld_0)  && !Erp.GetFieldValue('@tbl_erp_t_isreversechargeapplicable')){
      msgAlert+="Since GSTIN of this vendor is not available, You should mark this transaction for Reverse Charge. \r\n ";
          }
     
  }
  
  if(!Fn.IsEmpty(msgAlert))
  {
    Erp.ShowMessage(msgAlert,'alert');
    return false;
  }
  }
  return true;
}
function toggleTaxPaid()
{
}
function toggleEcom()
{
  Erp.SetDisplay("@ecommerceoperatoram",Erp.GetFieldValue('@tbl_erp_t_ecomtran'));
  Erp.SetMandatory("@ecommerceoperatoram",Fn.CBool(Erp.GetFieldValue('@tbl_erp_t_ecomtran')));
}
function modeOfTransaction_Changed(elem,data,field)
{
}
var loadPrevTr=false;
function previoustr_change(elem,data,field)
{
     old_supplytype='';
 old_invtype='';
 old_supplycat='';
  PrevTR_Disable();
  Erp.SetFieldValue('@supplytype',db_fld_39,db_fld_40);
  Erp.SetFieldValue('@pos',db_fld_41);
  Erp.SetFieldValue('@gstsupplycategory',db_fld_42);
  Erp.SetFieldValue('@invoicetype',db_fld_43);
  Erp.SetFieldValue('@ecomtran',db_fld_44);
  Erp.SetFieldValue('@ecommerceoperatoram',db_fld_45);
  Erp.SetFieldValue('@isreversechargeapplicable',db_fld_46);
  
  Erp.SetFieldValue('@defaulttransactionbank',db_fld_47);
  if(vType == 'RV')
  {
    Erp.SetFieldValue('@helper_am1',db_fld_48);
    Erp.SetFieldValue('@helper_tm',db_fld_49);
    Erp.SetFieldValue('@helper_chequedrawnon',db_fld_50);
    Erp.SetFieldValue('@helper_chequedate',db_fld_51);
    Erp.SetFieldValue('@helper_tmreferenceno',db_fld_52);
    Erp.SetFieldValue('@advanceamount',db_fld_53);
    Erp.SetFieldValue('@helper_amount1',db_fld_54);
    Toggletransactiondetails();
  }
  loadPrevTr=true;
  toggleEcom();
  Erp.TriggerEvent('@invoicetype','change',InvoiceTypeChanged);
  /*  if(Fn.IsEmpty(Erp.GetFieldValue("@previoustr")))
  {
    Erp.SetDisplay("btnCrBal",false);
         Erp.SetDisplay("btnDrBal",false);
  }
  else
  {
    Erp.SetDisplay("btnCrBal",true);
         Erp.SetDisplay("btnDrBal",true);
  }*/
  // fetchCrDrBalance();
}
function duedatescheme_change(elem,data,field)
{
  if (data!=null && data.Keys != undefined)
    if (data.Keys.length>0){
      var noOfDays=Fn.CInt(data.Keys[0]);
      var vtDate=Fn.CDate( Erp.GetFieldValue("@voucherdate"));
      var newdate = new Date(vtDate);
      newdate.setDate(vtDate.getDate() + noOfDays);
      Erp.SetFieldValue("@duedate",newdate);
    }
}
function deleteAllGridRows(gridId){
  Erp.Grid.DataBind(gridId,[]);
  Erp.Grid.DeleteRow(gridId,0,true);
}
var abcd=0
function setItemDataToGrid()
{
  Erp.LoadVariable(['prevTr_Ti','prevTr_TaxInfo','prevTr_OtherInfo'], loadprevtr_ti);
}
function loadprevtr_ti(){
  var gridId='gridTI';
  deleteAllGridRows(gridId);
  if(prevTr_Ti.length <= 0){
    var newrow1=   Erp.Grid.AddNewRow(gridId);
  }
  for (var i=0; i<prevTr_Ti.length;i++)
  {
    var newrow=   Erp.Grid.AddNewRow(gridId);
    Erp.Grid.SetEditorValue(gridId,'amti',newrow,Fn.CStr(prevTr_Ti[i]['am_pid']),Fn.CStr(prevTr_Ti[i]['amname']));
    Erp.Grid.SetEditorValue(gridId,'item',newrow,Fn.CStr(prevTr_Ti[i]['item_pid']),Fn.CStr(prevTr_Ti[i]['itemname']));
    Erp.Grid.SetEditorValue(gridId,'rate',newrow,Fn.CFlt(prevTr_Ti[i]['rate']));
    Erp.Grid.SetEditorValue(gridId,'ratediscount',newrow,Fn.CFlt(prevTr_Ti[i]['ratediscount']));
    Erp.Grid.SetEditorValue(gridId,'finalrate',newrow,Fn.CFlt(prevTr_Ti[i]['finalrate']));
    Erp.Grid.SetEditorValue(gridId,'qty',newrow,Fn.CFlt(prevTr_Ti[i]['qty']));
    Erp.Grid.SetEditorValue(gridId,'total',newrow,Fn.CFlt(prevTr_Ti[i]['total']));
    Erp.Grid.SetEditorValue(gridId,'discount',newrow,Fn.CFlt(prevTr_Ti[i]['discount']));
    Erp.Grid.SetEditorValue(gridId,'nettotal',newrow,Fn.CFlt(prevTr_Ti[i]['nettotal']));
    Erp.Grid.SetEditorValue(gridId,'abatement',newrow,Fn.CFlt(prevTr_Ti[i]['abatement']));
    Erp.Grid.SetEditorValue(gridId,'nilRatedAmt',newrow,Fn.CFlt(prevTr_Ti[i]['nilratedamt']));
    Erp.Grid.SetEditorValue(gridId,'ExemptedAmt',newrow,Fn.CFlt(prevTr_Ti[i]['exemptedamt']));
    Erp.Grid.SetEditorValue(gridId,'NonGSTAmt',newrow,Fn.CFlt(prevTr_Ti[i]['nongstamt']));
    Erp.Grid.SetEditorValue(gridId,'compositesupplyamount',newrow,Fn.CFlt(prevTr_Ti[i]['compositesupplyamount']));
    Erp.Grid.SetEditorValue(gridId,'taxablevalue',newrow,Fn.CFlt(prevTr_Ti[i]['taxablevalue']));
    Erp.Grid.SetEditorValue(gridId,'othercharge',newrow,Fn.CFlt(prevTr_Ti[i]['otherchargestaxable']));
    Erp.Grid.SetEditorValue(gridId,'finaltaxable',newrow,Fn.CFlt(prevTr_Ti[i]['finaltaxablevalue']));
    Erp.Grid.SetEditorValue(gridId,'itemlinenarration',newrow,Fn.CStr(prevTr_Ti[i]['itemlinenarration']));
    Erp.Grid.SetEditorValue(gridId,'itc_elg',newrow,Fn.CStr(prevTr_Ti[i]['eligibility_pid']),Fn.CStr(prevTr_Ti[i]['eligibility_pid']));
    Erp.Grid.SetEditorValue(gridId,'itmnaturecode',newrow,Fn.CStr(prevTr_Ti[i]['itemnaturecode']));
    var ti_pid=Fn.CStr(prevTr_Ti[i]['ti_pid']);
    setTaxDataToGrid(ti_pid,newrow)
  }
  setOtherInfoFromTr();
  loadPrevTr=false;
}
function setOtherInfoFromTr()
{
  //console.log("bjbjk");
  var gridId= "gridOC";
  deleteAllGridRows(gridId);
  var tscnmode=Fn.ToLowerCase( Erp.GetFieldValue('@modeoftransactionnote'));
  if(prevTr_OtherInfo.length <= 0){
    var newrow1=   Erp.Grid.AddNewRow(gridId);
    return;
  }
  for (var i=0; i<prevTr_OtherInfo.length;i++)
  {
    var newrow=   Erp.Grid.AddNewRow(gridId);
    Erp.Grid.SetEditorValue(gridId,'am',newrow,Fn.CStr(prevTr_OtherInfo[i]['am_pid']),Fn.CStr(prevTr_OtherInfo[i]['amname']));
    
    var debitcredit="C";
    var debitcreditCol="creditamount";
    if (vType=='E' || vType=='P' || vType=='CN' || vType == 'R' || vType == 'AR'  || vType=='RV' ){
       debitcredit="D";
      debitcreditCol="debitamount";
    }
     else if (vType=='S' || vType=='DN' || vType == 'PY'  || vType == 'AP'   || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )	{
    debitcredit="C";
       debitcreditCol="creditamount";
     }
    
    Erp.Grid.SetEditorValue(gridId,'debitcredit',newrow,debitcredit,debitcredit);
   
    if(Fn.CFlt(prevTr_OtherInfo[i]['debitamount']) > 0)
      Erp.Grid.SetEditorValue(gridId,debitcreditCol,newrow,Fn.CFlt(prevTr_OtherInfo[i]['debitamount']));
    
    if(Fn.CFlt(prevTr_OtherInfo[i]['creditamount']) > 0)
      Erp.Grid.SetEditorValue(gridId,debitcreditCol,newrow,Fn.CFlt(prevTr_OtherInfo[i]['creditamount']));
   
    var _bits=Fn.CBool(prevTr_OtherInfo[i]['gst']) +'|'+Fn.CBool(prevTr_OtherInfo[i]['cg'])+'|'+Fn.CBool(prevTr_OtherInfo[i]['og'])+'|'+Fn.CBool(prevTr_OtherInfo[i]['inv'])+'|'+Fn.CBool(prevTr_OtherInfo[i]['ser']);
    Erp.Grid.SetEditorValue(gridId,'amnature',newrow,_bits);
  }
  FinalShowOfTotals();
}
function setTaxDataToGrid(TIId,newrow)
{
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  for (var i=0; i<TaxList.length;i++)
  {
    var arr=Fn.Filter(prevTr_TaxInfo,function(r){
      return r.ti_pid==TIId && TaxList[i]['tax_pid']==r.tax_pid;
    }
                     );
    if (arr.length>0)
    {
      var amid="";
      if(vType=='P' || vType=='E' ||  ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY' || vType=='AP')
        amid='inputam';
      else
        amid='outputam';
      var ratename="taxcol#@rate#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      var valname="taxcol#@val#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      var claimablename="taxcol#@claimable#@" + TaxList[i]['taxcode'] +'#@' + TaxList[i]['tax_pid'] +'#@' + amid+'#@' + TaxList[i]['intrastate']+'#@' + TaxList[i]['interstate']+'#@' +  Fn.CBool(TaxList[i]['rateindependent'])+'#@' + TaxList[i]['taxgroupcode'];
      Erp.Grid.SetEditorValue('gridTI',ratename,newrow,Fn.CFlt(arr[0]['taxrate']));
      Erp.Grid.SetEditorValue('gridTI',valname,newrow,Fn.CFlt(arr[0]['taxvalue']));
      Erp.Grid.SetEditorValue('gridTI',claimablename,newrow,Fn.CFlt(arr[0]['claimabletax']));
    }
  }
}
function fetchCrDrBalance()
{
  Erp.ServerCommand('CrDrBalance',{
  }
                    ,function(cmd){
                    }
                   );
}
function openMatchingLayout()
{
  Erp.OpenWindow({
    "Action":"ADDFORM","Entity":"tbl_ERP_t","Form":"ExpenseWithItem","Refresh":false,"Global":false,"Title":"Transaction Matching","Params":"vtype=M&_cfl=note&_loc="+Erp.GetFieldValue("@siteou")+"&_prty="+Erp.GetFieldValue("@helper_am"),"Location":"New"}
                );
}
function hideCdNo()
{
  if(vType == "CN" || vType == "DN")
  {
    if(Fn.Eq( Erp.GetFieldValue("@modeoftransactionnote"),"AgainstPurchase"))
    {
      Erp.SetDisplay("@purchasecdnumber",true);
      Erp.SetDisplay("lblCdNo",true);
      Erp.SetMandatory("@purchasecdnumber",true);
      Erp.SetDisplay("@purchasecddate",true);
      Erp.SetMandatory("@purchasecddate",true);
    }
    else
    {
      Erp.SetDisplay("@purchasecdnumber",false);
      Erp.SetDisplay("lblCdNo",false);
      Erp.SetMandatory("@purchasecdnumber",false);
      Erp.SetDisplay("@purchasecddate",false);
      Erp.SetMandatory("@purchasecddate",false);
    }
    if(vType == "DN")
      Erp.SetLabel('lblCdNo','Received Credit Note No');
    else if (vType == "CN")
      Erp.SetLabel('lblCdNo','Received Debit Note No');
  }
  else{
    Erp.SetDisplay("@purchasecdnumber",false);
    Erp.SetDisplay("@purchasecddate",false);
    Erp.SetDisplay("lblCdNo",false);
  }
}
function SetLabelsVoucherWise()
{
  if(vType == "S"  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
    Erp.SetDisplay("lblVNumber","Sales Invoice Number");
}
function dgTiRowAdding(gridId,args){
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
  if (vType=='P' || vType=='E' || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstpurchase")) || vType=='PY'  || subvType=='AP' )
    Erp.Grid.SetEditorValue(gridId,'amti',PurchaseAccount);
  else if (vType=='S' || ((vType=='CN' || vType=='DN') && Fn.Eq(modeof_t,"againstsales")) || vType == 'R'  || subvType=='AR'  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'   || vType == 'SO'  )
    Erp.Grid.SetEditorValue(gridId,'amti',SalesAccount);
}
function InvoiceTypeChanged(elem,data,field)
{
  var inward=Fn.CBool(db_fld_55);
  var outward=Fn.CBool(db_fld_56);
  if(inward && outward)
  {
    Toggle_importdetails();
    Toggle_exportdetails();
  }
  else if(inward)
    Toggle_importdetails();
  else if(outward)
    Toggle_exportdetails();
  ChangeSupplyType();
  setTransType();
  

   GSC_Changed();
  toggle_PrevGstB2cl();
}
function taxreg_changed(elem,data,field)
{
  Erp.SetFieldValue('@tterms','');
  Erp.SetParam('@previoustr','taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetParam(window,'taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetFieldValue("@previoustr","");
  if( WhetherIncomingSupplyType())
    Erp.SetFieldValue('@pos',db_fld_9);
  else
    Erp.SetFieldValue('@pos',helper_OUState);
  SaveCountryState();
  ChangeSupplyType();
   //console.log("taxreg_changed")
  
  
  if (data.RecordID!=oldTaxReg)
  {
  	Erp.SetFieldValue('@transactionseries','');
  }
  	Erp.SetParam('@transactionseries','taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetParam('@transactionseries','vtddl',Erp.GetFieldValue("@vt"));
   Erp.SetParam('@transactionseries','OU',Erp.GetFieldValue("@siteou"));
  
  oldTaxReg=Erp.GetFieldValue("@taxreg");
  Erp.SetFieldValue('@roundingoff',db_fld_58);
  if(Erp.LayoutMode == 'A')
  Erp.LoadVariable('DefaultTerms',settransterms);
}
function settransterms()
{
    Erp.SetFieldValue('@tterms',DefaultTerms);
}
function PrevTR_Disable()
{
  
  if((vType == 'RV' ||  vType == 'CN' ||  vType == 'DN' ) 	){
    
    var dispCol=Fn.CBool(Erp.GetFieldValue('@pregst')) ? true :false;
    
    Erp.SetEnable('@supplytype',dispCol);
    Erp.SetEnable('@pos',dispCol);
    Erp.SetEnable('@gstsupplycategory',dispCol);
    Erp.SetEnable('@invoicetype',dispCol);
    Erp.SetEnable('@ecomtran',dispCol);
    Erp.SetEnable('@ecommerceoperatoram',dispCol);
    Erp.SetEnable('@isreversechargeapplicable',dispCol);
     Erp.SetEnable('@defaulttransactionbank',dispCol);
    if(vType == 'RV')
    {
      Erp.SetEnable('@helper_am1',dispCol);
      Erp.SetEnable('@helper_tm',dispCol);
      Erp.SetEnable('@helper_chequedrawnon',dispCol);
      Erp.SetEnable('@helper_chequedate',dispCol);
      Erp.SetEnable('@helper_tmreferenceno',dispCol);
      Erp.SetEnable('@advanceamount',dispCol);
      Erp.SetEnable('@helper_amount1',dispCol);
      Erp.SetEnable('gridTI',dispCol);
    }
    
  }
}
function setTransType()
{
  var gstin=Fn.CStr(db_fld_0);
  var supplyType=Erp.GetFieldValue("@supplytype");
  var invCode=db_fld_4;
  var gstsupplycategory=Erp.GetFieldValue("@gstsupplycategory");
  var amount= Fn.CFlt(Erp.GetLabel("lblTotalAmount"));
  var transType="";
  if(!Fn.IsEmpty(gstin))
    transType="B2B";
  else if(Fn.Eq(supplyType,"inter-state") && amount >= 250000 )
    transType="B2CL";
  else 
  {
    if(Fn.Eq(invCode ,"DE")  || Fn.Eq(invCode ,"WPAY")  || Fn.Eq(invCode ,"WOPAY")) 
      transType="EXP";
    else if( Fn.Eq(invCode ,"IMPG")  || Fn.Eq(invCode ,"IMPS") )
      transType=invCode;
    else if(gstsupplycategory != "Taxable")
      transType="NIL";
    else
      transType="B2CS";
  }
  $("#PageTitle").find(".transtype").remove();
  $("#PageTitle").find("._t").after($("<span class='transtype'> { "+transType+" } </span>"))
}
function POS_Changed()
{
  //taxLoaded=false;
  ChangeSupplyType();

  set_ItemTaxLoaded();
  setTransType();
}
function isinvoiceagainstadvance_changed()
{
  if(vType == "S" || vType == "P"  || vType=='DC' || vType == 'PI' || vType == 'Q'   || vType == 'BOS'  || vType == 'SO'   ){
    var isinvoiceagainstadvance=Fn.CBool(Erp.GetFieldValue("@isinvoiceagainstadvance"));
    Erp.SetDisplay("btnAdvInv",isinvoiceagainstadvance);
    if(isinvoiceagainstadvance){
      Erp.SetParam('dgAdvInv','party',Erp.GetFieldValue("@helper_am"));
      Erp.SetParam('dgAdvInv','invid',Erp.GetParam("ID"));
      Erp.SetParam('dgAdvInv','dot',Erp.GetFieldValue("@voucherdate"));
       Erp.SetParam('dgAdvInv','rcm',Erp.GetFieldValue("@isreversechargeapplicable"));
    }
    if( vType == "P"){
      Erp.SetDisplay("@isinvoiceagainstadvance",Fn.CBool(Erp.GetFieldValue("@isreversechargeapplicable")));
      Erp.SetDisplay("btnAdvInv",isinvoiceagainstadvance);
    }
    Erp.SetDisplay("trAgainstAdvance",(vType!='DC' && vType!='PI' && vType!='Q'  && vType!='BOS'   && vType != 'SO'  ));
  }
  else
  {
    Erp.SetDisplay("trAgainstAdvance",false);
    Erp.SetDisplay("btnAdvInv",false);
    Erp.SetDisplay("@isinvoiceagainstadvance",false);
  }
}
function showAdvances()
{
  Erp.OpenPopup('pnlAdvanceInv',{
    onClose:function(){
    }
  }
               );
  Erp.SetDisplay('pnlAdvanceInv',true);
}
function OnCellEditing_dgAdvInv(gridId,args){
  /* if (args.colName=='adv_t')
  {
      args.editor.SetParam('_fc','lu_advanceTrans');
     args.editor.SetParam('party',Erp.GetFieldValue("@helper_am"));
    args.editor.SetParam('invid',Erp.GetParam("ID"));
  args.editor.SetParam('dot',Erp.GetFieldValue("@voucherdate"));
  }
  else*/ 
  if (args.colName=='ti')
  {
    args.editor.SetParam('party',Erp.GetFieldValue("@helper_am"));
    args.editor.SetParam('gstin',Erp.GetFieldValue("@taxreg"));
    args.editor.SetParam('dot',Erp.GetFieldValue("@voucherdate"));
     args.editor.SetParam('rcm',Erp.GetFieldValue("@isreversechargeapplicable"));
    args.editor.SetParam('_fc','lu_tiadvance');
  }
  else if (args.colName=='del')
  {
    delAdvInvRow(args.row);
  }
}
function OnCellChanged_dgAdvInv(gridId,args){
  if (args.colName=='ti')
  {
    if (args.value.Keys.length>0)    
      Erp.Grid.SetEditorValue(gridId,'adv_t',Fn.CStr(args.value.Keys[0]));
    if (args.value.CurrentRow.length>0)    
    {
      var tr=$(args.value.CurrentRow[0]);
      var balamt=Fn.CFlt( tr.find(".balamt").html());
      var baltaxable=Fn.CFlt( tr.find(".baltaxable").html());
      var balsgst=Fn.CFlt( tr.find(".balsgst").html());
      var balcgst=Fn.CFlt( tr.find(".balcgst").html());
      var baligst=Fn.CFlt( tr.find(".baligst").html());
      var balcess=Fn.CFlt( tr.find(".balcess").html());
      var gstrate=Fn.CFlt( tr.find(".gstrate").html());
      Erp.Grid.SetEditorValue(gridId,'adjamt',balamt);
      Erp.Grid.SetEditorValue(gridId,'adjustedtaxablevalue',baltaxable);
      Erp.Grid.SetEditorValue(gridId,'adjustedsgst',balsgst);
      Erp.Grid.SetEditorValue(gridId,'adjustedcgst',balcgst);
      Erp.Grid.SetEditorValue(gridId,'adjustedigst',baligst);
      Erp.Grid.SetEditorValue(gridId,'adjustedgstcess',balcess);
      Erp.Grid.SetEditorValue(gridId,'gstrate',gstrate);
    }
  }
  else if (args.colName=='adjamt')
  {
    var adjustedtaxablevalue=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'adjustedtaxablevalue',args.row));
    var adjustedsgst=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'adjustedsgst',args.row));
    var adjustedcgst=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'adjustedcgst',args.row));
    var adjustedigst=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'adjustedigst',args.row));
    var adjustedgstcess=Fn.CFlt(Erp.Grid.GetEditorValue(gridId,'adjustedgstcess',args.row));
    var amtCrnt=args.value;
    var sgstrate=(adjustedsgst/adjustedtaxablevalue)*100;
    var igstrate=(adjustedigst/adjustedtaxablevalue)*100;
    var cgstrate=(adjustedcgst/adjustedtaxablevalue)*100;
    var gstcessrate=(adjustedgstcess/adjustedtaxablevalue)*100;
    Erp.Grid.SetEditorValue(gridId,'adjustedtaxablevalue',amtCrnt);
    Erp.Grid.SetEditorValue(gridId,'adjustedcgst',(amtCrnt*cgstrate/100));
    Erp.Grid.SetEditorValue(gridId,'adjustedsgst',(amtCrnt*sgstrate/100));
    Erp.Grid.SetEditorValue(gridId,'adjustedigst',(amtCrnt*igstrate/100));
    Erp.Grid.SetEditorValue(gridId,'adjustedgstcess',(amtCrnt*gstcessrate/100));
  }
  else if (args.colName=='del')
  {
    delAdvInvRow(args.row);
  }
  CalculateColFooter_Adv();
}
function OnCellEditingOC(gridId,args){
  var modeof_t=Fn.ToLowerCase( Erp.GetFieldValue("@modeoftransactionnote"));
   if (vType=='S' || vType=='BOS' || ( (vType == 'CN' || vType=='BOS' ) && Fn.Eq(modeof_t,'againstsales') ) ||  vType=='AR'  ||  vType=='RV'  ||  vType=='DC')
   {
       args.editor.SetParam('_fc','lu_other_charges_income');
   }
  else
      args.editor.SetParam('_fc','lu_other_charges_Expense');
  
   /*if (args.colName=='am')
    args.editor.SetParam('_fc','lu_other_charges');*/
}
function hideAdvancePopup()
{
  Erp.HidePopup('pnlAdvanceInv');
  return false;
}
function DistributeOC()
{
  var apportionate_cg=0;
  var apportionate_og=0;
  var apportionate_inv=0;
  var apportionate_ser=0;
  var grandTotal=0;
  var gridID="gridOC";
  var rowCount=Erp.Grid.GetRows(gridID).length;
  var gridID1="gridTI";
  var rowCount1=Erp.Grid.GetRows(gridID1).length;
  var error=false;
  gridID="gridTI";
  rowCount=Erp.Grid.GetRows(gridID).length;
  var netTotal_ticg=0;
  var netTotal_tiog=0;
  var netTotal_tiser=0;
  var netTotal_tiinv=0;
  var netTotal=Fn.CFlt(Erp.Grid.CalculateColumn('gridTI','nettotal','SUM'));
  if(netTotal > 0){
    for(var i=0;i<rowCount ; i++)
    {
      if(Fn.Eq( Erp.Grid.GetRowState(gridID,i),"DELETED"))
        continue;
      var itmType=Erp.Grid.GetEditorValue(gridID,'itmnaturecode',i);
      var netTotal_ti=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'nettotal',i));
      if(!Fn.IsEmpty(itmType))
      {
        if(Fn.Eq(itmType,'cg'))
          netTotal_ticg=netTotal_ticg+netTotal_ti;
        if(Fn.Eq(itmType,'og'))
          netTotal_tiog=netTotal_tiog+netTotal_ti;
        if(Fn.Eq(itmType,'ser'))
          netTotal_tiser=netTotal_tiser+netTotal_ti;
        if(Fn.Eq(itmType,'inv'))
          netTotal_tiinv=netTotal_tiinv+netTotal_ti;
      }
      Erp.Grid.SetEditorValue(gridID,'othercharge',i,0);
    }
    var scat=  Erp.GetFieldValue('@gstsupplycategory');
    if(!Fn.Eq(scat,'Taxable'))
      return ;
    gridID="gridOC";
    rowCount=Erp.Grid.GetRows(gridID).length;
    for(var i=0;i<rowCount ; i++)
    {
      if(Fn.Eq( Erp.Grid.GetRowState(gridID,i),"DELETED"))
        continue;
      var amnature=Erp.Grid.GetEditorValue(gridID,'amnature',i);
      var debitcredit=Erp.Grid.GetEditorValue(gridID,'debitcredit',i);
      var c_amt=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'creditamount',i));
      var d_amt=Fn.CFlt(Erp.Grid.GetEditorValue(gridID,'debitamount',i));
      var amtToDistribute=d_amt;
      if(Fn.Eq( debitcredit, "C"))
        amtToDistribute=c_amt;
      if(!Fn.IsEmpty(amnature))
      {
        var arr=amnature.split('|');
        if(arr.length >= 4){
          var isgst=Fn.CBool(arr[0]);
          var isapportionate_cg=Fn.CBool( arr[1]);
          var isapportionate_og=Fn.CBool(arr[2]);
          var isapportionate_inv=Fn.CBool(arr[3]);
          var isapportionate_ser=Fn.CBool(arr[4]);
          if(isgst){
            var totalDistribution=0;
            if(isapportionate_cg)
              totalDistribution+=netTotal_ticg
              if(isapportionate_og)
                totalDistribution+=netTotal_tiog
                if(isapportionate_inv)
                  totalDistribution+=netTotal_tiinv
                  if(isapportionate_ser)
                    totalDistribution+=netTotal_tiser
                    for(var k=0;k<rowCount1 ; k++)
                    {
                      if(Fn.Eq( Erp.Grid.GetRowState(gridID1,k),"DELETED"))
                        continue;
                      var itmType=Erp.Grid.GetEditorValue(gridID1,'itmnaturecode',k);
                      var netTotal_ti=Fn.CFlt(Erp.Grid.GetEditorValue(gridID1,'nettotal',k));
                      var calcAmt=0;
                      if(!Fn.IsEmpty(itmType))
                      {
                        if(Fn.Eq(itmType,'cg')  && isapportionate_cg){
                          calcAmt=amtToDistribute*(netTotal_ti/totalDistribution);
                        }
                        if(Fn.Eq(itmType,'og') && isapportionate_og)
                        {
                          calcAmt=amtToDistribute*(netTotal_ti/totalDistribution);
                        }
                        if(Fn.Eq(itmType,'ser') && isapportionate_ser)
                        {
                          calcAmt=amtToDistribute*(netTotal_ti/totalDistribution);
                        }
                        if(Fn.Eq(itmType,'inv') && isapportionate_inv)
                        {
                          calcAmt=amtToDistribute*(netTotal_ti/totalDistribution);
                        }
                        calcAmt+= Erp.Grid.GetEditorValue(gridID1,'othercharge',k);
                        Erp.Grid.SetEditorValue(gridID1,'othercharge',k,Fn.Round( calcAmt,2));
                      }
                    }
          }
        }
      }
    }
  }
    var isExport=false;
  var ex_Code=Fn.ToUpperCase( db_fld_4);
  if(ex_Code == "WOPAY")
    isExport=true;
  
  for(var k=0;k<rowCount1 ; k++)
  {
    var taxablevalue=Fn.CFlt( Erp.Grid.GetEditorValue('gridTI','taxablevalue',k));
    var othercharge=Fn.CFlt( Erp.Grid.GetEditorValue('gridTI','othercharge',k));
    Erp.Grid.SetEditorValue('gridTI','finaltaxable',k,( taxablevalue+othercharge));
    CalculateRow('othercharge');
  }
  CalcTaxesAll();
  return false;
}
function CalculateColFooter_Adv()
{
  var gridid='dgAdvInv';
  CalculateColFooter(gridid,'adjamt');
  CalculateColFooter(gridid,'adjustedtaxablevalue');
  CalculateColFooter(gridid,'adjustedsgst');
  CalculateColFooter(gridid,'adjustedcgst');
  CalculateColFooter(gridid,'adjustedigst');
  CalculateColFooter(gridid,'adjustedgstcess');
  CalculateColFooter(gridid,'gstrate');
  var Total=Fn.Round(Erp.Grid.CalculateColumn(gridid,'adjamt','SUM'),2);
  var btnText='Advance Receipts ( '+Total+' ) ';
  if(vType == "P" || vType == "E")
    btnText='Advance Payment ( '+Total+' ) ';
  Erp.SetButtonLabel('btnAdvInv',  btnText);
}
function OnGridDataBound_dgAdvInv(gridId,args){
  CalculateColFooter_Adv();
}


function vtypeChanged()
{
  Erp.SetFieldValue('@transactionseries','');
  Erp.SetParam('@transactionseries','taxreg',Erp.GetFieldValue("@taxreg"));
  Erp.SetParam('@transactionseries','vtddl',Erp.GetFieldValue("@vt"));
}

function roundOffAmount()
{
 FinalShowOfTotals();
}

function pregst_changed()
{
  
  var  pregst=Erp.GetFieldValue('@pregst');
  
  if(pregst)
  {
    Erp.SetDisplay('@pregstinvoicenumber',true);
    Erp.SetDisplay('@preinvoicedate',true);
    
     Erp.SetMandatory('@pregstinvoicenumber',true);
    Erp.SetMandatory('@preinvoicedate',true);
    
       Erp.SetMandatory('@previoustr',false);
    
     Erp.SetDisplay('@previoustr',false);
    Erp.SetDisplay('lblInvoiceNo',false);
    
    if(vType == "RV"){
      Erp.SetLabel('lblPreNumber-Ctr','Pre GST RV Number');
      Erp.SetLabel('lblPreDate-Ctr','Pre GST RV Date');
        Erp.SetDisplay('invDetails',false);
      
    }
    else
    {
       Erp.SetLabel('lblPreNumber','Pre Invoice Number');
      Erp.SetLabel('lblPreDate','Pre Invoice Date');
    }
      
  }
  else
  {
     Erp.SetDisplay('@pregstinvoicenumber',false);
    Erp.SetDisplay('@preinvoicedate',false);
    
    Erp.SetMandatory('@pregstinvoicenumber',false);
    Erp.SetMandatory('@preinvoicedate',false);
    
     Erp.SetMandatory('@previoustr',true);
    Erp.SetDisplay('invDetails',true);
    Erp.SetDisplay('@previoustr',true);
    Erp.SetDisplay('lblInvoiceNo',true);
  }
   
  PrevTR_Disable();
  toggle_PrevGstB2cl();
}


function set_ItemTaxLoaded()
{
  var crnt_supplytype=Erp.GetFieldValue('@supplytype');
 var crnt_invtype=Erp.GetFieldValue('@invoicetype');
 var crnt_supplycat=Erp.GetFieldValue('@gstsupplycategory');
  
  if( (old_supplytype  != crnt_supplytype ) || (old_invtype != crnt_invtype) || (old_supplycat != crnt_supplycat))
  {
    old_supplytype=crnt_supplytype;
    old_invtype=crnt_invtype;
    old_supplycat=crnt_supplycat;
    LoadTaxList();
   
    
  }
}


function toggle_PrevGstB2cl()
{
                var pre_gstb2cl=false;
  var modeoftransactionnote=Erp.GetFieldValue('@modeoftransactionnote');
  
  if(Fn.Eq(modeoftransactionnote,  "AgainstSales") || vType== 'RV')
  {
  
  var pre_gst=Fn.CBool(Erp.GetFieldValue('@pregst'));
  var helperAmGstin=db_fld_0;
  var invCode=db_fld_4 ;
  
  if(pre_gst && Fn.IsEmpty(helperAmGstin) && Fn.Eq(invCode,'R'))
  pre_gstb2cl=true;
  
    
  }
  if(!pre_gstb2cl)
  Erp.SetFieldValue('@pregst_b2cl',false);
  
  Erp.SetDisplay('@pregst_b2cl',pre_gstb2cl);
}

function setOtherInfo_GST()
{
  if(Erp.LayoutMode != 'A')
  {
    Erp.SetDisplay('lblGstinFiled',true);
    Erp.SetDisplay('lblGstinFiledDate',true);
     Erp.SetDisplay('lblFp',true);
     var gstFiled ='';
    var gstDate='';
    var taxformperiod='';
    
    if(Fn.IsEmpty(db_fld_0) && db_fld_65 == 'IAS')
    {
      gstFiled='This record is part of summary';
      gstDate='';
      Erp.SetDisplay('btn_filed',false);
    }
    else if(Fn.IsEmpty(db_fld_0) && db_fld_65 == 'IES' && db_fld_68 < 250000)
    {
        gstFiled='This record is part of summary';
      gstDate='';
      Erp.SetDisplay('btn_filed',false);
    }
    else if(db_fld_69 && !db_fld_70 && !db_fld_71)
    {
       gstFiled='This record is uploaded on GSTN';
      gstDate='';
      $('.infogst').addClass('filed');
      Erp.SetDisplay('btn_filed',false);
    }
      else if(db_fld_69 && !db_fld_70 && db_fld_71)
    {
       gstFiled='This record is deleted on GSTN';
      gstDate='';
       $('.infogst').addClass('redfiled');
      Erp.SetDisplay('btn_filed',false);
    }
    else{
     gstFiled =(db_fld_69 ? 'Uploaded On GSTIN' : 'Not Uploaded On GSTIN');
      
    
      if(db_fld_69)
    $('.infogst').removeClass('notfiled').addClass('filed');
    }
    
      if(db_fld_69)
      {
        if(!Fn.IsEmpty(db_fld_78) &&  (db_fld_78  != db_fld_80)){
          gstDate ='Filed On '+Fn.Format( Fn.CDate(db_fld_81),'{0:dd-MM-yyyy hh:mm:sss}') ;
           taxformperiod=(db_fld_69 && !Fn.IsEmpty(db_fld_80)) ? 'Period : '+db_fld_84 : '';
        }
        else{
           gstDate ='Filed On '+Fn.Format( Fn.CDate(db_fld_85),'{0:dd-MM-yyyy hh:mm:sss}') ;
          taxformperiod='Period : '+ db_fld_86 ;
        }
        Erp.SetDisplay('btn_filed',false);
      }
           
     
    
   
    if(!Fn.IsEmpty(gstFiled))
    Erp.SetLabel('lblGstinFiled',gstFiled);
    else
      Erp.SetDisplay('lblGstinFiled',false);
    
    if(!Fn.IsEmpty(gstDate))
     Erp.SetLabel('lblGstinFiledDate',gstDate);
    else
       Erp.SetDisplay('lblGstinFiledDate',false);
    
     if(!Fn.IsEmpty(taxformperiod))
     Erp.SetLabel('lblFp',taxformperiod);
    else
       Erp.SetDisplay('lblFp',false);
  }
  
}
function setmarkasfiled()
{
  Erp.OpenWindow({"Action":"EDITFORM","Entity":"tbl_ERP_t","Form":"layout_markasfiled","RecordID":Fn.GetProp('ID'),"Refresh":false,"Global":false,"Title":"Mark As Filed","Params":"","Location":"Popup","PopHt":"293","PopWd":"672"})
  
}

