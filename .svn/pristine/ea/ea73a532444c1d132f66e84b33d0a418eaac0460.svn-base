function InitUI() {$('#PageTitle').children('._i').html('&#xF0E8;').next().html("Lead");PkIds=[];
GridList.push({ID:"gridLeadReview",BindOnload:true,Title:"Grid",AdvFilter:[],GroupInfo:[],OnBind:null});
initGridSettings("gridLeadReview");
GridList.push({ID:"gridLeadStage",BindOnload:true,Title:"Grid",AdvFilter:[{Type:'LIST',Title:"Rectype",Field:'',FieldID:'advFld2',Eid:"tbl_SC_recordtype",Qry:"84K2fFAkxYXiGD3hdjXxY3SSmMSvtbsO7uWIv07Vpjm7lNHXssbI8UDTLSBMhA4+ScqF3HUeL8voH7CIOmD4ow=="}],GroupInfo:[],OnBind:null});
initGridSettings("gridLeadStage");
$('#htmlwindow').iframeAutoHeight({minHeight:50,heightOffset:10,triggerFunctions:[function(resizeFunction, iframe){$('#htmlwindow').on('resize',function () { resizeFunction(iframe);});}]});


DbReferences.push({Id:"leadcount",Type:"Table",OnDemand:1,EntityId:"tbl_SC_lead",Columns:"",Xml:"<Layout\><Grid Id=\"tbl_SC_lead\"\><ColInfo\><Cols Type=\"subquery\" Title=\"newlead\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2 and 3 and 4\"\><Condition Name=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" EntityPath=\"\" Operator=\"NotIn\" Value=\"Lead ID of tbl_SC_leadactivity where &lt;br/&gt;( [LeadActivityCategoryCode] In {'SMS,Email,Followup,Site Visit,Calls,Notes'} )&lt;br/&gt;&lt;br/&gt; order by \" ValueSrc=\"SubQuery\" WFName=\"\" SessionID=\"\" Srno=\"1\"\><Subquery Table=\"tbl_SC_leadactivity\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"lead:tbl_SC_lead\" Summary=\"None\" Logic=\"1\"\><Condition Name=\"207f2106-b2dd-476d-a0df-64c1ce18096a\" EntityPath=\"leadactivitycategory:tbl_SC_leadactivitycategory\" Operator=\"In\" Value=\"SMS,Email,Followup,Site Visit,Calls,Notes\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Condition\><Condition Name=\"60a0e5bd-9c84-4b2f-89e1-e16b4b21f367\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"True\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Condition Name=\"4b0a45cc-f1a8-41f9-b5e9-22c545b22521\" EntityPath=\"current_leadstage:tbl_SC_leadstage&gt;recordtype:tbl_SC_recordtype\" Operator=\"EqualTo\" Value=\"L\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"4\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"unqualifiedlead\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2 and 3\"\><Condition Name=\"60a0e5bd-9c84-4b2f-89e1-e16b4b21f367\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"True\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"77f0aba9-2c4f-483f-baf7-1ee4b72b26e8\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"L\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"qualifiedlead\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2 and 3 and 4 and 5 and 6 and 7\"\><Condition Name=\"60a0e5bd-9c84-4b2f-89e1-e16b4b21f367\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"False\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"77f0aba9-2c4f-483f-baf7-1ee4b72b26e8\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"L\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Condition Name=\"efa6326f-2004-45f5-9ee2-b4f318fad9e1\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"False\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Condition Name=\"4cfbdc97-de49-46cf-8f76-cb42bc2d5215\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"False\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"4\"\></Condition\><Condition Name=\"104ddfb8-31f3-4594-8dde-ecee0f3cc9e5\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"False\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"5\"\></Condition\><Condition Name=\"3dd84e90-56a7-4d7b-a52c-907cdb9aa160\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"False\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"6\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"7\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"leadtopp\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2\"\><Condition Name=\"efa6326f-2004-45f5-9ee2-b4f318fad9e1\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"True\" ValueSrc=\"CheckBox\" ValueEntityPath=\"\" WFEID=\"\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"77f0aba9-2c4f-483f-baf7-1ee4b72b26e8\" EntityPath=\"current_leadstage:tbl_SC_leadstage\" Operator=\"EqualTo\" Value=\"L\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"listofleads\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2\"\><Condition Name=\"4b0a45cc-f1a8-41f9-b5e9-22c545b22521\" EntityPath=\"current_leadstage:tbl_SC_leadstage&gt;recordtype:tbl_SC_recordtype\" Operator=\"EqualTo\" Value=\"L\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"leadswithoutuseractivitycount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_lead\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"\" Summary=\"Count\" Logic=\"1 and 2\"\><Condition Name=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" EntityPath=\"\" Operator=\"In\" Value=\"Last(Lead ID) of tbl_SC_leadactivity where &lt;br/&gt;( [LeadActivityTypeCode] NotEqualTo {'Outgoing'} )&lt;br/&gt;&lt;br/&gt; order by Activity Date Desc\" ValueSrc=\"SubQuery\" WFName=\"\" SessionID=\"\" Srno=\"1\"\><Subquery Table=\"tbl_SC_leadactivity\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"lead:tbl_SC_lead\" Summary=\"Last\" Logic=\"1\"\><Condition Name=\"d6bb82b1-a1ca-48cd-82d2-2adfda699677\" EntityPath=\"leadactivitytype:tbl_SC_leadactivitytype\" Operator=\"NotEqualTo\" Value=\"Outgoing\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Sort\><ColInfo\><Cols Name=\"f14cfc6a-67e3-48d9-975d-944ced65b454\" EntityPath=\"\" Sort=\"Desc\" fieldtype=\"-999\" /\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"scheduledtaskcount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_leadactivity\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"lead:tbl_SC_lead\" Summary=\"Count\" Logic=\"1 and 2 and 3\"\><Condition Name=\"dda032f3-fe67-4e26-a1c8-975fa8944dc3\" EntityPath=\"leadactivitycategory:tbl_SC_leadactivitycategory\" Operator=\"EqualTo\" Value=\"Followup\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"lead:tbl_SC_lead&gt;current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Condition Name=\"ed0767e3-94e3-4746-a3b6-85b46513d844\" EntityPath=\"\" Operator=\"IsNullOrEmpty\" Value=\"\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\><Cols Type=\"subquery\" Title=\"scheduledsitevisitcount\" Sort=\"\" Width=\"75\" ID=\"#GUID#\" Status=\"1\"\><Subquery Table=\"tbl_SC_leadactivity\" Target=\"5e294de6-3ef4-4829-b531-233ab1af4cc0\" TargetType=\"Single\" EntityPath=\"lead:tbl_SC_lead\" Summary=\"Count\" Logic=\"1 and 2 and 3\"\><Condition Name=\"dda032f3-fe67-4e26-a1c8-975fa8944dc3\" EntityPath=\"leadactivitycategory:tbl_SC_leadactivitycategory\" Operator=\"EqualTo\" Value=\"Site Visit\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"1\"\></Condition\><Condition Name=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" EntityPath=\"lead:tbl_SC_lead&gt;current_leadowner:tbl_SYS_Users\" Operator=\"EqualTo\" Value=\"c566fc3a-e9f0-4d08-bb34-4aa574c184cc\" ValueSrc=\"UserSession\" ValueEntityPath=\"\" WFName=\"\" SessionID=\"\" Srno=\"2\"\></Condition\><Condition Name=\"f7ea3942-64f2-4f81-abcc-9efb60449b34\" EntityPath=\"\" Operator=\"TODAY\" Value=\"\" ValueSrc=\"Input\" WFName=\"\" SessionID=\"\" Srno=\"3\"\></Condition\><Sort\><ColInfo\></ColInfo\></Sort\><Parameters\></Parameters\></Subquery\></Cols\></ColInfo\></Grid\></Layout\>",AlwaysLoad:false });window.leadcount='';
 mxEntityList={};

Erp.ShowMessage("--[cnt_newlead]\n select count (*) from (--QUERY BEGIN--\r\n\r\nselect \r\n  tbl_sc_lead.[lead_pid] as [tbl_sc_lead_lead_pid],tbl_sc_lead.[createddate] as [tbl_sc_lead_createddate],\r\ntbl_sc_lead.[leadnumber] as [tbl_sc_lead_leadnumber],\r\ntbl_parentlead.[leadnumber] as [tbl_parentlead_leadnumber],\r\ntbl_assigned_campaign.[campaignname] as [tbl_assigned_campaign_campaignname],\r\ntbl_sc_lead.[contactpersonname] as [tbl_sc_lead_contactpersonname],\r\ntbl_assigned_enquirysource.[enquirysourcename] as [tbl_assigned_enquirysource_enquirysourcename],\r\ntbl_assigned_enquirysubsource.[enquirysubsourcename] as [tbl_assigned_enquirysubsource_enquirysubsourcename],\r\n[tbl_sc_lead_interestedproducts],\r\ntbl_current_leadstage.[stagecode] as [tbl_current_leadstage_stagecode],\r\ntbl_sc_lead.[latestnote] as [tbl_sc_lead_latestnote],\r\ntbl_current_leadowner.[username] as [tbl_current_leadowner_username],\r\ntbl_sc_lead.[personalemail] as [tbl_sc_lead_personalemail],\r\nviewrec,\r\neditrecord,\r\ndeleterecord,\r\ntbl_current_leadstage_recordtype.[recordtypecode] as [tbl_current_leadstage_recordtype_recordtypecode],\r\ntbl_sc_lead.[parentlead] as [tbl_sc_lead_parentlead]   from \r\ntbl_sc_lead \n left join tbl_SC_leadstage as compflt_tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=compflt_tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SC_recordtype as compflt_tbl_current_leadstage_recordtype on compflt_tbl_current_leadstage.[recordtype]=compflt_tbl_current_leadstage_recordtype.[recordtype_pid]  \n left join tbl_SYS_Users as compflt_tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=compflt_tbl_current_leadowner.[Users_pid]      \r\n\n left join tbl_SC_lead as tbl_parentlead on tbl_sc_lead.[parentlead]=tbl_parentlead.[lead_pid]  \n left join tbl_SC_campaign as tbl_assigned_campaign on tbl_sc_lead.[assigned_campaign]=tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as tbl_assigned_enquirysource on tbl_sc_lead.[assigned_enquirysource]=tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as tbl_assigned_enquirysubsource on tbl_sc_lead.[assigned_enquirysubsource]=tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n left join tbl_SC_leadstage as tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=tbl_current_leadowner.[Users_pid]  \n left join tbl_SC_recordtype as tbl_current_leadstage_recordtype on tbl_current_leadstage.[recordtype]=tbl_current_leadstage_recordtype.[recordtype_pid]   \r\n outer apply \r\n    (select dbo.CsvResult('tbl_SC_lead_interestedproducts',tbl_sc_lead.[lead_pid]) as [tbl_sc_lead_interestedproducts]  )  as x_tbl_sc_lead_interestedproducts \r\n  \r\n outer apply \r\n ( select '' as [viewrec] ) as x_viewrec \r\n  \r\n outer apply \r\n ( select '' as [editrecord] ) as x_editrecord \r\n  \r\n outer apply \r\n ( select '' as [deleterecord] ) as x_deleterecord \r\n \r\n WHERE 1=1  and isnull(tbl_sc_lead.IsDeleted,0)=0 and isnull(tbl_sc_lead.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_lead.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( isnull(tbl_sc_lead.[lead_pid],'')  NOT IN (\n(select  \n isnull(sub_tbl_lead.[lead_pid],'')  as __subqueryField \n from tbl_SC_leadactivity as sub_tbl_SC_leadactivity\n\n left join tbl_SC_lead as sub_tbl_lead on sub_tbl_SC_leadactivity.[lead]=sub_tbl_lead.[lead_pid]  \n left join tbl_SC_leadactivitycategory as sub_tbl_leadactivitycategory on sub_tbl_sc_leadactivity.[leadactivitycategory]=sub_tbl_leadactivitycategory.[leadactivitycategory_pid]  \n where 1=1 \nand ( isnull(sub_tbl_leadactivitycategory.[leadactivitycategorycode],'')  IN ('SMS','Email','Followup','Site Visit','Calls','Notes')  ) \r\n and sub_tbl_SC_leadactivity.company_fid=@Users.CompanyID)\n)  and compflt_tbl_current_leadstage.[initialstage] = 1  and compflt_tbl_current_leadstage_recordtype.[recordtypecode] = 'L'  and compflt_tbl_current_leadowner.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   )     \r\n) as tbl ;\n--[cnt_missingaction]\nselect count (*) from (--QUERY BEGIN--\r\n\r\nselect \r\n  tbl_sc_lead.[lead_pid] as [tbl_sc_lead_lead_pid],tbl_sc_lead.[createddate] as [tbl_sc_lead_createddate],\r\ntbl_sc_lead.[leadnumber] as [tbl_sc_lead_leadnumber],\r\ntbl_parentlead.[leadnumber] as [tbl_parentlead_leadnumber],\r\ntbl_assigned_campaign.[campaignname] as [tbl_assigned_campaign_campaignname],\r\ntbl_sc_lead.[contactpersonname] as [tbl_sc_lead_contactpersonname],\r\ntbl_assigned_enquirysource.[enquirysourcename] as [tbl_assigned_enquirysource_enquirysourcename],\r\ntbl_assigned_enquirysubsource.[enquirysubsourcename] as [tbl_assigned_enquirysubsource_enquirysubsourcename],\r\n[tbl_sc_lead_interestedproducts],\r\ntbl_current_leadstage.[stagecode] as [tbl_current_leadstage_stagecode],\r\ntbl_sc_lead.[latestnote] as [tbl_sc_lead_latestnote],\r\ntbl_current_leadowner.[username] as [tbl_current_leadowner_username],\r\ntbl_sc_lead.[personalemail] as [tbl_sc_lead_personalemail],\r\nviewrec,\r\neditrecord,\r\ndeleterecord,\r\ntbl_current_leadstage_recordtype.[recordtypecode] as [tbl_current_leadstage_recordtype_recordtypecode],\r\ntbl_sc_lead.[parentlead] as [tbl_sc_lead_parentlead]   from \r\ntbl_sc_lead \n left join tbl_SYS_Users as compflt_tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=compflt_tbl_current_leadowner.[Users_pid]      \r\n\n left join tbl_SC_lead as tbl_parentlead on tbl_sc_lead.[parentlead]=tbl_parentlead.[lead_pid]  \n left join tbl_SC_campaign as tbl_assigned_campaign on tbl_sc_lead.[assigned_campaign]=tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as tbl_assigned_enquirysource on tbl_sc_lead.[assigned_enquirysource]=tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as tbl_assigned_enquirysubsource on tbl_sc_lead.[assigned_enquirysubsource]=tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n left join tbl_SC_leadstage as tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=tbl_current_leadowner.[Users_pid]  \n left join tbl_SC_recordtype as tbl_current_leadstage_recordtype on tbl_current_leadstage.[recordtype]=tbl_current_leadstage_recordtype.[recordtype_pid]   \r\n outer apply \r\n    (select dbo.CsvResult('tbl_SC_lead_interestedproducts',tbl_sc_lead.[lead_pid]) as [tbl_sc_lead_interestedproducts]  )  as x_tbl_sc_lead_interestedproducts \r\n  \r\n outer apply \r\n ( select '' as [viewrec] ) as x_viewrec \r\n  \r\n outer apply \r\n ( select '' as [editrecord] ) as x_editrecord \r\n  \r\n outer apply \r\n ( select '' as [deleterecord] ) as x_deleterecord \r\n \r\n WHERE 1=1  and isnull(tbl_sc_lead.IsDeleted,0)=0 and isnull(tbl_sc_lead.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_lead.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( isnull(tbl_sc_lead.[lead_pid],'')  IN (\n(select  \nTOP 1 isnull(sub_tbl_lead.[lead_pid],'')  as __subqueryField \n from tbl_SC_leadactivity as sub_tbl_SC_leadactivity\n\n left join tbl_SC_lead as sub_tbl_lead on sub_tbl_SC_leadactivity.[lead]=sub_tbl_lead.[lead_pid]  \n left join tbl_SC_leadactivitytype as sub_tbl_leadactivitytype on sub_tbl_sc_leadactivity.[leadactivitytype]=sub_tbl_leadactivitytype.[leadactivitytype_pid]  \n where 1=1 \nand ( sub_tbl_leadactivitytype.[leadactivitytypecode] &lt;&gt; 'Outgoing'  ) \r\n and sub_tbl_SC_leadactivity.company_fid=@Users.CompanyID\r\n\r\n order by \r\nsub_tbl_SC_leadactivity.[activitydate] DESC)\n)  and compflt_tbl_current_leadowner.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   )     \r\n) as tbl ;\n--[cnt_listflead]\nselect count (*) from (--QUERY BEGIN--\r\n\r\nselect \r\n  tbl_sc_lead.[lead_pid] as [tbl_sc_lead_lead_pid],tbl_sc_lead.[createddate] as [tbl_sc_lead_createddate],\r\ntbl_sc_lead.[leadnumber] as [tbl_sc_lead_leadnumber],\r\ntbl_parentlead.[leadnumber] as [tbl_parentlead_leadnumber],\r\ntbl_assigned_campaign.[campaignname] as [tbl_assigned_campaign_campaignname],\r\ntbl_sc_lead.[contactpersonname] as [tbl_sc_lead_contactpersonname],\r\ntbl_assigned_enquirysource.[enquirysourcename] as [tbl_assigned_enquirysource_enquirysourcename],\r\ntbl_assigned_enquirysubsource.[enquirysubsourcename] as [tbl_assigned_enquirysubsource_enquirysubsourcename],\r\n[tbl_sc_lead_interestedproducts],\r\ntbl_current_leadstage.[stagecode] as [tbl_current_leadstage_stagecode],\r\ntbl_sc_lead.[latestnote] as [tbl_sc_lead_latestnote],\r\ntbl_current_leadowner.[username] as [tbl_current_leadowner_username],\r\ntbl_sc_lead.[personalemail] as [tbl_sc_lead_personalemail],\r\nviewrec,\r\neditrecord,\r\ndeleterecord,\r\ntbl_current_leadstage_recordtype.[recordtypecode] as [tbl_current_leadstage_recordtype_recordtypecode],\r\ntbl_sc_lead.[parentlead] as [tbl_sc_lead_parentlead]   from \r\ntbl_sc_lead \n left join tbl_SC_leadstage as compflt_tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=compflt_tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SC_recordtype as compflt_tbl_current_leadstage_recordtype on compflt_tbl_current_leadstage.[recordtype]=compflt_tbl_current_leadstage_recordtype.[recordtype_pid]  \n left join tbl_SYS_Users as compflt_tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=compflt_tbl_current_leadowner.[Users_pid]      \r\n\n left join tbl_SC_lead as tbl_parentlead on tbl_sc_lead.[parentlead]=tbl_parentlead.[lead_pid]  \n left join tbl_SC_campaign as tbl_assigned_campaign on tbl_sc_lead.[assigned_campaign]=tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as tbl_assigned_enquirysource on tbl_sc_lead.[assigned_enquirysource]=tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as tbl_assigned_enquirysubsource on tbl_sc_lead.[assigned_enquirysubsource]=tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n left join tbl_SC_leadstage as tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=tbl_current_leadowner.[Users_pid]  \n left join tbl_SC_recordtype as tbl_current_leadstage_recordtype on tbl_current_leadstage.[recordtype]=tbl_current_leadstage_recordtype.[recordtype_pid]   \r\n outer apply \r\n    (select dbo.CsvResult('tbl_SC_lead_interestedproducts',tbl_sc_lead.[lead_pid]) as [tbl_sc_lead_interestedproducts]  )  as x_tbl_sc_lead_interestedproducts \r\n  \r\n outer apply \r\n ( select '' as [viewrec] ) as x_viewrec \r\n  \r\n outer apply \r\n ( select '' as [editrecord] ) as x_editrecord \r\n  \r\n outer apply \r\n ( select '' as [deleterecord] ) as x_deleterecord \r\n \r\n WHERE 1=1  and isnull(tbl_sc_lead.IsDeleted,0)=0 and isnull(tbl_sc_lead.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_lead.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( compflt_tbl_current_leadstage_recordtype.[recordtypecode] = 'L'  )     \r\n) as tbl ;\n--[cnt_schtask]\nselect count (*) from (--QUERY BEGIN--\r\n--[tbl_sc_leadactivity]\r\nselect \r\n  tbl_sc_leadactivity.[leadactivity_pid] as [tbl_sc_leadactivity_leadactivity_pid],action,\r\ntbl_sc_leadactivity.[tasktype] as [tbl_sc_leadactivity_tasktype],\r\ntbl_sc_leadactivity.[activitydate] as [tbl_sc_leadactivity_activitydate],\r\ntbl_sc_leadactivity.[feeddescription] as [tbl_sc_leadactivity_feeddescription],\r\ntbl_lead.[latestnote] as [tbl_lead_latestnote],\r\n[tbl_sc_leadactivity_col_f4ea482a_3872_4ac4_9df3_c8fe9d172fb1],tbl_product.[productname] as [tbl_product_productname],\r\ntbl_lead.[lead_pid] as [tbl_lead_lead_pid]   from \r\ntbl_sc_leadactivity \n left join tbl_SC_leadactivitycategory as compflt_tbl_leadactivitycategory on tbl_sc_leadactivity.[leadactivitycategory]=compflt_tbl_leadactivitycategory.[leadactivitycategory_pid]      \r\n\n left join tbl_SC_lead as tbl_lead on tbl_sc_leadactivity.[lead]=tbl_lead.[lead_pid]  \n left join tbl_SC_product as tbl_product on tbl_sc_leadactivity.[product]=tbl_product.[product_pid]   \r\n outer apply \r\n ( select ('Action') as [action] ) as x_action \r\n  \r\n outer apply \r\n ( select isnull((select  top 1  \n 'Campaign: '+isnull(sub_tbl_assigned_campaign.[campaignname],' ')+'=&gt; Source: '+\nisnull(sub_tbl_assigned_enquirysource.[enquirysourcename],' ')+'=&gt;  SubSource : '+isnull(sub_tbl_assigned_enquirysubsource.[enquirysubsourcename],'')+' =&gt;  LeadNo: '+isnull(sub_tbl_SC_lead.[leadnumber],'')\n+' =&gt;  Contact Person: '+isnull(sub_tbl_SC_lead.[contactpersonname],'')   as __subqueryField \n from tbl_SC_lead as sub_tbl_SC_lead\n\n left join tbl_SC_campaign as sub_tbl_assigned_campaign on sub_tbl_SC_lead.[assigned_campaign]=sub_tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as sub_tbl_assigned_enquirysource on sub_tbl_SC_lead.[assigned_enquirysource]=sub_tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as sub_tbl_assigned_enquirysubsource on sub_tbl_SC_lead.[assigned_enquirysubsource]=sub_tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n where 1=1 \nand ( sub_tbl_sc_lead.[lead_pid] = tbl_lead.[lead_pid]  ) \r\n and sub_tbl_SC_lead.company_fid=@Users.CompanyID),'') as [tbl_sc_leadactivity_col_f4ea482a_3872_4ac4_9df3_c8fe9d172fb1]\r\n ) as x_tbl_sc_leadactivity_col_f4ea482a_3872_4ac4_9df3_c8fe9d172fb1 \r\n \r\n WHERE 1=1  and isnull(tbl_sc_leadactivity.IsDeleted,0)=0 and isnull(tbl_sc_leadactivity.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_leadactivity.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( compflt_tbl_leadactivitycategory.[leadactivitycategorycode] = 'Followup'  and isnull(tbl_sc_leadactivity.[isscheduleperformed],0) = 0  )     \r\n order by tbl_SC_leadactivity.[activitydate] DESC) as tbl ;\n--[cnt_schvisit]\nselect count (*) from (--QUERY BEGIN--\r\n--[tbl_sc_leadactivity]\r\nselect \r\n  tbl_sc_leadactivity.[leadactivity_pid] as [tbl_sc_leadactivity_leadactivity_pid],action,\r\ntbl_lead.[leadnumber] as [tbl_lead_leadnumber],\r\ntbl_sc_leadactivity.[schedulestart] as [tbl_sc_leadactivity_schedulestart],\r\ntbl_sc_leadactivity.[scheduleend] as [tbl_sc_leadactivity_scheduleend],\r\ntbl_lead.[contactpersonname] as [tbl_lead_contactpersonname],\r\ntbl_product.[productname] as [tbl_product_productname],\r\n[tbl_sc_leadactivity_col_35cf8e42_6274_480e_b751_5b14eb20738f],tbl_sc_leadactivity.[ispickuprequired] as [tbl_sc_leadactivity_ispickuprequired],\r\ntbl_sc_leadactivity.[pickupdate] as [tbl_sc_leadactivity_pickupdate],\r\n[tbl_pickuplocation_displaylocation],\r\ntbl_visitconfirmation.[sitevisitconfirmationcode] as [tbl_visitconfirmation_sitevisitconfirmationcode],\r\ntbl_lead.[lead_pid] as [tbl_lead_lead_pid]   from \r\ntbl_sc_leadactivity \n left join tbl_SC_leadactivitycategory as compflt_tbl_leadactivitycategory on tbl_sc_leadactivity.[leadactivitycategory]=compflt_tbl_leadactivitycategory.[leadactivitycategory_pid]  \n left join tbl_SYS_Users as compflt_tbl_createdBy_User_Fid on tbl_sc_leadactivity.[createdBy_User_Fid]=compflt_tbl_createdBy_User_Fid.[users_pid]      \r\n\n left join tbl_SC_lead as tbl_lead on tbl_sc_leadactivity.[lead]=tbl_lead.[lead_pid]  \n left join tbl_SC_product as tbl_product on tbl_sc_leadactivity.[product]=tbl_product.[product_pid]  \n left join tbl_SC_pickuplocation as tbl_pickuplocation on tbl_sc_leadactivity.[pickuplocation]=tbl_pickuplocation.[pickuplocation_pid]  \n left join tbl_SC_sitevisitconfirmation as tbl_visitconfirmation on tbl_sc_leadactivity.[visitconfirmation]=tbl_visitconfirmation.[sitevisitconfirmation_pid]  \n left join tbl_SC_leadactivitycategory as tbl_leadactivitycategory on tbl_sc_leadactivity.[leadactivitycategory]=tbl_leadactivitycategory.[leadactivitycategory_pid]  \n left join tbl_SYS_Users as tbl_lead_current_leadowner on tbl_lead.[current_leadowner]=tbl_lead_current_leadowner.[Users_pid]   \r\n outer apply \r\n    ( select inner_location#.locationname as [tbl_pickuplocation_displaylocation] from [tbl_SC_pickuplocation] as  [inner_tbl_SC_pickuplocation] left  join tbl_SC_location as inner_location# on inner_location#.[location_pid] = inner_tbl_SC_pickuplocation.[location]  where [inner_tbl_SC_pickuplocation].pickuplocation_pid=tbl_pickuplocation.pickuplocation_pid)  as x_tbl_pickuplocation_displaylocation \r\n  \r\n outer apply \r\n ( select ('Action') as [action] ) as x_action \r\n  \r\n outer apply \r\n ( select isnull((select  top 1  \n 'Campaign: '+isnull(sub_tbl_assigned_campaign.[campaignname],' ')+' Source: '+\nisnull(sub_tbl_assigned_enquirysource.[enquirysourcename],' ')+' SubSource : '+isnull(sub_tbl_assigned_enquirysubsource.[enquirysubsourcename],'')  as __subqueryField \n from tbl_SC_lead as sub_tbl_SC_lead\n\n left join tbl_SC_campaign as sub_tbl_assigned_campaign on sub_tbl_SC_lead.[assigned_campaign]=sub_tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as sub_tbl_assigned_enquirysource on sub_tbl_SC_lead.[assigned_enquirysource]=sub_tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as sub_tbl_assigned_enquirysubsource on sub_tbl_SC_lead.[assigned_enquirysubsource]=sub_tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n where 1=1 \nand ( sub_tbl_sc_lead.[lead_pid] = tbl_lead.[lead_pid]  ) \r\n and sub_tbl_SC_lead.company_fid=@Users.CompanyID),'') as [tbl_sc_leadactivity_col_35cf8e42_6274_480e_b751_5b14eb20738f]\r\n ) as x_tbl_sc_leadactivity_col_35cf8e42_6274_480e_b751_5b14eb20738f \r\n \r\n WHERE 1=1  and isnull(tbl_sc_leadactivity.IsDeleted,0)=0 and isnull(tbl_sc_leadactivity.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_leadactivity.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n and ( tbl_leadactivitycategory.[leadactivitycategoryname] = 'Site Visit'  and tbl_lead_current_leadowner.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   and tbl_sc_leadactivity.[schedulestart] &gt;= dateadd(day, datediff(day, 0, '2017-12-02 11:30:59 AM')+0, 0)   and tbl_sc_leadactivity.[schedulestart] &lt; dateadd(day, datediff(day, 0, '2017-12-02 11:30:59 AM')+1, 0)  ) and ( compflt_tbl_leadactivitycategory.[leadactivitycategoryname] = 'Site Visit'  and compflt_tbl_createdBy_User_Fid.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   and isnull(tbl_sc_leadactivity.[isscheduleperformed],0) = 0  )     \r\n) as tbl ;\n--[cnt_unqualfied]\nselect count (*) from (--QUERY BEGIN--\r\n\r\nselect \r\n  tbl_sc_lead.[lead_pid] as [tbl_sc_lead_lead_pid],tbl_sc_lead.[createddate] as [tbl_sc_lead_createddate],\r\ntbl_sc_lead.[leadnumber] as [tbl_sc_lead_leadnumber],\r\ntbl_parentlead.[leadnumber] as [tbl_parentlead_leadnumber],\r\ntbl_assigned_campaign.[campaignname] as [tbl_assigned_campaign_campaignname],\r\ntbl_sc_lead.[contactpersonname] as [tbl_sc_lead_contactpersonname],\r\ntbl_assigned_enquirysource.[enquirysourcename] as [tbl_assigned_enquirysource_enquirysourcename],\r\ntbl_assigned_enquirysubsource.[enquirysubsourcename] as [tbl_assigned_enquirysubsource_enquirysubsourcename],\r\n[tbl_sc_lead_interestedproducts],\r\ntbl_current_leadstage.[stagecode] as [tbl_current_leadstage_stagecode],\r\ntbl_sc_lead.[latestnote] as [tbl_sc_lead_latestnote],\r\ntbl_current_leadowner.[username] as [tbl_current_leadowner_username],\r\ntbl_sc_lead.[personalemail] as [tbl_sc_lead_personalemail],\r\nviewrec,\r\neditrecord,\r\ndeleterecord,\r\ntbl_current_leadstage_recordtype.[recordtypecode] as [tbl_current_leadstage_recordtype_recordtypecode],\r\ntbl_sc_lead.[parentlead] as [tbl_sc_lead_parentlead]   from \r\ntbl_sc_lead \n left join tbl_SC_leadstage as compflt_tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=compflt_tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as compflt_tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=compflt_tbl_current_leadowner.[Users_pid]      \r\n\n left join tbl_SC_lead as tbl_parentlead on tbl_sc_lead.[parentlead]=tbl_parentlead.[lead_pid]  \n left join tbl_SC_campaign as tbl_assigned_campaign on tbl_sc_lead.[assigned_campaign]=tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as tbl_assigned_enquirysource on tbl_sc_lead.[assigned_enquirysource]=tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as tbl_assigned_enquirysubsource on tbl_sc_lead.[assigned_enquirysubsource]=tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n left join tbl_SC_leadstage as tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=tbl_current_leadowner.[Users_pid]  \n left join tbl_SC_recordtype as tbl_current_leadstage_recordtype on tbl_current_leadstage.[recordtype]=tbl_current_leadstage_recordtype.[recordtype_pid]   \r\n outer apply \r\n    (select dbo.CsvResult('tbl_SC_lead_interestedproducts',tbl_sc_lead.[lead_pid]) as [tbl_sc_lead_interestedproducts]  )  as x_tbl_sc_lead_interestedproducts \r\n  \r\n outer apply \r\n ( select '' as [viewrec] ) as x_viewrec \r\n  \r\n outer apply \r\n ( select '' as [editrecord] ) as x_editrecord \r\n  \r\n outer apply \r\n ( select '' as [deleterecord] ) as x_deleterecord \r\n \r\n WHERE 1=1  and isnull(tbl_sc_lead.IsDeleted,0)=0 and isnull(tbl_sc_lead.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_lead.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( isnull(compflt_tbl_current_leadstage.[initialstage],0) = 1  and compflt_tbl_current_leadstage.[recordtype] = 'L'  and compflt_tbl_current_leadowner.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   )     \r\n) as tbl ;\n--[cnt_qualified]\nselect count (*) from (--QUERY BEGIN--\r\n\r\nselect \r\n  tbl_sc_lead.[lead_pid] as [tbl_sc_lead_lead_pid],tbl_sc_lead.[createddate] as [tbl_sc_lead_createddate],\r\ntbl_sc_lead.[leadnumber] as [tbl_sc_lead_leadnumber],\r\ntbl_parentlead.[leadnumber] as [tbl_parentlead_leadnumber],\r\ntbl_assigned_campaign.[campaignname] as [tbl_assigned_campaign_campaignname],\r\ntbl_sc_lead.[contactpersonname] as [tbl_sc_lead_contactpersonname],\r\ntbl_assigned_enquirysource.[enquirysourcename] as [tbl_assigned_enquirysource_enquirysourcename],\r\ntbl_assigned_enquirysubsource.[enquirysubsourcename] as [tbl_assigned_enquirysubsource_enquirysubsourcename],\r\n[tbl_sc_lead_interestedproducts],\r\ntbl_current_leadstage.[stagecode] as [tbl_current_leadstage_stagecode],\r\ntbl_sc_lead.[latestnote] as [tbl_sc_lead_latestnote],\r\ntbl_current_leadowner.[username] as [tbl_current_leadowner_username],\r\ntbl_sc_lead.[personalemail] as [tbl_sc_lead_personalemail],\r\nviewrec,\r\neditrecord,\r\ndeleterecord,\r\ntbl_current_leadstage_recordtype.[recordtypecode] as [tbl_current_leadstage_recordtype_recordtypecode],\r\ntbl_sc_lead.[parentlead] as [tbl_sc_lead_parentlead]   from \r\ntbl_sc_lead \n left join tbl_SC_leadstage as compflt_tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=compflt_tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as compflt_tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=compflt_tbl_current_leadowner.[Users_pid]      \r\n\n left join tbl_SC_lead as tbl_parentlead on tbl_sc_lead.[parentlead]=tbl_parentlead.[lead_pid]  \n left join tbl_SC_campaign as tbl_assigned_campaign on tbl_sc_lead.[assigned_campaign]=tbl_assigned_campaign.[campaign_pid]  \n left join tbl_SC_enquirysource as tbl_assigned_enquirysource on tbl_sc_lead.[assigned_enquirysource]=tbl_assigned_enquirysource.[enquirysource_pid]  \n left join tbl_SC_enquirysubsource as tbl_assigned_enquirysubsource on tbl_sc_lead.[assigned_enquirysubsource]=tbl_assigned_enquirysubsource.[enquirysubsource_pid]  \n left join tbl_SC_leadstage as tbl_current_leadstage on tbl_sc_lead.[current_leadstage]=tbl_current_leadstage.[leadstage_pid]  \n left join tbl_SYS_Users as tbl_current_leadowner on tbl_sc_lead.[current_leadowner]=tbl_current_leadowner.[Users_pid]  \n left join tbl_SC_recordtype as tbl_current_leadstage_recordtype on tbl_current_leadstage.[recordtype]=tbl_current_leadstage_recordtype.[recordtype_pid]   \r\n outer apply \r\n    (select dbo.CsvResult('tbl_SC_lead_interestedproducts',tbl_sc_lead.[lead_pid]) as [tbl_sc_lead_interestedproducts]  )  as x_tbl_sc_lead_interestedproducts \r\n  \r\n outer apply \r\n ( select '' as [viewrec] ) as x_viewrec \r\n  \r\n outer apply \r\n ( select '' as [editrecord] ) as x_editrecord \r\n  \r\n outer apply \r\n ( select '' as [deleterecord] ) as x_deleterecord \r\n \r\n WHERE 1=1  and isnull(tbl_sc_lead.IsDeleted,0)=0 and isnull(tbl_sc_lead.IsDeactivated,0)=0  \r\n --companycheckbegin\r\n and tbl_sc_lead.company_fid=@Users.CompanyID \r\n --companycheckend\r\n\r\n--SECURITY FILTER\r\n and 1=1 \r\n  and ( isnull(compflt_tbl_current_leadstage.[initialstage],0) = 0  and compflt_tbl_current_leadstage.[recordtype] = 'L'  and compflt_tbl_current_leadstage.[isleadtoopportunity] = 0  and compflt_tbl_current_leadstage.[isclosedlost] = 0  and compflt_tbl_current_leadstage.[isclosedwon] = 0  and compflt_tbl_current_leadstage.[isproposalstage] = 0  and compflt_tbl_current_leadowner.[Users_pid] =  (select  top 1 tbl_SYS_Users.[Users_pid] from tbl_SYS_Users as tbl_SYS_Users where tbl_SYS_Users.users_pid=@Users.UserID)   )     \r\n) as tbl ;\n","alert");


};
var newleadcount="";
var unqualifiedLead="";
var qualifiedLead="";
var leadtopp="";
var listoflistcount="";
var ScheduledSiteVisitCount = "";
var ScheduledTaskCount="";
var LeadsWithoutUserActivityCount="";
var leadwithoutaction ="";


Erp.OnInit.Register(InitFunction);
function InitFunction(){
Erp.SetDisplay('btn-gridLeadReview-Edit',false);
}

Erp.OnLoad.Register(LoadFunction);
function LoadFunction(){

Erp.RegisterEvent('btn-gridLeadReview-Edit','click',openddetailwindow);

  
Erp.SetDisplay('btn-gridLeadStage-Edit',false);
Erp.RegisterEvent('btn-gridLeadStage-Edit','click',opendStageLead);
  
  Erp.LoadVariable('leadcount',setCounts);
 

}
function setCounts()
{
  if(leadcount!=null)
  {
  newleadcount=leadcount[0]["newlead"];
  unqualifiedLead=leadcount[0]["unqualifiedlead"];
  qualifiedLead=leadcount[0]["qualifiedlead"];
  leadtopp=leadcount[0]["leadtopp"];
  listoflistcount = leadcount[0]["listofleads"];
  leadwithoutaction= leadcount[0]["leadswithoutuseractivitycount"];
  ScheduledTaskCount = leadcount[0]["scheduledtaskcount"];
  ScheduledSiteVisitCount = leadcount[0]["scheduledsitevisitcount"];
  
    
}
 
  
}

Erp.Grid.OnRowDataBound('gridLeadReview',GridRowDataBound);
function GridRowDataBound(gridId,args){
var chkrowdata=Erp.Grid.GetRecordValue('gridLeadReview','reviewoptcode',args.row);
  var reviewname = Erp.Grid.GetRecordValue('gridLeadReview','reviewopt',args.row);
  
if(chkrowdata=="NewLead")
{
  Erp.SetLabel('lbltitle','New Leads (Untouched) ');
  Erp.Grid.SetEditorValue('gridLeadReview','reviewopt',args.row,reviewname+' ('+newleadcount+')');
  $("#gridLeadReview_ctl00__1").click();
  openddetailwindow();
  
}
  else if(chkrowdata=="LeadMissed")
{
 
  Erp.Grid.SetEditorValue('gridLeadReview','reviewopt',args.row,reviewname+' ('+leadwithoutaction+')');
}
  else if(chkrowdata=="ListOfLead")
{
  
  Erp.Grid.SetEditorValue('gridLeadReview','reviewopt',args.row,reviewname+' ('+listoflistcount+')');
}
else if(chkrowdata=="ScheduledTask")
{
  Erp.Grid.SetEditorValue('gridLeadReview','reviewopt',args.row,reviewname+' ('+ScheduledTaskCount+')');
}
else if(chkrowdata=="ScheduledSiteVisit")
{
  Erp.Grid.SetEditorValue('gridLeadReview','reviewopt',args.row,reviewname+' ('+ScheduledSiteVisitCount+')');
}
else
{}
}

Erp.Grid.OnRowDataBound('gridLeadStage',GridRowDataBound1);
function GridRowDataBound1(gridId,args)
{
var chkrowdata=Erp.Grid.GetRecordValue('gridLeadStage','stagecode',args.row);
//var stagename =Erp.Grid.GetRecordValue('gridLeadStage','stagecode',args.row);
if(chkrowdata=="Unqualified")
    Erp.Grid.SetEditorValue('gridLeadStage','stagecode',args.row,chkrowdata+' ('+unqualifiedLead+')');

if(chkrowdata=="Qualified")
    Erp.Grid.SetEditorValue('gridLeadStage','stagecode',args.row,chkrowdata+' ('+qualifiedLead+')');
if(chkrowdata=="LeadToOpportunity")
    Erp.Grid.SetEditorValue('gridLeadStage','stagecode',args.row,chkrowdata+' ('+leadtopp+')');
  

}


function openddetailwindow()
{
  
  var reviewoption='';
  reviewoption=Erp.Grid.GetRecordValue('gridLeadReview','reviewoptcode');
  
  if(Fn.Contains(reviewoption,"LeadMissed"))
  {
     Erp.SetLabel('lbltitle',' Missing Lead (Not A Single Activity Recorded By User For Incoming Activity) ');
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_lead","Form":"","Refresh":false,"Global":false,"Title":"","Params":"filter=LeadsMissing&leadtypecode=O"},'htmlwindow');
  }
  else if(Fn.Contains(reviewoption,"NewLead"))
  {
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_lead","Form":"","Refresh":false,"Global":false,"Title":"","Params":"filter=Filter_UntouchedLeads&leadtypecode=O"},'htmlwindow');
  }
  else if(Fn.Contains(reviewoption,"ListOfLead"))	//List of Leads
  {		
    Erp.SetLabel('lbltitle',' List Of Lead (All Leads)');
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_lead","Form":"","Refresh":false,"Global":false,"Title":"","Params":"filter=Filter_New_Lead"},'htmlwindow');
  }
  else if(Fn.Contains(reviewoption,"ScheduledTask"))
  {       
    Erp.SetLabel('lbltitle',' Scheduled Task (Not Performed Task)');
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_leadactivity","Form":"View_TodaysTaskReview","Refresh":false,"Global":false,"Title":"","Params":""},'htmlwindow');
   
  }
  else if(Fn.Contains(reviewoption,"ScheduledSiteVisit"))
  {
   Erp.SetLabel('lbltitle',' Scheduled Site Visit (Site Visit)');
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_leadactivity","Form":"View_TodaysSiteVisitReview","Refresh":false,"Global":false,"Title":"","Params":""},'htmlwindow');
  }
  else
  {
    
  }
  
  return false;
}



function opendStageLead()
{
 
  var rectype=Erp.Grid.GetRecordValue('gridLeadStage','rectype');
  
  var initialstage=Erp.Grid.GetEditorValue('gridLeadStage','initialstage');
  var isleadopp=Erp.Grid.GetEditorValue('gridLeadStage','isleadopp');
  var isclosedlost=Erp.Grid.GetEditorValue('gridLeadStage','isclosedlost');
  var isclosedwon=Erp.Grid.GetEditorValue('gridLeadStage','isclosedwon');
  
 
  if(Fn.CBool(initialstage)&&!Fn.CBool(isleadopp)&&!Fn.CBool(isclosedlost)&&!Fn.CBool(isclosedwon)&&rectype=="L")
  {
    Erp.SetLabel('lbltitle',' Unqualified (Unqualified Leads)'); 
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_lead","Form":"","Refresh":false,"Global":false,"Title":"","Params":"filter=InitialLeadStage"},'htmlwindow');
    
  }
  else if(!Fn.CBool(initialstage)&&!Fn.CBool(isleadopp)&&!Fn.CBool(isclosedlost)&&!Fn.CBool(isclosedwon)&&rectype=="L")
  {
    Erp.SetLabel('lbltitle',' Qualified (Qualified Leads)');
    Erp.OpenWindow({"Action":"VIEWFORM","Entity":"tbl_SC_lead","Form":"","Refresh":false,"Global":false,"Title":"","Params":"filter=QulifiedLeadStage"},'htmlwindow');
 
  }
  else
  {
    
  }
  return false;
}





